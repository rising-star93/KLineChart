!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).klinecharts={})}(this,(function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var i=0;e.length>i;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function n(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&o(t,e)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,e){return(o=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function l(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function u(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?l(t):e}function _(t){return function(){var e,i=c(t);if(h()){var a=c(this).constructor;e=Reflect.construct(i,arguments,a)}else e=i.apply(this,arguments);return u(this,e)}}function d(t,e,i){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=c(t)););return t}(t,e);if(a){var n=Object.getOwnPropertyDescriptor(a,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function v(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,a=Array(e);e>i;i++)a[i]=t[i];return a}function y(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return v(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(i):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?v(t,e):void 0}}(t))){var e=0,i=function(){};return{s:i,n:function(){return t.length>e?{done:!1,value:t[e++]}:{done:!0}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,n,r=!0,s=!1;return{s:function(){a=t[Symbol.iterator]()},n:function(){var t=a.next();return r=t.done,t},e:function(t){s=!0,n=t},f:function(){try{r||null==a.return||a.return()}finally{if(s)throw n}}}}function f(t,e){if(g(t)&&g(e))for(var i in e)if(t.hasOwnProperty(i)){var a=t[i],n=e[i];g(n)&&g(a)&&!x(n)&&!x(a)?f(a,n):(e[i]||0===e[i]||!1===e[i])&&(t[i]=e[i])}}function p(t){if(!t||!g(t))return t;var e,i,a;for(i in e=x(t)?[]:{},t)t.hasOwnProperty(i)&&(e[i]=(a=t[i])&&g(a)?p(a):a);return e}function x(t){return"[object Array]"===Object.prototype.toString.call(t)}function m(t){return"function"==typeof t}function g(t){var i=e(t);return"function"===i||!!t&&"object"===i}function k(t){return"number"==typeof t&&!isNaN(t)}function w(t){return null!=t}function D(t){return"boolean"==typeof t}var P="dash",M="left",S="right",T="percentage",b="inside",C="outside",A="real_time",E="candle_stick",L="solid",I="stroke",z="up_stroke",R="down_stroke",H="ohlc",Y="always",B="follow_cross",V="standard",O={grid:{display:!0,horizontal:{display:!0,size:1,color:"#393939",style:P,dashValue:[2,2]},vertical:{display:!1,size:1,color:"#393939",style:P,dashValue:[2,2]}},candleStick:{bar:{style:L,upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#666666"},priceMark:{display:!0,high:{display:!0,color:"#D9D9D9",textMargin:5,textSize:10,textFamily:"Arial"},low:{display:!0,color:"#D9D9D9",textMargin:5,textSize:10,textFamily:"Arial"},last:{display:!0,upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#666666",line:{display:!0,style:P,dashValue:[4,4],size:1},text:{display:!0,size:12,paddingLeft:2,paddingTop:2,paddingRight:2,paddingBottom:2,color:"#FFFFFF",family:"Arial"}}}},realTime:{timeLine:{color:"#1e88e5",size:1,areaFillColor:"rgba(30, 136, 229, 0.08)"},averageLine:{display:!0,color:"#F5A623",size:1}},technicalIndicator:{bar:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#666666"},line:{size:1,colors:["#D9D9D9","#F5A623","#F601FF","#1587DD","#1e88e5"]},circle:{upColor:"#26A69A",downColor:"#EF5350",noChangeColor:"#666666"},lastValueMark:{display:!1,textColor:"#ffffff",textSize:12,textFamily:"Arial",textPaddingLeft:3,textPaddingTop:2,textPaddingRight:3,textPaddingBottom:2}},xAxis:{display:!0,maxHeight:50,minHeight:30,axisLine:{display:!0,color:"#888888",size:1},tickText:{display:!0,color:"#D9D9D9",size:12,family:"Arial",margin:3},tickLine:{display:!0,size:1,length:3,color:"#888888"}},yAxis:{display:!0,maxWidth:100,minWidth:60,type:"normal",position:S,axisLine:{display:!0,color:"#888888",size:1},tickText:{position:C,display:!0,color:"#D9D9D9",size:12,family:"Arial",margin:3},tickLine:{display:!0,size:1,length:3,color:"#888888"}},separator:{size:1,color:"#888888",fill:!0},floatLayer:{crossHair:{display:!0,horizontal:{display:!0,line:{display:!0,style:P,dashValue:[4,2],size:1,color:"#888888"},text:{display:!0,color:"#D9D9D9",size:12,family:"Arial",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderColor:"#505050",backgroundColor:"#505050"}},vertical:{display:!0,line:{display:!0,style:P,dashValue:[4,2],size:1,color:"#888888"},text:{display:!0,color:"#D9D9D9",size:12,family:"Arial",paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderColor:"#505050",backgroundColor:"#505050"}}},prompt:{displayRule:Y,candleStick:{showType:V,labels:["时间","开","收","高","低","成交量"],values:null,rect:{paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:6,left:8,top:8,right:8,borderRadius:4,borderSize:1,borderColor:"#3f4254",fillColor:"rgba(17, 17, 17, .3)"},text:{size:12,family:"Arial",color:"#D9D9D9",marginLeft:8,marginTop:6,marginRight:8,marginBottom:0}},technicalIndicator:{text:{size:12,family:"Arial",color:"#D9D9D9",marginTop:6,marginRight:8,marginBottom:0,marginLeft:8},point:{display:!0,radius:3}}}},graphicMark:{line:{color:"#1e88e5",size:1},point:{backgroundColor:"#1e88e5",borderColor:"#1e88e5",borderSize:1,radius:4,activeBackgroundColor:"#1e88e5",activeBorderColor:"#1e88e5",activeBorderSize:1,activeRadius:6},text:{color:"#1e88e5",size:12,family:"Arial",marginLeft:2,marginRight:2,marginTop:2,marginBottom:6}}};function F(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"--";if(t&&g(t)){var a=t[e];if(a||0===a||!1===a)return a}return i}function G(t,e,i){if(t&&k(t)){var a,n=new Date(t);try{a=new Intl.DateTimeFormat("en",{hour12:!1,timeZone:i,year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"}).format(n)}catch(t){a=new Intl.DateTimeFormat("en",{hour12:!1,year:"numeric",month:"numeric",day:"numeric",hour:"numeric",minute:"numeric"}).format(n)}var r=a.match(/^[\d]{1,2}\/[\d]{1,2}\/[\d]{4}/)[0].split("/"),s="".concat(1===r[0].length?"0".concat(r[0]):r[0]),c="".concat(1===r[1].length?"0".concat(r[1]):r[1]),o=a.match(/[\d]{2}:[\d]{2}$/)[0];switch("24"===o.match(/^[\d]{2}/)[0]&&(o=o.replace(/^[\d]{2}/,"00")),e){case"YYYY":return r[2];case"YYYY-MM":return"".concat(r[2],"-").concat(s);case"YYYY-MM-DD":return"".concat(r[2],"-").concat(s,"-").concat(c);case"YYYY-MM-DD hh:mm":return"".concat(r[2],"-").concat(s,"-").concat(c," ").concat(o);case"MM-DD":return"".concat(s,"-").concat(c);case"hh:mm":return o;default:return"".concat(s,"-").concat(c," ").concat(o)}}return"--"}function W(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=+t;return(i||0===i)&&k(i)?t.toFixed(e):"".concat(i)}function X(t){return k(+t)?t>1e9?"".concat(+(t/1e9).toFixed(3),"B"):t>1e6?"".concat(+(t/1e6).toFixed(3),"M"):t>1e3?"".concat(+(t/1e3).toFixed(3),"K"):t:"--"}var j=function(){function t(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:4,s=arguments.length>4?arguments[4]:void 0,c=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,h=arguments.length>7?arguments[7]:void 0;i(this,t),this.name=e,this.precision=r,this.calcParams=a,this.plots=n,this.shouldCheckParamCount=s,this.isPriceTechnicalIndicator=c,this.min=o,this.max=h,this.result=[]}return n(t,[{key:"setPrecision",value:function(t){t>=0&&k(t)&&(this.precision=parseInt(t,10))}},{key:"setCalcParams",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.shouldCheckParamCount&&t.length!==this.calcParams.length||(this.calcParams=p(t),this._regeneratePlots())}},{key:"calcTechnicalIndicator",value:function(t){}},{key:"_regeneratePlots",value:function(){}},{key:"_calc",value:function(t,e){for(var i=t.length,a=0;i>a;a++)e(a)}}]),t}(),N=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"MA",[5,10,30,60],[{key:"ma5",type:"line"},{key:"ma10",type:"line"},{key:"ma30",type:"line"},{key:"ma60",type:"line"}],4,!1,!0)}return n(a,[{key:"_regeneratePlots",value:function(){var t=this;this.plots=[],this.calcParams.forEach((function(e){t.plots.push({key:"ma".concat(e),type:"line"})}))}},{key:"calcTechnicalIndicator",value:function(t){var e=this,i=this.calcParams.length,a=[],n=[];return this._calc(t,(function(r){for(var s={},c=t[r].close,o=0;i>o;o++){a[o]=(a[o]||0)+c;var h=e.calcParams[o];h-1>r||(s[e.plots[o].key]=a[o]/h,a[o]-=t[r-(h-1)].close)}n.push(s)})),n}}]),a}(j),K=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"EMA",[6,12,20],[{key:"ema6",type:"line"},{key:"ema12",type:"line"},{key:"ema20",type:"line"}],4,!1,!0)}return n(a,[{key:"_regeneratePlots",value:function(){var t=this;this.plots=[],this.calcParams.forEach((function(e){t.plots.push({key:"ema".concat(e),type:"line"})}))}},{key:"calcTechnicalIndicator",value:function(t){var e=this,i=this.calcParams.length,a=[],n=[];return this._calc(t,(function(r){for(var s={},c=t[r].close,o=0;i>o;o++){var h=void 0;s[e.plots[o].key]=h=0===r?c:(2*c+(e.calcParams[o]-1)*a[o])/(e.calcParams[o]+1),a[o]=h}n.push(s)})),n}}]),a}(j),U=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"VOL",[5,10,20],[{key:"ma5",type:"line"},{key:"ma10",type:"line"},{key:"ma30",type:"line"},{key:"num",type:"bar",referenceValue:0,color:function(t,e,i){return e.close>e.open?i.bar.upColor:e.open>e.close?i.bar.downColor:i.bar.noChangeColor}}],0,!1,!1,0)}return n(a,[{key:"_regeneratePlots",value:function(){var t=this;this.plots=[],this.calcParams.forEach((function(e){t.plots.push({key:"ma".concat(e),type:"line"})})),this.plots.push({key:"num",type:"bar"})}},{key:"calcTechnicalIndicator",value:function(t){var e=this,i=this.calcParams.length,a=[],n=[];return this._calc(t,(function(r){for(var s=t[r].volume,c={num:s},o=0;i>o;o++){a[o]=(a[o]||0)+s;var h=e.calcParams[o];h-1>r||(c[e.plots[o].key]=a[o]/h,a[o]-=t[r-(h-1)].volume)}n.push(c)})),n}}]),a}(j),Z=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"MACD",[12,26,9],[{key:"diff",type:"line"},{key:"dea",type:"line"},{key:"macd",type:"bar"}],4,!0)}return n(a,[{key:"calcTechnicalIndicator",value:function(t){var e,i,a=this,n=0,r=0,s=0,c=0,o=[];return this._calc(t,(function(h){var l=t[h].close;0===h?(e=l,i=l):(e=(2*l+(a.calcParams[0]-1)*n)/(a.calcParams[0]+1),i=(2*l+(a.calcParams[1]-1)*r)/(a.calcParams[1]+1));var u=e-i;n=e,r=i,c=s=(2*u+c*(a.calcParams[2]-1))/(a.calcParams[2]+1),o.push({diff:u,dea:s,macd:2*(u-s)})})),o}}]),a}(j),q=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"BOLL",[20],[{key:"up",type:"line"},{key:"mid",type:"line"},{key:"dn",type:"line"}],4,!0,!0)}return n(a,[{key:"calcTechnicalIndicator",value:function(t){var e=this,i=this.calcParams[0]-1,a=0,n=[];return this._calc(t,(function(r){var s={};if(a+=t[r].close,r>=i){s.mid=a/e.calcParams[0];var c=e._getBollMd(t.slice(r-i,r+1),s.mid);s.up=s.mid+2*c,s.dn=s.mid-2*c,a-=t[r-i].close}n.push(s)})),n}},{key:"_getBollMd",value:function(t,e){var i=t.length,a=0;t.forEach((function(t){var i=t.close-e;a+=i*i}));var n=a>0,r=Math.sqrt((a=Math.abs(a))/i);return n?r:-1*r}}]),a}(j);function $(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],e=-1/0,i=1/0;return t.forEach((function(t){e=Math.max(t.high,e),i=Math.min(t.low,i)})),{hn:e,ln:i}}var J=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"KDJ",[9,3,3],[{key:"k",type:"line"},{key:"d",type:"line"},{key:"j",type:"bar"}],4,!0)}return n(a,[{key:"calcTechnicalIndicator",value:function(t){var e=this,i=this.calcParams[0]-1,a=[];return this._calc(t,(function(n){var r={},s=t[n].close;if(n>=i){var c=$(t.slice(n-i,n+1)),o=c.ln,h=c.hn-o;r.k=((e.calcParams[1]-1)*(a[n-1].k||50)+(s-o)/(0===h?1:h)*100)/e.calcParams[1],r.d=((e.calcParams[2]-1)*(a[n-1].d||50)+r.k)/e.calcParams[2],r.j=3*r.k-2*r.d}a.push(r)})),a}}]),a}(j),Q=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"RSI",[6,12,24],[{key:"rsi6",type:"line"},{key:"rsi12",type:"line"},{key:"rsi24",type:"line"}])}return n(a,[{key:"_regeneratePlots",value:function(){var t=this;this.plots=[],this.calcParams.forEach((function(e){t.plots.push({key:"rsi".concat(e),type:"line"})}))}},{key:"calcTechnicalIndicator",value:function(t){var e=this,i=[],a=[],n=this.calcParams.length,r=[];return this._calc(t,(function(s){for(var c={},o=t[s].open,h=0;n>h;h++){var l=0===o?0:(t[s].close-o)/o;if(l>0?i[h]=(i[h]||0)+l:a[h]=(a[h]||0)+Math.abs(l),s>=e.calcParams[h]-1){var u=(i[h]+a[h])/e.calcParams[h];c[e.plots[h].key]=0!==u?i[h]/e.calcParams[h]/u*100:0;var _=t[s-(e.calcParams[h]-1)],d=_.open,v=0===_.open?0:(_.close-d)/d;v>0?i[h]-=v:a[h]-=Math.abs(v)}}r.push(c)})),r}}]),a}(j),tt=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"BIAS",[6,12,24],[{key:"bias6",type:"line"},{key:"bias12",type:"line"},{key:"bias24",type:"line"}])}return n(a,[{key:"_regeneratePlots",value:function(){var t=this;this.plots=[],this.calcParams.forEach((function(e){t.plots.push({key:"bias".concat(e),type:"line"})}))}},{key:"calcTechnicalIndicator",value:function(t){var e=this,i=[],a=this.calcParams.length,n=[];return this._calc(t,(function(r){for(var s={},c=t[r].close,o=0;a>o;o++){i[o]=(i[o]||0)+c;var h=e.calcParams[o]-1;if(r>=h){var l=i[o]/e.calcParams[o];s[e.plots[o].key]=(c-l)/l*100,i[o]-=t[r-h].close}}n.push(s)})),n}}]),a}(j),et=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"BRAR",[26],[{key:"br",type:"line"},{key:"ar",type:"line"}],4,!0)}return n(a,[{key:"calcTechnicalIndicator",value:function(t){var e=this,i=0,a=0,n=0,r=0,s=[];return this._calc(t,(function(c){var o={};if(c>0){var h=t[c].high,l=t[c].low,u=t[c].open,_=t[c-1].close;if(n+=h-u,r+=u-l,i+=h-_,a+=_-l,c>=e.calcParams[0]){o.ar=0!==r?n/r*100:0,o.br=0!==a?i/a*100:0;var d=t[c-(e.calcParams[0]-1)].high,v=t[c-(e.calcParams[0]-1)].low,y=t[c-(e.calcParams[0]-1)].open,f=t[c-e.calcParams[0]].close;i-=d-f,a-=f-v,n-=d-y,r-=y-v}}s.push(o)})),s}}]),a}(j),it=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"CCI",[13],[{key:"cci",type:"line"}],4,!0)}return n(a,[{key:"calcTechnicalIndicator",value:function(t){var e,i=this,a=this.calcParams[0]-1,n=0,r=0,s=[],c=[];return this._calc(t,(function(o){var h,l={},u=t[o].close;if(n+=u,s.push(h=a>o?n/(o+1):n/i.calcParams[0]),r+=Math.abs(h-u),o>=a){l.cci=0!==(e=r/i.calcParams[0])?((t[o].high+t[o].low+u)/3-h)/e/.015:0;var _=t[o-a].close;n-=_,r-=Math.abs(s[o-a]-_)}c.push(l)})),c}}]),a}(j),at=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"DMI",[14,6],[{key:"pdi",type:"line"},{key:"mdi",type:"line"},{key:"adx",type:"line"},{key:"adxr",type:"line"}],4,!0)}return n(a,[{key:"calcTechnicalIndicator",value:function(t){var e=this,i=0,a=[],n=0,r=[],s=0,c=[],o=0,h=[],l=[];return this._calc(t,(function(u){var _={};if(u>0){var d=t[u-1].close,v=t[u].high,y=t[u].low,f=v-y,p=Math.abs(v-d),x=Math.abs(y-d),m=v-t[u-1].high,g=t[u-1].low-y,k=Math.max(Math.max(f,p),x);i+=k,a.push(k);var w=m>0&&m>g?m:0;n+=w,r.push(w);var D=g>0&&g>m?g:0;if(s+=D,c.push(D),u>=e.calcParams[0]){var P=100*n/i,M=100*s/i,S=Math.abs(M-P)/(M+P)*100;if(o+=S,h.push(S),_.pdi=P,_.mdi=M,u>=e.calcParams[0]+e.calcParams[1]-1){var T=o/e.calcParams[1];_.adx=T,e.calcParams[0]+2*e.calcParams[1]-2>u||(_.adxr=(T+l[e.calcParams[1]-1].adx)/2),o-=h[u-(e.calcParams[0]+e.calcParams[1]-1)]}i-=a[u-e.calcParams[0]],n-=r[u-e.calcParams[0]],s-=c[u-e.calcParams[0]]}}l.push(_)})),l}}]),a}(j),nt=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"CR",[26,10,20,40,60],[{key:"cr",type:"line"},{key:"ma1",type:"line"},{key:"ma2",type:"line"},{key:"ma3",type:"line"},{key:"ma4",type:"line"}],4,!0)}return n(a,[{key:"calcTechnicalIndicator",value:function(t){var e=this,i=Math.ceil(this.calcParams[1]/2.5+1),a=Math.ceil(this.calcParams[2]/2.5+1),n=Math.ceil(this.calcParams[3]/2.5+1),r=Math.ceil(this.calcParams[4]/2.5+1),s=0,c=[],o=0,h=[],l=0,u=[],_=0,d=[],v=[];return this._calc(t,(function(y){var f={};if(y>0){var p=t[y-1],x=(p.high+p.close+p.low+p.open)/4,m=Math.max(0,t[y].high-x),g=Math.max(0,x-t[y].low);if(y>=e.calcParams[0]){f.cr=0!==g?m/g*100:0;s+=f.cr,o+=f.cr,l+=f.cr,_+=f.cr,e.calcParams[0]+e.calcParams[1]-1>y||(c.push(s/e.calcParams[1]),e.calcParams[0]+e.calcParams[1]+i-2>y||(f.ma1=c[c.length-i]),s-=v[y-(e.calcParams[1]-1)].cr),e.calcParams[0]+e.calcParams[2]-1>y||(h.push(o/e.calcParams[2]),e.calcParams[0]+e.calcParams[2]+a-2>y||(f.ma2=h[h.length-a]),o-=v[y-(e.calcParams[2]-1)].cr),e.calcParams[0]+e.calcParams[3]-1>y||(u.push(l/e.calcParams[3]),e.calcParams[0]+e.calcParams[3]+n-2>y||(f.ma3=u[u.length-n]),l-=v[y-(e.calcParams[3]-1)].cr),e.calcParams[0]+e.calcParams[4]-1>y||(d.push(_/e.calcParams[4]),e.calcParams[0]+e.calcParams[4]+r-2>y||(f.ma4=d[d.length-r]),_-=v[y-(e.calcParams[4]-1)].cr)}}v.push(f)})),v}}]),a}(j),rt=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"PSY",[12,6],[{key:"psy",type:"line"},{key:"psyMa",type:"line"}],4,!0)}return n(a,[{key:"calcTechnicalIndicator",value:function(t){var e=this,i=0,a=0,n=[],r=[];return this._calc(t,(function(s){var c={},o=t[s].close-t[s-1].open>0?1:0;n.push(o),i+=o,e.calcParams[0]-1>s||(c.psy=i/e.calcParams[0]*100,a+=c.psy,e.calcParams[0]+e.calcParams[1]-2>s||(c.psyMa=a/e.calcParams[1],a-=c.psy),i-=n[s-(e.calcParams[0]-1)]),r.push(c)})),r}}]),a}(j),st=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"DMA",[10,50,10],[{key:"dma",type:"line"},{key:"ama",type:"line"}],4,!0)}return n(a,[{key:"calcTechnicalIndicator",value:function(t){var e=this,i=Math.max(this.calcParams[0],this.calcParams[1]),a=0,n=0,r=0,s=[];return this._calc(t,(function(c){var o,h,l={},u=t[c].close;if(a+=u,a+=u,e.calcParams[0]-1>c||(o=a/e.calcParams[0],a-=s[e.calcParams[0]-1].close),e.calcParams[1]-1>c||(h=n/e.calcParams[1],n-=s[e.calcParams[1]-1].close),c>=i-1){var _=o-h;l.dma=_,r+=_,i+e.calcParams[2]-2>c||(l.ama=r/e.calcParams[2],r-=s[c-(e.calcParams[2]-1)].dma)}s.push(l)})),s}}]),a}(j),ct=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"TRIX",[12,20],[{key:"trix",type:"line"},{key:"trixMa",type:"line"}],4,!0)}return n(a,[{key:"calcTechnicalIndicator",value:function(t){var e,i,a,n,r,s,c=this,o=0,h=[];return this._calc(t,(function(l){var u={},_=t[l].close;0===l?(e=_,i=_,a=_):(a=(2*(i=(2*(e=(2*_+(c.calcParams[0]-1)*n)/(c.calcParams[0]+1))+(c.calcParams[0]-1)*r)/(c.calcParams[0]+1))+(c.calcParams[0]-1)*s)/(c.calcParams[0]+1),u.trix=0===s?0:(a-s)/s*100,o+=u.trix,c.calcParams[1]-1>l||(u.trixMa=o/c.calcParams[1],o-=h[l-(c.calcParams[1]-1)].trix||0)),n=e,r=i,s=a,h.push(u)})),h}}]),a}(j),ot=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"OBV",[30],[{key:"obv",type:"line"},{key:"obvMa",type:"line"}],4,!0)}return n(a,[{key:"calcTechnicalIndicator",value:function(t){var e=this,i=0,a=[];return this._calc(t,(function(n){var r=t[n].close,s=t[n].high-r,c=(r-t[n].low-s)/s*t[n].volume,o={obv:c};i+=c,e.calcParams[0]-1>n||(o.obvMa=i/e.calcParams[0],i-=a[n-(e.calcParams[0]-1)].obv),a.push(o)})),a}}]),a}(j),ht=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"VR",[24,30],[{key:"vr",type:"line"},{key:"vrMa",type:"line"}],4,!0)}return n(a,[{key:"calcTechnicalIndicator",value:function(t){var e=this,i=0,a=0,n=0,r=0,s=[];return this._calc(t,(function(c){var o={},h=t[c].close,l=t[c].open,u=t[c].volume;if(h>l?i+=u:l>h?a+=u:n+=u,c>=e.calcParams[0]-1){var _=n/2;o.vr=(i+_)/(a+_),r+=o.vr,e.calcParams[0]+e.calcParams[1]-2>c||(o.vrMa=r/e.calcParams[1],r-=s[c-(e.calcParams[1]-1)].vr);var d=t[c-(e.calcParams[0]-1)],v=d.open,y=d.close,f=d.volume;y>v?i-=f:v>y?a-=f:n-=f}s.push(o)})),s}}]),a}(j),lt=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"WR",[6,10,14],[{key:"wr1",type:"line"},{key:"wr2",type:"line"},{key:"wr3",type:"line"}])}return n(a,[{key:"_regeneratePlots",value:function(){var t=this;this.plots=[],this.calcParams.forEach((function(e,i){t.plots.push({key:"wr".concat(i),type:"line"})}))}},{key:"calcTechnicalIndicator",value:function(t){var e=this,i=[];return this._calc(t,(function(a){var n={},r=t[a].close;e.calcParams.forEach((function(i,s){var c=i-1;if(a>=c){var o=$(t.slice(a-c,a+1)),h=o.hn,l=h-o.ln;n[e.plots[s].key]=0===l?0:(h-r)/l*100}})),i.push(n)})),i}}]),a}(j),ut=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"MTM",[6,10],[{key:"mtm",type:"line"},{key:"mtmMa",type:"line"}],4,!0)}return n(a,[{key:"calcTechnicalIndicator",value:function(t){var e=this,i=0,a=[];return this._calc(t,(function(n){var r={};n<e.calcParams[0]-1||(r.mtm=t[n].close-t[n-(e.calcParams[0]-1)].close,i+=r.mtm,e.calcParams[0]+e.calcParams[1]-2>n||(r.mtmMa=i/e.calcParams[1],i-=a[n-(e.calcParams[1]-1)].mtm));a.push(r)})),a}}]),a}(j),_t=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"SAR",[2,2,20],[{key:"sar",type:"circle"}],4,!0,!0)}return n(a,[{key:"calcTechnicalIndicator",value:function(t){var e=this.calcParams[0]/100,i=this.calcParams[1]/100,a=this.calcParams[2]/100,n=e,r=-100,s=!1,c=0,o=[];return this._calc(t,(function(h){var l=c,u=t[h].high,_=t[h].low;if(s){(-100===r||u>r)&&(r=u,n=Math.min(n+i,a)),c=l+n*(r-l);var d=Math.min(t[Math.max(1,h)-1].low,_);c>t[h].low?(c=r,n=e,r=-100,s=!s):c>d&&(c=d)}else{(-100===r||r>_)&&(r=_,n=Math.min(n+i,a)),c=l+n*(r-l);var v=Math.max(t[Math.max(1,h)-1].high,u);t[h].high>c?(c=r,n=0,r=-100,s=!s):v>c&&(c=v)}o.push({sar:c})})),o}}]),a}(j),dt=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.call(this,"EMV",[14,9],[{key:"emv",type:"line"},{key:"emvMa",type:"line"}],4,!0)}return n(a,[{key:"calcTechnicalIndicator",value:function(t){var e=this,i=0,a=0,n=[],r=[];return this._calc(t,(function(s){var c={};if(s>0){var o=t[s].high,h=t[s].low,l=((o+h)/2-(t[s-1].high+t[s-1].low)/2)*(o-h)-t[s].turnover;n.push(l),i+=l,e.calcParams[0]>s||(c.emv=i/e.calcParams[0],a+=c.emv,e.calcParams[0]+e.calcParams[1]-1>s||(c.emvMa=a/e.calcParams[1],a-=r[s-(e.calcParams[1]-1)].emv),i-=n[s-e.calcParams[0]])}r.push(c)})),r}}]),a}(j);function vt(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0,i=arguments.length>2?arguments[2]:void 0,a=e.calcParams,n=e.plots,r=e.precision,s=e.isVolumeTechnicalIndicator,c=[],o=[],h=e.name;return a.length>0&&(h="".concat(h,"(").concat(a.join(","),")")),n.forEach((function(e){c.push(e.key.toUpperCase());var a,n=t[e.key];w(n)&&(a=i.convertToPixel(n),n=W(n,r),s&&(n=X(n))),o.push({value:n,y:a})})),{labels:c,values:o,name:h}}var yt=0,ft=1,pt=2,xt=3,mt=4,gt="none",kt="horizontalStraightLine",wt="verticalStraightLine",Dt="straightLine",Pt="horizontalRayLine",Mt="verticalRayLine",St="rayLine",Tt="horizontalSegmentLine",bt="verticalSegmentLine",Ct="segmentLine",At="priceLine",Et="priceChannelLine",Lt="parallelStraightLine",It="fibonacciLine",zt=function(){function t(e,a){var n;i(this,t),this._invalidateHandler=a,this._styleOptions=p(O),f(this._styleOptions,e),this._technicalIndicators=(r(n={},"MA",new N),r(n,"EMA",new K),r(n,"VOL",new U),r(n,"MACD",new Z),r(n,"BOLL",new q),r(n,"KDJ",new J),r(n,"RSI",new Q),r(n,"BIAS",new tt),r(n,"BRAR",new et),r(n,"CCI",new it),r(n,"DMI",new at),r(n,"CR",new nt),r(n,"PSY",new rt),r(n,"DMA",new st),r(n,"TRIX",new ct),r(n,"OBV",new ot),r(n,"VR",new ht),r(n,"WR",new lt),r(n,"MTM",new ut),r(n,"EMV",new dt),r(n,"SAR",new _t),n),this._pricePrecision=2,this._volumePrecision=0,this._timezone=null,this._dataList=[],this._loading=!0,this._loadMoreCallback=null,this._more=!0,this._totalDataSpace=0,this._dataSpace=6,this._barSpace=this._calcBarSpace(),this._offsetRightBarCount=50/this._dataSpace,this._leftMinVisibleBarCount=2,this._rightMinVisibleBarCount=2,this._from=0,this._to=0,this._crossHairPoint=null,this._crossHairSeriesTag=null,this._preOffsetRightBarCount=0,this._graphicMarkType=gt,this._graphicMarkPoint=null,this._dragGraphicMarkFlag=!1,this._graphicMarkDatas={horizontalStraightLine:[],verticalStraightLine:[],straightLine:[],horizontalRayLine:[],verticalRayLine:[],rayLine:[],horizontalSegmentLine:[],verticalSegmentLine:[],segmentLine:[],priceLine:[],parallelStraightLine:[],priceChannelLine:[],fibonacciLine:[]}}return n(t,[{key:"_loadMoreHandler",value:function(){this._more&&!this._loading&&this._loadMoreCallback&&m(this._loadMoreCallback)&&(this._loading=!0,this._loadMoreCallback(F(this._dataList[0],"timestamp")))}},{key:"_calcBarSpace",value:function(){return Math.max(1,Math.min(Math.floor(.8*this._dataSpace),Math.floor(this._dataSpace)-1))}},{key:"_innerSetDataSpace",value:function(t){return!(!t||3>t||t>30||this._dataSpace===t)&&(this._dataSpace=t,this._barSpace=this._calcBarSpace(),!0)}},{key:"styleOptions",value:function(){return this._styleOptions}},{key:"applyStyleOptions",value:function(t){f(this._styleOptions,t)}},{key:"technicalIndicator",value:function(t){return this._technicalIndicators[t]}},{key:"applyTechnicalIndicatorParams",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=this.technicalIndicator(t);i&&(i.calcParams=p(e))}},{key:"pricePrecision",value:function(){return this._pricePrecision}},{key:"volumePrecision",value:function(){return this._volumePrecision}},{key:"setTimezone",value:function(t){this._timezone=t}},{key:"timezone",value:function(){return this._timezone}},{key:"applyPrecision",value:function(t,e){w(t)&&k(t)&&t>=0&&(this._pricePrecision=t),w(e)&&k(e)&&e>=0&&(this._volumePrecision=e,this.technicalIndicator("VOL").precision=e)}},{key:"calcTechnicalIndicator",value:function(t,e){var i=this;new Promise((function(t,a){if("NO"===e)t(!0);else{var n=i.technicalIndicator(e);n&&n.calcTechnicalIndicator?(n.result=n.calcTechnicalIndicator(i._dataList)||[],t(!0)):a(Error("Technical indicator type is error!"))}})).then((function(e){if(x(t)){var i,a=y(t);try{for(a.s();!(i=a.n()).done;){i.value.invalidate(mt)}}catch(t){a.e(t)}finally{a.f()}}else t.invalidate(mt)})).catch((function(t){}))}},{key:"dataList",value:function(){return this._dataList}},{key:"clearDataList",value:function(){this._more=!0,this._loading=!0,this._dataList=[],this._from=0,this._to=0}},{key:"addData",value:function(t,e,i){g(t)&&(x(t)?(this._loading=!1,this._more=!D(i)||i,this._dataList=t.concat(this._dataList),this.adjustOffsetBarCount()):this._dataList.length>e?this._dataList[e]=t:(this._dataList.push(t),0>this._offsetRightBarCount&&(this._offsetRightBarCount-=1),this.adjustOffsetBarCount()))}},{key:"dataSpace",value:function(){return this._dataSpace}},{key:"barSpace",value:function(){return this._barSpace}},{key:"offsetRightBarCount",value:function(){return this._offsetRightBarCount}},{key:"setDataSpace",value:function(t){this._innerSetDataSpace(t)&&(this.adjustOffsetBarCount(),this._invalidateHandler())}},{key:"setTotalDataSpace",value:function(t){this._totalDataSpace!==t&&(this._totalDataSpace=t,this.adjustOffsetBarCount())}},{key:"setOffsetRightSpace",value:function(t){this._offsetRightBarCount=t/this._dataSpace,this.adjustOffsetBarCount()}},{key:"setLeftMinVisibleBarCount",value:function(t){k(t)&&t>0&&(this._leftMinVisibleBarCount=Math.ceil(t))}},{key:"setRightMinVisibleBarCount",value:function(t){k(t)&&t>0&&(this._rightMinVisibleBarCount=Math.ceil(t))}},{key:"from",value:function(){return this._from}},{key:"to",value:function(){return this._to}},{key:"crossHairPoint",value:function(){return this._crossHairPoint}},{key:"crossHairSeriesTag",value:function(){return this._crossHairSeriesTag}},{key:"setCrossHairSeriesTag",value:function(t){this._crossHairSeriesTag=t,this._invalidateHandler(pt)}},{key:"setCrossHairPoint",value:function(t){this._crossHairPoint=t}},{key:"startScroll",value:function(){this._preOffsetRightBarCount=this._offsetRightBarCount}},{key:"scroll",value:function(t){var e=t/this._dataSpace;this._offsetRightBarCount=this._preOffsetRightBarCount-e,this.adjustOffsetBarCount(),e>0&&0===this._from&&this._loadMoreHandler(),this._invalidateHandler()}},{key:"coordinateToFloatIndex",value:function(t){return Math.round(1e6*(this._dataList.length+this._offsetRightBarCount-(this._totalDataSpace-t)/this._dataSpace))/1e6}},{key:"zoom",value:function(t,e){var i=this.coordinateToFloatIndex(e.x);this._innerSetDataSpace(this._dataSpace+t*(this._dataSpace/10))&&(this._offsetRightBarCount+=i-this.coordinateToFloatIndex(e.x),this.adjustOffsetBarCount(),this._invalidateHandler())}},{key:"adjustOffsetBarCount",value:function(){var t=this._dataList.length,e=this._totalDataSpace/this._dataSpace,i=1-this._barSpace/2/this._dataSpace,a=e-Math.min(this._leftMinVisibleBarCount,t)+i;this._offsetRightBarCount>a&&(this._offsetRightBarCount=a);var n=1-t+Math.min(this._rightMinVisibleBarCount,t)-i;n>this._offsetRightBarCount&&(this._offsetRightBarCount=n),this._to=Math.round(this._offsetRightBarCount+t),this._from=Math.floor(this._to-e)-1,this._to>t&&(this._to=t),0>this._from&&(this._from=0)}},{key:"graphicMarkType",value:function(){return this._graphicMarkType}},{key:"setGraphicMarkType",value:function(t){this._graphicMarkType=t}},{key:"dragGraphicMarkFlag",value:function(){return this._dragGraphicMarkFlag}},{key:"setDragGraphicMarkFlag",value:function(t){this._dragGraphicMarkFlag=t}},{key:"graphicMarkPoint",value:function(){return this._graphicMarkPoint}},{key:"setGraphicMarkPoint",value:function(t){this._graphicMarkPoint=t}},{key:"graphicMarkData",value:function(){return p(this._graphicMarkDatas)}},{key:"setGraphicMarkData",value:function(t){var e=this.shouldInvalidateGraphicMark();this._graphicMarkDatas=p(t),(e||this.shouldInvalidateGraphicMark())&&this._invalidateHandler(ft)}},{key:"loadMore",value:function(t){this._loadMoreCallback=t}},{key:"shouldInvalidateGraphicMark",value:function(){if(this._graphicMarkType!==gt)return!0;for(var t in this._graphicMarkDatas)if(this._graphicMarkDatas[t].length>0)return!0;return!1}}]),t}();function Rt(t){return(window.devicePixelRatio||1)/(t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}function Ht(t,e){return t.measureText(e).width}function Yt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Arial";return"".concat(t,"px ").concat(e)}function Bt(t,e,i,a){t.beginPath();var n=t.lineWidth%2?.5:0;t.moveTo(i,e+n),t.lineTo(a,e+n),t.stroke(),t.closePath()}function Vt(t,e,i,a){t.beginPath();var n=t.lineWidth%2?.5:0;t.moveTo(e+n,i),t.lineTo(e+n,a),t.stroke(),t.closePath()}function Ot(t,e){t.save(),t.lineWidth%2&&t.translate(.5,.5),e(),t.restore()}var Ft=function(){function t(e){i(this,t),this._container=e.container,this._chartData=e.chartData,this._width=-1,this._height=-1,this._initBefore(e),this._initElement(),this._mainWidget=this._createMainWidget(this._mainWidgetCell,e),this._yAxisWidget=this._createYAxisWidget(this._yAxisWidgetCell,e)}return n(t,[{key:"_initBefore",value:function(t){}},{key:"_initElement",value:function(){this._element=document.createElement("div"),this._element.style.margin="0",this._element.style.padding="0",this._element.style.position="relative",this._element.style.overflow="hidden",this._element.style.width="100%",this._mainWidgetCell=this._createCell(),this._yAxisWidgetCell=this._createCell(),this._element.appendChild(this._mainWidgetCell),this._element.appendChild(this._yAxisWidgetCell);var t=this._container.lastChild;t?this._container.insertBefore(this._element,t):this._container.appendChild(this._element)}},{key:"_createCell",value:function(){var t=document.createElement("div");return t.style.display="table-cell",t.style.position="absolute",t.style.margin="0",t.style.padding="0",t.style.top="0",t.style.zIndex="1",t}},{key:"_createMainWidget",value:function(t,e){}},{key:"_createYAxisWidget",value:function(t,e){}},{key:"_setCellSize",value:function(t,e){t.style.left="".concat(e.left,"px"),t.style.width="".concat(e.width,"px"),t.style.height="".concat(e.height,"px")}},{key:"_computeAxis",value:function(){}},{key:"width",value:function(){return this._element.offsetWidth}},{key:"height",value:function(){return this._height}},{key:"setHeight",value:function(t){this._height=t}},{key:"setSize",value:function(t,e){this._height=t.height,this._element.style.height="".concat(t.height,"px"),this._setCellSize(this._mainWidgetCell,t),this._setCellSize(this._yAxisWidgetCell,e),this._mainWidget.setSize(t.width,this._height),this._yAxisWidget&&this._yAxisWidget.setSize(e.width,e.height)}},{key:"invalidate",value:function(t){t===mt&&this._computeAxis(),this._yAxisWidget&&this._yAxisWidget.invalidate(t),this._mainWidget.invalidate(t)}},{key:"getImage",value:function(t,e){var i=document.createElement("canvas"),a=i.getContext("2d"),n=Rt(a),r=this._element.offsetWidth,s=this._element.offsetHeight;i.style.width="".concat(r,"px"),i.style.height="".concat(s,"px"),i.width=r*n,i.height=s*n,a.scale(n,n);var c=this._mainWidgetCell.offsetWidth,o=this._mainWidgetCell.offsetHeight,h=parseInt(this._mainWidgetCell.style.left,10),l=this._yAxisWidgetCell.offsetWidth,u=this._yAxisWidgetCell.offsetHeight,_=parseInt(this._yAxisWidgetCell.style.left,10);return a.drawImage(this._mainWidget.getImage(t,e),h,0,c,o),this._yAxisWidget&&a.drawImage(this._yAxisWidget.getImage(t),_,0,l,u),i}},{key:"destroy",value:function(){this._container.removeChild(this._element)}}]),t}(),Gt=function(){function t(e){i(this,t),this._width=0,this._height=0,this._initElement(e.container),this._mainView=this._createMainView(this._element,e),this._expandView=this._createExpandView(this._element,e),this._floatLayerView=this._createFloatLayerView(this._element,e)}return n(t,[{key:"_initElement",value:function(t){this._element=document.createElement("div"),this._element.style.margin="0",this._element.style.padding="0",this._element.style.width="100%",this._element.style.height="100%",this._element.style.position="relative",this._element.style.overflow="hidden",t.appendChild(this._element)}},{key:"_createMainView",value:function(t,e){}},{key:"_createExpandView",value:function(t,e){}},{key:"_createFloatLayerView",value:function(t,e){}},{key:"setSize",value:function(t,e){this._width=t,this._height=e,this._mainView.setSize(t,e),this._floatLayerView.setSize(t,e)}},{key:"invalidate",value:function(t){switch(t){case pt:this._floatLayerView.flush();break;case xt:case mt:this._mainView.flush(),this._floatLayerView.flush()}}},{key:"getImage",value:function(t,e){var i=document.createElement("canvas"),a=i.getContext("2d"),n=Rt(a);return i.style.width="".concat(this._width,"px"),i.style.height="".concat(this._height,"px"),i.width=this._width*n,i.height=this._height*n,a.scale(n,n),a.drawImage(this._mainView.getImage(),0,0,this._width,this._height),e&&this._expandView&&a.drawImage(this._expandView.getImage(),0,0,this._width,this._height),t&&a.drawImage(this._floatLayerView.getImage(),0,0,this._width,this._height),i}}]),t}();var Wt=function(){function t(e,a){i(this,t),this._chartData=a,this._initCanvas(e)}return n(t,[{key:"_initCanvas",value:function(t){this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.style.right="0",this._canvas.style.left="0",this._canvas.style.zIndex="2",this._ctx=this._canvas.getContext("2d"),t.appendChild(this._canvas)}},{key:"_redraw",value:function(t){this._ctx.clearRect(0,0,this._width,this._height),t&&t(),this._draw()}},{key:"_draw",value:function(){}},{key:"setSize",value:function(t,e){var i=this;this._redraw((function(){var a=Rt(i._ctx);i._width=t,i._height=e,i._canvas.style.top="0",i._canvas.style.width="".concat(t,"px"),i._canvas.style.height="".concat(e,"px"),i._canvas.width=t*a,i._canvas.height=e*a,i._ctx.scale(a,a)}))}},{key:"flush",value:function(){var t,e,i=this;this.requestAnimationId&&(t=this.requestAnimationId,window.cancelAnimationFrame||clearTimeout(t),window.cancelAnimationFrame(t)),this.requestAnimationId=(e=function(){i._redraw()},window.requestAnimationFrame?window.requestAnimationFrame(e):window.setTimeout((function(){e()}),1e3/60))}},{key:"getImage",value:function(){return this._canvas}}]),t}(),Xt=function(t){s(a,t);var e=_(a);function a(t,n,r,s,c){var o;return i(this,a),(o=e.call(this,t,n))._xAxis=r,o._yAxis=s,o._additionalDataProvider=c,o}return n(a,[{key:"_draw",value:function(){this._drawGrid(),this._drawTechnicalIndicator()}},{key:"_drawGrid",value:function(){var t=this,e=this._chartData.styleOptions().grid;if(e.display){var i=e.horizontal;i.display&&(this._ctx.strokeStyle=i.color,this._ctx.lineWidth=i.size,i.style===P&&this._ctx.setLineDash(i.dashValue),this._yAxis.ticks().forEach((function(e){Bt(t._ctx,e.y,0,t._width)})));var a=e.vertical;a.display&&(this._ctx.strokeStyle=a.color,this._ctx.lineWidth=a.size,this._ctx.setLineDash(a.style===P?a.dashValue:[]),this._xAxis.ticks().forEach((function(e){Vt(t._ctx,e.x,0,t._height)}))),this._ctx.setLineDash([])}}},{key:"_drawTechnicalIndicator",value:function(){var t=this,e=this._additionalDataProvider.technicalIndicator(),i=e.plots,a=[],n=this._chartData.styleOptions().technicalIndicator,r=this._chartData.dataList(),s=e.result;this._ctx.lineWidth=1,this._drawGraphics((function(c,o,h,l){e.isPriceTechnicalIndicator&&t._drawTechnicalIndicatorOhlc(o,c,l,n,h,t._yAxis.isCandleStickYAxis());var u=s[o]||{},_=0;i.forEach((function(e){var i=u[e.key];switch(e.type){case"circle":if(w(i)){var s=r[o-1],d=t._yAxis.convertToPixel(i),v={x:c,y:d,radius:l,color:e.color?e.color(s,h,n):n.circle.noChangeColor,isStroke:!e.isStroke||e.isStroke(s,h)};t._drawCircle(v)}break;case"bar":if(w(i)){var y=r[o-1],f=t._yAxis.convertToPixel(i),p=t._yAxis.convertToPixel(e.referenceValue||0),x=Math.abs(p-f),m={x:c-l,width:2*l,height:Math.max(1,x)};m.y=f>p?p:1>x?p+1:f,m.color=e.color?e.color(y,h,n):n.bar.noChangeColor,m.isStroke=!!e.isStroke&&e.isStroke(y,h),t._drawBar(m)}break;default:if(w(i)){var g=t._yAxis.convertToPixel(i),k={x:c,y:g};a[_]?a[_].push(k):a[_]=[k]}else a[_]?a[_].push(null):a[_]=[null];_++}}))}),(function(){t._drawLines(a,n)}))}},{key:"_drawTechnicalIndicatorOhlc",value:function(t,e,i,a,n,r){r||this._drawOhlc(i,e,n,a.bar.upColor,a.bar.downColor,a.bar.noChangeColor)}},{key:"_drawLines",value:function(t,e){var i=this,a=e.line.colors,n=(a||[]).length;this._ctx.lineWidth=e.line.size,Ot(this._ctx,(function(){t.forEach((function(t,e){i._ctx.strokeStyle=a[e%n],i._ctx.beginPath();var r=!0;t.forEach((function(t){w(t)&&(r?(i._ctx.moveTo(t.x,t.y),r=!1):i._ctx.lineTo(t.x,t.y))})),i._ctx.stroke(),i._ctx.closePath()}))}))}},{key:"_drawBar",value:function(t){t.isStroke?(this._ctx.strokeStyle=t.color,this._ctx.strokeRect(t.x+.5,t.y,t.width-1,t.height)):(this._ctx.fillStyle=t.color,this._ctx.fillRect(t.x,t.y,t.width,t.height))}},{key:"_drawCircle",value:function(t){this._ctx.strokeStyle=t.color,this._ctx.fillStyle=t.color,this._ctx.beginPath(),this._ctx.arc(t.x,t.y,t.radius,2*Math.PI,0,!0),t.isStroke?this._ctx.stroke():this._ctx.fill(),this._ctx.closePath()}},{key:"_drawOhlc",value:function(t,e,i,a,n,r){var s=i.open,c=i.close,o=this._yAxis.convertToPixel(s),h=this._yAxis.convertToPixel(c),l=this._yAxis.convertToPixel(i.high),u=this._yAxis.convertToPixel(i.low);this._ctx.fillStyle=c>s?a:s>c?n:r,this._ctx.fillRect(e-.5,l,1,u-l),this._ctx.fillRect(e-t,o-.5,t,1),this._ctx.fillRect(e,h-.5,t,1)}},{key:"_drawGraphics",value:function(t,e){for(var i=this._chartData.dataList(),a=i.length,n=this._chartData.barSpace(),r=this._chartData.dataSpace(),s=n/2,c=this._chartData.offsetRightBarCount(),o=this._chartData.to(),h=this._chartData.from();o>h;h++){t(this._width-(a+c-h-.5)*r+s,h,i[h],s,n)}e&&e()}}]),a}(Wt),jt=function(t){s(a,t);var e=_(a);function a(t,n,r,s,c){var o;return i(this,a),(o=e.call(this,t,n))._xAxis=r,o._yAxis=s,o._additionalDataProvider=c,o}return n(a,[{key:"_draw",value:function(){var t,e=this._chartData.crossHairPoint(),i=this._chartData.dataList(),a=this._additionalDataProvider.technicalIndicator(),n=a.result,r=i[t=e?this._xAxis.convertFromPixel(e.x):i.length-1],s=n[t];if(!r){var c=this._chartData.to();t>c-1?(r=i[c-1],s=n[c-1]):0>t&&(r=i[0],s=n[0])}if(r){var o=this._xAxis.convertToPixel(t);this._drawCrossHairHorizontalLine(),this._drawCrossHairVerticalLine(o);var h=this._chartData.styleOptions().floatLayer.prompt.displayRule;(h===Y||h===B&&this._chartData.crossHairSeriesTag())&&this._drawPrompt(r,s,a,o)}}},{key:"_drawPrompt",value:function(t,e,i,a){this._drawTechnicalIndicatorPrompt(e,i,a)}},{key:"_drawCrossHairHorizontalLine",value:function(){if(this._chartData.crossHairSeriesTag()===this._additionalDataProvider.tag()){var t=this._chartData.styleOptions().floatLayer.crossHair,e=t.horizontal,i=e.line;if(t.display&&e.display&&i.display){var a=this._chartData.crossHairPoint();a&&(this._ctx.lineWidth=i.size,this._ctx.strokeStyle=i.color,i.style===P&&this._ctx.setLineDash(i.dashValue),Bt(this._ctx,a.y,0,this._width),this._ctx.setLineDash([]))}}}},{key:"_drawCrossHairVerticalLine",value:function(t){if(this._chartData.crossHairSeriesTag()){var e=this._chartData.styleOptions().floatLayer.crossHair,i=e.vertical,a=i.line;e.display&&i.display&&a.display&&(this._ctx.lineWidth=a.size,this._ctx.strokeStyle=a.color,a.style===P&&this._ctx.setLineDash(a.dashValue),Vt(this._ctx,t,0,this._height),this._ctx.setLineDash([]))}}},{key:"_drawTechnicalIndicatorPrompt",value:function(t,e,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,n=this._chartData.styleOptions().technicalIndicator,r=vt(t,e,this._yAxis),s=n.line.colors;this._drawTechnicalIndicatorPromptText(e,r,s,a),this._drawTechnicalIndicatorPromptPoint(e,r.values,s,i)}},{key:"_drawTechnicalIndicatorPromptText",value:function(t,e,i,a){var n=t.plots,r=this._chartData.styleOptions().floatLayer.prompt.technicalIndicator.text,s=e.name,c=e.labels,o=e.values,h=r.marginLeft,l=r.marginRight,u=h,_=r.marginTop+a,d=r.size,v=r.color,y=i.length;this._ctx.textBaseline="top",this._ctx.font=Yt(d,r.family);var f=Ht(this._ctx,s);this._ctx.fillStyle=v,this._ctx.fillText(s,u,_),u+=h+f;for(var p=-1,x=0;c.length>x;x++){"line"===n[x].type?(this._ctx.fillStyle=i[p%y]||v,p++):this._ctx.fillStyle=v;var m="".concat(c[x],": ").concat(o[x].value||"n/a"),g=Ht(this._ctx,m);this._ctx.fillText(m,u,_),u+=h+l+g}}},{key:"_drawTechnicalIndicatorPromptPoint",value:function(t,e,i,a){var n=this._chartData.styleOptions().floatLayer.prompt.technicalIndicator.point;if(n.display&&this._chartData.crossHairSeriesTag())for(var r=t.plots,s=i.length,c=e.length,o=n.radius,h=0,l=0;c>l;l++){"line"===r[l].type&&(w(e[l].value)&&(this._ctx.fillStyle=i[h%s],this._ctx.beginPath(),this._ctx.arc(a,e[l].y,o,0,2*Math.PI),this._ctx.closePath(),this._ctx.fill()),h++)}}}]),a}(Wt),Nt=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.apply(this,arguments)}return n(a,[{key:"_createMainView",value:function(t,e){return new Xt(t,e.chartData,e.xAxis,e.yAxis,e.additionalDataProvider)}},{key:"_createFloatLayerView",value:function(t,e){return new jt(t,e.chartData,e.xAxis,e.yAxis,e.additionalDataProvider)}}]),a}(Gt),Kt=function(t){s(a,t);var e=_(a);function a(t,n,r,s){var c;return i(this,a),(c=e.call(this,t,n))._yAxis=r,c._additionalDataProvider=s,c}return n(a,[{key:"_draw",value:function(){var t=this._chartData.styleOptions().yAxis;t.display&&(this._drawAxisLine(t),this._drawTickLines(t),this._drawTickLabels(t),this._drawTechnicalIndicatorLastValue(t),this._drawLastPriceLabel(t))}},{key:"_drawAxisLine",value:function(t){var e,i=t.axisLine;i.display&&(this._ctx.strokeStyle=i.color,this._ctx.lineWidth=i.size,e=this._isDrawFromStart(t)?0:this._width-1,Vt(this._ctx,e,0,this._height))}},{key:"_drawTickLines",value:function(t){var e=this,i=t.tickLine;if(i.display){this._ctx.lineWidth=i.size,this._ctx.strokeStyle=i.color;var a,n,r=i.length;this._isDrawFromStart(t)?(a=0,t.axisLine.display&&(a+=t.axisLine.size),n=a+r):(a=this._width,t.axisLine.display&&(a-=t.axisLine.size),n=a-r),this._yAxis.ticks().forEach((function(t){Bt(e._ctx,t.y,a,n)}))}}},{key:"_drawTickLabels",value:function(t){var e=this,i=t.tickText;if(i.display){var a,n=t.tickLine,r=n.display,s=n.length,c=i.margin;this._isDrawFromStart(t)?(a=c,t.axisLine.display&&(a+=t.axisLine.size),r&&(a+=s),this._ctx.textAlign="left"):(a=this._width-c,t.axisLine.display&&(a-=t.axisLine.size),r&&(a-=s),this._ctx.textAlign="right"),this._ctx.textBaseline="middle",this._ctx.font=Yt(i.size,i.family),this._ctx.fillStyle=i.color;var o=this._additionalDataProvider.technicalIndicator().isVolumeTechnicalIndicator;this._yAxis.ticks().forEach((function(t){e._ctx.fillText(o?X(t.v):t.v,a,t.y)})),this._ctx.textAlign="left"}}},{key:"_drawTechnicalIndicatorLastValue",value:function(t){var e=this._chartData.styleOptions().technicalIndicator,i=e.lastValueMark,a=this._additionalDataProvider.technicalIndicator(),n=a.result,r=vt(n[n.length-1],a,this._yAxis);if(i.display&&r)for(var s=a.plots,c=a.precision,o=r.values,h=e.line.colors||[],l=h.length,u=o.length,_=0,d=0;u>d;d++)if("line"===s.type){var v=o[d].value;if(w(v))this._drawMarkLabel(t,v,c,i.textSize,i.textFamily,i.textColor,h[_%l],i.textPaddingLeft,i.textPaddingTop,i.textPaddingRight,i.textPaddingBottom);_++}}},{key:"_drawLastPriceLabel",value:function(t){if(this._yAxis.isCandleStickYAxis()){var e=this._chartData.styleOptions().candleStick.priceMark,i=e.last,a=this._chartData.dataList(),n=a.length;if(e.display&&i.display&&i.text.display&&0!==n){var r,s=a[n-1],c=s.close,o=s.open;r=c>o?i.upColor:o>c?i.downColor:i.noChangeColor;var h=i.text;this._drawMarkLabel(t,c,this._chartData.pricePrecision(),h.size,h.family,h.color,r,h.paddingLeft,h.paddingTop,h.paddingRight,h.paddingBottom)}}}},{key:"_drawMarkLabel",value:function(t,e,i,a,n,r,s,c,o,h,l){var u,_=this._yAxis.convertToPixel(e);if(_=+Math.max(.05*this._height,Math.min(_,.98*this._height)).toFixed(0),this._yAxis.isPercentageYAxis()){var d=this._chartData.dataList()[this._chartData.from()].close;u="".concat(((e-d)/d*100).toFixed(2),"%")}else u=W(e,i),this._additionalDataProvider.technicalIndicator().isVolumeTechnicalIndicator&&(u=X(u));this._ctx.font=Yt(a,n);var v,y=Ht(this._ctx,u)+c+h,f=o+a+l;v=this._isDrawFromStart(t)?0:this._width-y,this._ctx.fillStyle=s,this._ctx.fillRect(v,_-o-a/2,y,f),this._ctx.fillStyle=r,this._ctx.textBaseline="middle",this._ctx.fillText(u,v+c,_)}},{key:"_isDrawFromStart",value:function(t){return t.position===M&&t.tickText.position===b||t.position===S&&t.tickText.position===C}}]),a}(Wt),Ut=function(t){s(a,t);var e=_(a);function a(t,n,r,s){var c;return i(this,a),(c=e.call(this,t,n))._yAxis=r,c._additionalDataProvider=s,c}return n(a,[{key:"_draw",value:function(){this._drawCrossHairLabel()}},{key:"_drawCrossHairLabel",value:function(){if(this._chartData.crossHairSeriesTag()===this._additionalDataProvider.tag()&&0!==this._chartData.dataList().length){var t=this._chartData.styleOptions().floatLayer.crossHair,e=t.horizontal,i=e.text;if(t.display&&e.display&&i.display){var a=this._chartData.crossHairPoint();if(a){var n,r=this._yAxis.convertFromPixel(a.y);if(this._yAxis.isPercentageYAxis()){var s=this._chartData.dataList()[this._chartData.from()].close;n="".concat(((r-s)/s*100).toFixed(2),"%")}else{var c=this._additionalDataProvider.technicalIndicator();n=W(r,c.precision),c.isVolumeTechnicalIndicator&&(n=X(n))}var o=i.size;this._ctx.font=Yt(o,i.family);var h,l=Ht(this._ctx,n),u=i.paddingLeft,_=i.paddingTop,d=i.borderSize,v=l+2*d+u+i.paddingRight,y=o+2*d+_+i.paddingBottom,f=this._chartData.styleOptions().yAxis;h=f.position===M&&f.tickText.position===b||f.position===S&&f.tickText.position===C?0:this._width-v;var p=a.y-d-_-o/2;this._ctx.fillStyle=i.backgroundColor,this._ctx.fillRect(h,p,v,y),this._ctx.lineWidth=d,this._ctx.strokeStyle=i.borderColor,this._ctx.strokeRect(h,p,v,y),this._ctx.textBaseline="middle",this._ctx.fillStyle=i.color,this._ctx.fillText(n,h+d+u,a.y)}}}}}]),a}(Wt),Zt=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.apply(this,arguments)}return n(a,[{key:"_createMainView",value:function(t,e){return new Kt(t,e.chartData,e.yAxis,e.additionalDataProvider)}},{key:"_createFloatLayerView",value:function(t,e){return new Ut(t,e.chartData,e.yAxis,e.additionalDataProvider)}}]),a}(Gt),qt=function(){function t(e){i(this,t),this._chartData=e,this._width=0,this._height=0,this._minValue=0,this._maxValue=0,this._range=0,this._ticks=[]}return n(t,[{key:"setSize",value:function(t,e){this._width=t,this._height=e}},{key:"ticks",value:function(){return this._ticks}},{key:"computeAxis",value:function(){var t=this._computeMinMaxValue(),e=t.max,i=t.range;this._minValue=t.min,this._maxValue=e,this._range=i,this._ticks=this._computeOptimalTicks(this._computeTicks())}},{key:"_computeMinMaxValue",value:function(){}},{key:"_computeOptimalTicks",value:function(t){}},{key:"_computeTicks",value:function(){var t=[];if(this._range>=0){var e=+this._nice(this._range/6),i=this._getIntervalPrecision(e),a=+this._round(Math.ceil(this._minValue/e)*e,i),n=+this._round(Math.floor(this._maxValue/e)*e,i),r=0,s=a;if(0!==e)for(;n>=s;)t[r]={v:s.toFixed(i)},++r,s+=e}return t}},{key:"_nice",value:function(t){var e=Math.floor(Math.log(t)/Math.LN10),i=Math.pow(10,e),a=t/i;return t=(1.5>a?1:2.5>a?2:3.5>a?3:4.5>a?4:5.5>a?5:6.5>a?6:8)*i,-20>e?t:+t.toFixed(0>e?-e:0)}},{key:"_getIntervalPrecision",value:function(t){var e=""+t,i=e.indexOf("e");if(i>0){var a=+e.slice(i+1);return 0>a?-a:0}var n=e.indexOf(".");return 0>n?0:e.length-1-n}},{key:"_round",value:function(t,e){return null==e&&(e=10),t=(+t).toFixed(e=Math.min(Math.max(0,e),20))}}]),t}(),$t=function(t){s(a,t);var e=_(a);function a(t,n){var r;return i(this,a),(r=e.call(this,t))._isCandleStickYAxis=n,r}return n(a,[{key:"_computeMinMaxValue",value:function(){var t=this._minValue,e=this._maxValue;if(t===1/0||e===-1/0)return{min:0,max:0,range:0};var i=Math.abs(e-t);return{min:t-=i/100*10,max:e+=i/100*20,range:i=Math.abs(e-t)}}},{key:"_computeOptimalTicks",value:function(t){var e=[],i=t.length;if(i>0){var a=this._chartData.styleOptions().xAxis.tickText.size,n=this._innerConvertToPixel(+t[0].v),r=1;if(i>1){var s=this._innerConvertToPixel(+t[1].v),c=Math.abs(s-n);2*a>c&&(r=Math.ceil(2*a/c))}for(var o=this.isPercentageYAxis(),h=0;i>h;h+=r){var l=t[h].v,u=this._innerConvertToPixel(+(l=0==+l?"0":l));u>a&&this._height-a>u&&e.push({v:o?"".concat((+l).toFixed(2),"%"):l,y:u})}}return e}},{key:"calcMinMaxValue",value:function(t,e){var i=this,a=this._chartData.dataList(),n=t.result,r=this._chartData.from(),s=this._chartData.to(),c=this._chartData.styleOptions().realTime.averageLine.display,o=[1/0,-1/0];if(e)for(var h=r;s>h;h++){var l=a[h],u=[l.close,o[0]],_=[l.close,o[1]];c&&(u.push(l.average),_.push(l.average)),o[0]=Math.min.apply(null,u),o[1]=Math.max.apply(null,_)}else{for(var d=t.plots||[],v=function(t){var e=a[t],r=n[t];d.forEach((function(t){var e=r[t.key];w(e)&&(o[0]=Math.min(o[0],e),o[1]=Math.max(o[1],e))})),i._isCandleStickYAxis&&(o[0]=Math.min(o[0],e.low),o[1]=Math.max(o[1],e.high))},y=r;s>y;y++)v(y);w(t.min)&&k(t.min)&&(o[0]=t.min),w(t.max)&&k(t.max)&&(o[1]=t.max)}if(o[0]!==1/0&&o[1]!==-1/0)if(this.isPercentageYAxis()){var f=a[r].close;this._minValue=(o[0]-f)/f*100,this._maxValue=(o[1]-f)/f*100,this._minValue===this._maxValue&&(this._minValue-=10,this._maxValue+=10)}else this._minValue=o[0],this._maxValue=o[1],this._minValue===this._maxValue&&(this._minValue-=1,0>this._minValue?(this._minValue=0,this._maxValue=Math.max(1,2*this._maxValue)):this._maxValue+=1)}},{key:"_innerConvertToPixel",value:function(t){return Math.round((1-(t-this._minValue)/this._range)*this._height)}},{key:"isCandleStickYAxis",value:function(){return this._isCandleStickYAxis}},{key:"isPercentageYAxis",value:function(){return this._isCandleStickYAxis&&this._chartData.styleOptions().yAxis.type===T}},{key:"convertFromPixel",value:function(t){var e=(1-t/this._height)*this._range+this._minValue;if(this.isPercentageYAxis()){var i=this._chartData.dataList()[this._chartData.from()].close;return i*e/100+i}return e}},{key:"convertToPixel",value:function(t){var e=t;if(this.isPercentageYAxis()){var i=this._chartData.dataList()[this._chartData.from()].close;e=(t-i)/i*100}return this._innerConvertToPixel(e)}}]),a}(qt),Jt=function(t){s(a,t);var e=_(a);function a(t){var n;return i(this,a),(n=e.call(this,t))._technicalIndicator=n._chartData.technicalIndicator(t.technicalIndicatorType||"MACD"),n._chartData.calcTechnicalIndicator(l(n),n._technicalIndicatorType),n}return n(a,[{key:"_initBefore",value:function(t){this._tag=t.tag,this._yAxis=this._createYAxis(t)}},{key:"_createYAxis",value:function(t){return new $t(t.chartData,!1)}},{key:"_createMainWidget",value:function(t,e){return new Nt({container:t,chartData:e.chartData,xAxis:e.xAxis,yAxis:this._yAxis,additionalDataProvider:{technicalIndicator:this.technicalIndicator.bind(this),tag:this.tag.bind(this)}})}},{key:"_createYAxisWidget",value:function(t,e){return new Zt({container:t,chartData:e.chartData,yAxis:this._yAxis,additionalDataProvider:{technicalIndicator:this.technicalIndicator.bind(this),tag:this.tag.bind(this)}})}},{key:"_computeAxis",value:function(){this._yAxis.calcMinMaxValue(this._technicalIndicator,this._isRealTime()),this._yAxis.computeAxis()}},{key:"_isRealTime",value:function(){return!1}},{key:"tag",value:function(){return this._tag}},{key:"setSize",value:function(t,e){this._yAxis.setSize(e.width,e.height),this._computeAxis(),d(c(a.prototype),"setSize",this).call(this,t,e)}},{key:"yAxis",value:function(){return this._yAxis}},{key:"technicalIndicator",value:function(){return this._technicalIndicator}},{key:"setTechnicalIndicatorType",value:function(t){this._technicalIndicator.name!==t&&(this._technicalIndicator=this._chartData.technicalIndicator(t),this._chartData.calcTechnicalIndicator(this,this._technicalIndicator))}}]),a}(Ft),Qt=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.apply(this,arguments)}return n(a,[{key:"_draw",value:function(){this._drawGrid(),this._additionalDataProvider.chartType()===A?this._drawRealTime():(this._drawCandleStick(),this._drawTechnicalIndicator(),this._drawHighestPriceMark(),this._drawLowestPriceMark()),this._drawLastPriceLine()}},{key:"_drawRealTime",value:function(){var t=this,e=[],i=[],a=[],n=this._chartData.from();this._drawGraphics((function(r,s,c,o){var h=c.average,l=t._yAxis.convertToPixel(c.close),u=t._yAxis.convertToPixel(h);if((h||0===h)&&a.push({x:r,y:u}),s===n){var _=r-o;i.push({x:_,y:t._height}),i.push({x:_,y:l}),e.push({x:_,y:l})}e.push({x:r,y:l}),i.push({x:r,y:l})}),(function(){var n=i.length;if(n>0){var r=i[n-1],s=t._chartData.barSpace()/2,c=r.x+s;e.push({x:c,y:r.y}),i.push({x:c,y:r.y}),i.push({x:c,y:t._height})}var o=t._chartData.styleOptions().realTime,h=o.timeLine;if(e.length>0&&(t._ctx.lineWidth=h.size,t._ctx.strokeStyle=h.color,Ot(t._ctx,(function(){t._ctx.beginPath(),t._ctx.moveTo(e[0].x,e[0].y);for(var i=1;e.length>i;i++)t._ctx.lineTo(e[i].x,e[i].y);t._ctx.stroke(),t._ctx.closePath()}))),i.length>0){t._ctx.fillStyle=h.areaFillColor,t._ctx.beginPath(),t._ctx.moveTo(i[0].x,i[0].y);for(var l=1;i.length>l;l++)t._ctx.lineTo(i[l].x,i[l].y);t._ctx.closePath(),t._ctx.fill()}var u=o.averageLine;u.display&&a.length>0&&(t._ctx.lineWidth=u.size,t._ctx.strokeStyle=u.color,Ot(t._ctx,(function(){t._ctx.beginPath(),t._ctx.moveTo(a[0].x,a[0].y);for(var e=1;a.length>e;e++)t._ctx.lineTo(a[e].x,a[e].y);t._ctx.stroke(),t._ctx.closePath()})))}))}},{key:"_drawCandleStick",value:function(){var t=this,e=[],i=-1/0,a=-1,n=1/0,r=-1,s=this._chartData.styleOptions().candleStick;this._drawGraphics((function(c,o,h,l,u){var _=h.open,d=h.close,v=h.high,y=h.low;if(v>i&&(i=v,a=c),n>y&&(n=y,r=c),s.bar.style!==H){d>_?(t._ctx.strokeStyle=s.bar.upColor,t._ctx.fillStyle=s.bar.upColor):_>d?(t._ctx.strokeStyle=s.bar.downColor,t._ctx.fillStyle=s.bar.downColor):(t._ctx.strokeStyle=s.bar.noChangeColor,t._ctx.fillStyle=s.bar.noChangeColor);var f=t._yAxis.convertToPixel(_),p=t._yAxis.convertToPixel(d),x=t._yAxis.convertToPixel(v),m=t._yAxis.convertToPixel(y),g=[],k=[];switch(g[0]=x,k[1]=m,f>p?(g[1]=p,k[0]=f,e=[c-l,p,u,f-p]):p>f?(g[1]=f,k[0]=p,e=[c-l,f,u,p-f]):(g[1]=f,k[0]=p,e=[c-l,f,u,1]),t._ctx.fillRect(c-.5,g[0],1,g[1]-g[0]),t._ctx.fillRect(c-.5,k[0],1,k[1]-k[0]),1>e[3]&&(e[3]=1),s.bar.style){case L:t._ctx.fillRect(e[0],e[1],e[2],e[3]);break;case I:t._ctx.strokeRect(e[0]+.5,e[1],e[2]-1,e[3]);break;case z:d>_?t._ctx.strokeRect(e[0]+.5,e[1],e[2]-1,e[3]):t._ctx.fillRect(e[0],e[1],e[2],e[3]);break;case R:d>_?t._ctx.fillRect(e[0],e[1],e[2],e[3]):t._ctx.strokeRect(e[0],e[1],e[2],e[3])}}else t._drawOhlc(l,c,h,s.bar.upColor,s.bar.downColor,s.bar.noChangeColor)})),this._highestMarkData={x:a,price:i},this._lowestMarkData={x:r,price:n}}},{key:"_drawHighestPriceMark",value:function(t){if(this._highestMarkData){var e=this._highestMarkData.price,i=this._chartData.styleOptions().candleStick.priceMark,a=i.high;e!==-1/0&&i.display&&a.display&&this._drawLowestHighestPriceMark(a,this._highestMarkData.x,e,!0,this._chartData.pricePrecision())}}},{key:"_drawLowestPriceMark",value:function(){if(this._lowestMarkData){var t=this._lowestMarkData.price,e=this._chartData.styleOptions().candleStick.priceMark,i=e.low;t!==1/0&&e.display&&i.display&&this._drawLowestHighestPriceMark(i,this._lowestMarkData.x,t,!1,this._chartData.pricePrecision())}}},{key:"_drawLowestHighestPriceMark",value:function(t,e,i,a,n){var r=this,s=this._yAxis.convertToPixel(i),c=e,o=s+(a?-2:2);this._ctx.textAlign="left",this._ctx.lineWidth=1,this._ctx.strokeStyle=t.color,this._ctx.fillStyle=t.color,Ot(this._ctx,(function(){r._ctx.beginPath(),r._ctx.moveTo(c,o),r._ctx.lineTo(c-2,o+(a?-2:2)),r._ctx.stroke(),r._ctx.closePath(),r._ctx.beginPath(),r._ctx.moveTo(c,o),r._ctx.lineTo(c+2,o+(a?-2:2)),r._ctx.stroke(),r._ctx.closePath()}));var h=o+(a?-5:5);Vt(this._ctx,c,o,h),Bt(this._ctx,h,c,c+5),this._ctx.font=Yt(t.textSize,t.textFamily);var l=W(i,n);this._ctx.textBaseline="middle",this._ctx.fillText(l,c+5+t.textMargin,h)}},{key:"_drawLastPriceLine",value:function(){var t=this._chartData.dataList(),e=t.length,i=this._chartData.styleOptions().candleStick.priceMark,a=i.last;if(i.display&&a.display&&a.line.display&&0!==e){var n=t[e-1],r=n.close,s=n.open,c=this._yAxis.convertToPixel(r);c=+Math.max(.05*this._height,Math.min(c,.98*this._height)).toFixed(0);var o=a.line;this._ctx.strokeStyle=r>s?a.upColor:s>r?a.downColor:a.noChangeColor,this._ctx.lineWidth=o.size,o.style===P&&this._ctx.setLineDash(o.dashValue),Bt(this._ctx,c,0,this._width),this._ctx.setLineDash([])}}}]),a}(Xt),te=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.apply(this,arguments)}return n(a,[{key:"_drawPrompt",value:function(t,e,i,a){var n=this._chartData.styleOptions().floatLayer.prompt.candleStick,r=this._getCandleStickPromptData(t,n);n.showType===V?(this._drawCandleStickStandardPromptText(n,r),this._additionalDataProvider.chartType()===E&&this._drawTechnicalIndicatorPrompt(e,i,a,n.text.size+n.text.marginTop)):this._drawCandleStickRectPromptText(t,e,i,a,n,r)}},{key:"_drawCandleStickStandardPromptText",value:function(t,e){var i=this,a=e,n=t.text.marginLeft,r=t.text.marginRight,s=t.text.size,c=t.text.color,o=t.labels;this._ctx.textBaseline="top",this._ctx.font=Yt(s,t.text.family);var h=n,l=t.text.marginTop;o.forEach((function(t,e){var s=t?"".concat(t,": "):"",o=Ht(i._ctx,s);i._ctx.fillStyle=c,i._ctx.fillText(s,h,l),h+=o;var u,_=a[e]||"--";g(_)?(u=_.value||"--",i._ctx.fillStyle=_.color||c):(i._ctx.fillStyle=c,u=_);var d=Ht(i._ctx,u);i._ctx.fillText(u,h,l),h+=d+n+r}))}},{key:"_drawCandleStickRectPromptText",value:function(t,e,i,a,n,r){var s=this,c=n.labels,o=r,h=n.text.marginLeft,l=n.text.marginRight,u=n.text.marginTop,_=n.text.marginBottom,d=n.text.size,v=n.text.color;this._ctx.textBaseline="top",this._ctx.font=Yt(d,n.text.family);var y=0;c.forEach((function(t,e){var i=o[e]||"--",a=i;g(i)&&(a=i.value||"--");var n="".concat(t,": ").concat(a),r=Ht(s._ctx,n)+h+l;y=Math.max(y,r)}));var f=n.rect,p=f.borderSize,x=f.paddingLeft,m=f.paddingRight,k=f.paddingTop,w=f.left,D=f.right,P=2*p+k+f.paddingBottom+(_+u+d)*c.length,M=vt(e,i,this._yAxis),S=this._chartData.styleOptions().floatLayer.prompt.technicalIndicator,T=S.text.marginLeft,b=S.text.marginRight,C=S.text.marginTop,A=S.text.marginBottom,L=S.text.size,I=this._additionalDataProvider.chartType()===E,z=M.labels||[],R=M.values||[];I&&(this._ctx.font=Yt(L,S.text.family),z.forEach((function(t,e){var i=R[e]||"--",a="".concat(t,": ").concat(i),n=Ht(s._ctx,a)+T+b;y=Math.max(y,n)})),P+=(C+A+L)*z.length);var H,Y=2*p+y+x+m;H=this._width/2>a?this._width-D-Y:w;var B=f.top,V=f.borderRadius;this._ctx.lineWidth=p,this._ctx.strokeStyle=f.borderColor,this._ctx.fillStyle=f.fillColor,this._drawRoundRect(H,B,Y,P,V),this._ctx.stroke(),this._drawRoundRect(H,B,Y,P,V),this._ctx.fill();var O=H+p+x+h,F=B+p+k;if(this._ctx.font=Yt(d,n.text.family),c.forEach((function(t,e){F+=u,s._ctx.textAlign="left",s._ctx.fillStyle=v,s._ctx.fillText("".concat(t,": "),O,F);var i,a=o[e]||"--";s._ctx.fillStyle=a.color||v,i=g(a)?a.value||"--":a,s._ctx.textAlign="right",s._ctx.fillText(i,H+Y-p-l-m,F),F+=d+_})),I){var G=this._chartData.styleOptions().technicalIndicator,W=G.line.colors,X=H+p+x+T,j=W.length;this._ctx.font=Yt(L,S.text.family),z.forEach((function(t,e){F+=C,s._ctx.textAlign="left",s._ctx.fillStyle=W[e%j]||G.text.color,s._ctx.fillText("".concat(t.toUpperCase(),": "),X,F),s._ctx.textAlign="right",s._ctx.fillText(R[e]||"--",H+Y-p-b-m,F),F+=L+A}))}this._ctx.textAlign="left"}},{key:"_drawRoundRect",value:function(t,e,i,a,n){this._ctx.beginPath(),this._ctx.moveTo(t+n,e),this._ctx.arcTo(t+i,e,t+i,e+a,n),this._ctx.arcTo(t+i,e+a,t,e+a,n),this._ctx.arcTo(t,e+a,t,e,n),this._ctx.arcTo(t,e,t+i,e,n),this._ctx.closePath()}},{key:"_getCandleStickPromptData",value:function(t,e){var i=this,a=e.values,n=[];if(a)n=m(a)?a(t)||[]:a;else{var r=this._chartData.pricePrecision(),s=this._chartData.volumePrecision();(n=[F(t,"timestamp"),F(t,"open"),F(t,"close"),F(t,"high"),F(t,"low"),F(t,"volume")]).forEach((function(t,e){switch(e){case 0:n[e]=G(t,"YYYY-MM-DD hh:mm",i._chartData.timezone());break;case n.length-1:n[e]=X(W(t,s));break;default:n[e]=W(t,r)}}))}return n}}]),a}(jt);function ee(t,e,i){var a=[];if(t&&e&&i.length>0){var n=t.x-e.x;if(0===n)i.forEach((function(t){a.push(t.y)}));else{var r=(t.y-e.y)/n,s=t.y-r*t.x;i.forEach((function(t){a.push(t.x*r+s)}))}}return a}function ie(t,e,i){return!!(i&&t&&e)&&(t.x===e.x?1>Math.abs(i.x-t.x):t.y===e.y?1>Math.abs(i.y-t.y):1>Math.abs(i.y-ee(t,e,[i])[0]))}function ae(t,e,i){return!!(i&&t&&e)&&(!!ie(t,e,i)&&(t.x===e.x?e.y>t.y?i.y>t.y-2:t.y+2>i.y:e.x>t.x?i.x>t.x-2:t.x+2>i.x))}function ne(t,e,i){return!!(i&&t&&e)&&(!!ie(t,e,i)&&2>Math.abs(Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2))+Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2))-Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))))}function re(t,e,i){if(!i)return!1;var a=i.x-t.x,n=i.y-t.y;return!(a*a+n*n>e*e)}function se(t,e,i){var a=[];if(t.length>1)if(t[0].x===t[1].x){var n=e.height;if(a.push([{x:t[0].x,y:0},{x:t[0].x,y:n}]),t.length>2&&(a.push([{x:t[2].x,y:0},{x:t[2].x,y:n}]),i)){var r=t[0].x-t[2].x;a.push([{x:t[0].x+r,y:0},{x:t[0].x+r,y:n}])}}else{var s=e.width;if(t[0].y===t[1].y){if(a.push([{x:0,y:t[0].y},{x:s,y:t[0].y}]),t.length>2&&(a.push([{x:0,y:t[2].y},{x:s,y:t[2].y}]),i)){var c=t[0].y-t[2].y;a.push([{x:0,y:t[0].y+c},{x:s,y:t[0].y+c}])}}else{var o=(t[0].y-t[1].y)/(t[0].x-t[1].x),h=t[0].y-o*t[0].x;if(a.push([{x:0,y:0*o+h},{x:s,y:s*o+h}]),t.length>2){var l=t[2].y-o*t[2].x;if(a.push([{x:0,y:0*o+l},{x:s,y:s*o+l}]),i){var u=h+(h-l);a.push([{x:0,y:0*o+u},{x:s,y:s*o+u}])}}}}return a}function ce(t,e){var i=[];if(t.length>0){var a=e.width;if(i.push([{x:0,y:t[0].y},{x:a,y:t[0].y}]),t.length>1){var n=t[0].y-t[1].y;i.push([{x:0,y:t[1].y+.786*n},{x:a,y:t[1].y+.786*n}]),i.push([{x:0,y:t[1].y+.618*n},{x:a,y:t[1].y+.618*n}]),i.push([{x:0,y:t[1].y+.5*n},{x:a,y:t[1].y+.5*n}]),i.push([{x:0,y:t[1].y+.382*n},{x:a,y:t[1].y+.382*n}]),i.push([{x:0,y:t[1].y+.236*n},{x:a,y:t[1].y+.236*n}]),i.push([{x:0,y:t[1].y},{x:a,y:t[1].y}])}}return i}var oe=0,he=2;function le(t){return t.getBoundingClientRect()||{left:0,top:0}}function ue(t){return!!t.touches}function _e(t){t.cancelable&&t.preventDefault()}var de=!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints||"ontouchstart"in window||!!(window.DocumentTouch&&document instanceof window.DocumentTouch),ve="onorientationchange"in window&&de;function ye(t,e){var i=t.clientX-e.clientX,a=t.clientY-e.clientY;return Math.sqrt(i*i+a*a)}var fe="mouse",pe="touch",xe=function(){function t(e,a,n){i(this,t),this._target=e,this._handler=a,this._options=n,this._clickCount=0,this._clickTimeoutId=null,this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartPosition=null,this._moveExceededManhattanDistance=!1,this._cancelClick=!1,this._unsubscribeOutsideEvents=null,this._unsubscribeMousemove=null,this._unsubscribeRoot=null,this._startPinchMiddlePoint=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventDragProcess=!1,this._mousePressed=!1,this._init()}return n(t,[{key:"destroy",value:function(){null!==this._unsubscribeOutsideEvents&&(this._unsubscribeOutsideEvents(),this._unsubscribeOutsideEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),this._clearLongTapTimeout(),this._resetClickTimeout()}},{key:"_mouseEnterHandler",value:function(t){var e=this;this._unsubscribeMousemove&&this._unsubscribeMousemove();var i=this._mouseMoveHandler.bind(this),a=this._mouseWheelHandler.bind(this);this._unsubscribeMousemove=function(){e._target.removeEventListener("mousemove",i),e._target.removeEventListener("wheel",a)},this._target.addEventListener("mousemove",i),this._target.addEventListener("wheel",a,{passive:!1}),ue(t)&&this._mouseMoveHandler(t);var n=this._makeCompatEvent(t);this._processEvent(n,this._handler.mouseEnterEvent)}},{key:"_resetClickTimeout",value:function(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null}},{key:"_mouseMoveHandler",value:function(t){if(!this._mousePressed||ue(t)){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseMoveEvent)}}},{key:"_mouseWheelHandler",value:function(t){var e=this._makeCompatEvent(t);t.localX=e.localX,t.localY=e.localY,this._processEvent(t,this._handler.mouseWheelEvent)}},{key:"_mouseMoveWithDownHandler",value:function(t){if((!("button"in t)||t.button===oe)&&null===this._startPinchMiddlePoint){var e=ue(t);if(!this._preventDragProcess||!e){this._pinchPrevented=!0;var i=this._makeCompatEvent(t),a=this._mouseMoveStartPosition,n=Math.abs(a.x-i.pageX),r=Math.abs(a.y-i.pageY),s=n+r>5;if(s||!e){if(s&&!this._moveExceededManhattanDistance&&e){var c=.5*n;r>=c&&!this._options.treatVertTouchDragAsPageScroll||c>r&&!this._options.treatHorzTouchDragAsPageScroll||(this._preventDragProcess=!0)}s&&(this._moveExceededManhattanDistance=!0,this._cancelClick=!0,e&&this._clearLongTapTimeout()),this._preventDragProcess||(this._processEvent(i,this._handler.pressedMouseMoveEvent),e&&_e(t))}}}}},{key:"_mouseUpHandler",value:function(t){if(!("button"in t)||t.button===oe){var e=this._makeCompatEvent(t);this._clearLongTapTimeout(),this._mouseMoveStartPosition=null,this._mousePressed=!1,this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),ue(t)&&this._mouseLeaveHandler(t),this._processEvent(e,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId&&this._clickCount>1?(this._processEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()):this._cancelClick||this._processEvent(e,this._handler.mouseClickEvent),ue(t)&&(_e(t),this._mouseLeaveHandler(t),0===t.touches.length&&(this._longTapActive=!1))}}},{key:"_clearLongTapTimeout",value:function(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}},{key:"_mouseDownHandler",value:function(t){if(!("button"in t)||t.button===oe||t.button===he){var e=this._makeCompatEvent(t);if("button"in t&&t.button===he)this._processEvent(e,this._handler.mouseRightDownEvent);else{this._cancelClick=!1,this._moveExceededManhattanDistance=!1,this._preventDragProcess=!1,ue(t)&&this._mouseEnterHandler(t),this._mouseMoveStartPosition={x:e.pageX,y:e.pageY},this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null);var i=this._mouseMoveWithDownHandler.bind(this),a=this._mouseUpHandler.bind(this),n=this._target.ownerDocument.documentElement;this._unsubscribeRoot=function(){n.removeEventListener("touchmove",i),n.removeEventListener("touchend",a),n.removeEventListener("mousemove",i),n.removeEventListener("mouseup",a)},n.addEventListener("touchmove",i,{passive:!1}),n.addEventListener("touchend",a,{passive:!1}),this._clearLongTapTimeout(),ue(t)&&1===t.touches.length?this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),600):(n.addEventListener("mousemove",i),n.addEventListener("mouseup",a)),this._mousePressed=!0,this._processEvent(e,this._handler.mouseDownEvent),this._clickTimeoutId||(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500))}}}},{key:"_init",value:function(){var t=this;this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));var e=this._target.ownerDocument,i=function(e){t._handler.mouseDownOutsideEvent&&(e.target&&t._target.contains(e.target)||t._handler.mouseDownOutsideEvent())};this._unsubscribeOutsideEvents=function(){e.removeEventListener("mousedown",i),e.removeEventListener("touchstart",i)},e.addEventListener("mousedown",i),e.addEventListener("touchstart",i,{passive:!0}),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._mouseDownHandler.bind(this),{passive:!0}),ve||this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",(function(){}),{passive:!1})}},{key:"_initPinch",value:function(){var t=this;void 0===this._handler.pinchStartEvent&&void 0===this._handler.pinchEvent&&void 0===this._handler.pinchEndEvent||(this._target.addEventListener("touchstart",(function(e){return t._checkPinchState(e.touches)}),{passive:!0}),this._target.addEventListener("touchmove",(function(e){if(2===e.touches.length&&null!==t._startPinchMiddlePoint&&void 0!==t._handler.pinchEvent){var i=ye(e.touches[0],e.touches[1]);t._handler.pinchEvent(t._startPinchMiddlePoint,i/t._startPinchDistance),_e(e)}}),{passive:!1}),this._target.addEventListener("touchend",(function(e){t._checkPinchState(e.touches)})))}},{key:"_checkPinchState",value:function(t){1===t.length&&(this._pinchPrevented=!1),2!==t.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(t)}},{key:"_startPinch",value:function(t){var e=le(this._target);this._startPinchMiddlePoint={x:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,y:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this._startPinchDistance=ye(t[0],t[1]),void 0!==this._handler.pinchStartEvent&&this._handler.pinchStartEvent(),this._clearLongTapTimeout()}},{key:"_stopPinch",value:function(){null!==this._startPinchMiddlePoint&&(this._startPinchMiddlePoint=null,void 0!==this._handler.pinchEndEvent&&this._handler.pinchEndEvent())}},{key:"_mouseLeaveHandler",value:function(t){this._unsubscribeMousemove&&this._unsubscribeMousemove();var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseLeaveEvent)}},{key:"_longTapHandler",value:function(t){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.longTapEvent),this._cancelClick=!0,this._longTapActive=!0}},{key:"_processEvent",value:function(t,e){e&&e.call(this._handler,t)}},{key:"_makeCompatEvent",value:function(t){var e;e="touches"in t&&t.touches.length?t.touches[0]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0]:t;var i=le(this._target);return{clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,localX:e.clientX-i.left,localY:e.clientY-i.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,type:t.type.startsWith("mouse")?fe:pe,target:e.target,view:t.view}}}]),t}();function me(t){return t.type===pe}function ge(t){return t.type===fe}var ke=function(){function t(e){i(this,t),this._chartData=e,this._seriesSize={}}return n(t,[{key:"_checkEventPointX",value:function(t){return t>0&&this._seriesSize.contentRight-this._seriesSize.contentLeft>t}},{key:"setSeriesSize",value:function(t){this._seriesSize=t}}]),t}(),we="step_1",De="step_2",Pe="step_3",Me="step_done",Se=function(t){s(r,t);var a=_(r);function r(t,e,n){var s;return i(this,r),(s=a.call(this,t))._xAxis=e,s._yAxis=n,s._noneGraphicMarkMouseDownFlag=!1,s._noneGraphicMarkMouseDownActiveData={markKey:null,dataIndex:-1,onLine:!1,onCircle:!1,pointIndex:-1},s}return n(r,[{key:"mouseUpEvent",value:function(t){this._chartData.setDragGraphicMarkFlag(!1),this._noneGraphicMarkMouseDownFlag=!1,this._noneGraphicMarkMouseDownActiveData={markKey:null,dataIndex:-1,onLine:!1,onCircle:!1,pointIndex:-1}}},{key:"mouseDownEvent",value:function(t){if(this._checkEventPointX(t.localX)&&this._checkEventPointY(t.localY)){this._chartData.setGraphicMarkPoint({x:t.localX,y:t.localY});var e=this._chartData.graphicMarkType();switch(e){case kt:case wt:case Dt:case Pt:case Mt:case St:case Tt:case bt:case Ct:case At:case It:this._twoStepGraphicMarkMouseDown(t,e);break;case Et:case Lt:this._threeStepGraphicMarkMouseDown(t,e);break;case gt:this._noneGraphicMarkMouseLeftDown(t)}}}},{key:"mouseRightDownEvent",value:function(t){if(this._chartData.graphicMarkType()===gt){this._findNoneGraphicMarkMouseDownActiveData(t);var e=this._noneGraphicMarkMouseDownActiveData.markKey,i=this._noneGraphicMarkMouseDownActiveData.dataIndex;if(e&&-1!==i){var a=this._chartData.graphicMarkData(),n=a[e];n.splice(i,1),a[e]=n,this._chartData.setGraphicMarkData(a),this.mouseUpEvent(t)}}}},{key:"_twoStepGraphicMarkMouseDown",value:function(t,e){var i=this;this._graphicMarkMouseDown(t,e,(function(t){switch(t.drawStep){case we:t.drawStep=De;break;case De:t.drawStep=Me,i._chartData.setGraphicMarkType(gt)}}))}},{key:"_threeStepGraphicMarkMouseDown",value:function(t,e){var i=this;this._graphicMarkMouseDown(t,e,(function(t){switch(t.drawStep){case we:t.drawStep=De;break;case De:t.drawStep=Pe;break;case Pe:t.drawStep=Me,i._chartData.setGraphicMarkType(gt)}}))}},{key:"_graphicMarkMouseDown",value:function(t,e,i){var a=this._chartData.graphicMarkData(),n=a[e];if(2===t.button)n.splice(n.length-1,1),this._chartData.setGraphicMarkType(gt);else{var r=n[n.length-1];i(r),n[n.length-1]=r}a[e]=n,this._chartData.setGraphicMarkData(a)}},{key:"_noneGraphicMarkMouseLeftDown",value:function(t){this._findNoneGraphicMarkMouseDownActiveData(t),this._noneGraphicMarkMouseDownActiveData.markKey&&-1!==this._noneGraphicMarkMouseDownActiveData.dataIndex&&this._noneGraphicMarkMouseDownActiveData.onCircle&&(this._noneGraphicMarkMouseDownFlag=!0,this._chartData.setDragGraphicMarkFlag(!0))}},{key:"_findNoneGraphicMarkMouseDownActiveData",value:function(t){for(var i=this,a={x:t.localX,y:t.localY},n=Object.keys(this._chartData.graphicMarkData()),r=function(t){var e=n[t];switch(e){case kt:case At:if(i._realFindNoneGraphicMarkMouseDownActiveData(e,a,(function(t){return ie(t[0],{x:i._seriesSize.contentRight,y:t[0].y},a)})))return{v:void 0};break;case wt:if(i._realFindNoneGraphicMarkMouseDownActiveData(e,a,(function(t){return ie(t[0],{x:t[0].x,y:i._seriesSize.tags[Ge].contentBottom},a)})))return{v:void 0};break;case Dt:if(i._realFindNoneGraphicMarkMouseDownActiveData(e,a,(function(t){return ie(t[0],t[1],a)})))return{v:void 0};break;case Pt:case Mt:case St:if(i._realFindNoneGraphicMarkMouseDownActiveData(e,a,(function(t){return ae(t[0],t[1],a)})))return{v:void 0};break;case Tt:case bt:case Ct:if(i._realFindNoneGraphicMarkMouseDownActiveData(e,a,(function(t){return ne(t[0],t[1],a)})))return{v:void 0};break;case Et:case Lt:case It:if(i._realFindNoneGraphicMarkMouseDownActiveData(e,a,(function(t){var n=[],r={width:i._seriesSize.contentRight,height:i._seriesSize.tags[Ge].contentBottom-i._seriesSize.tags[Ge].contentTop};switch(e){case Et:n=se(t,r,!0);break;case Lt:n=se(t,r);break;case It:n=ce(t,r)}for(var s=!1,c=0;n.length>c;c++){var o=n[c];if(s=ie(o[0],o[1],a))return s}return s})))return{v:void 0}}},s=0;n.length>s;s++){var c=r(s);if("object"===e(c))return c.v}}},{key:"_realFindNoneGraphicMarkMouseDownActiveData",value:function(t,e,i){var a=this,n=this._chartData.graphicMarkData()[t],r=this._chartData.styleOptions().graphicMark;return n.forEach((function(n,s){var c=[],o=!1,h=-1;n.points.forEach((function(t,i){var n=a._xAxis.convertToPixel(t.xPos),s=a._yAxis.convertToPixel(t.price);c.push({x:n,y:s});var l=re({x:n,y:s},r.point.radius,e);l&&(h=i),o||(o=l)}));var l=i(c,e);if(l||o)return a._noneGraphicMarkMouseDownActiveData={markKey:t,dataIndex:s,onLine:l,onCircle:o,pointIndex:h},!0})),!1}},{key:"mouseMoveEvent",value:function(t){if(this._checkEventPointX(t.localX)&&this._checkEventPointY(t.localY)){var e={x:t.localX,y:t.localY};if(this._chartData.setGraphicMarkPoint(e),!this._waitingForMouseMoveAnimationFrame){this._waitingForMouseMoveAnimationFrame=!0;var i=this._chartData.graphicMarkType();switch(i){case kt:case wt:case At:this._onePointGraphicMarkMouseMove(e,i);break;case Dt:case St:case Ct:case It:this._twoPointGraphicMarkMouseMove(e,i);break;case Pt:case Tt:this._twoPointGraphicMarkMouseMove(e,i,(function(t,e){t.points[0].price=e.price}));break;case Mt:case bt:this._twoPointGraphicMarkMouseMove(e,i,(function(t,e){t.points[0].xPos=e.xPos}));break;case Et:case Lt:this._threePointGraphicMarkMouseMove(e,i);break;case gt:this._chartData.setGraphicMarkData(this._chartData.graphicMarkData())}this._waitingForMouseMoveAnimationFrame=!1}}}},{key:"pressedMouseMoveEvent",value:function(t){var e=this._noneGraphicMarkMouseDownActiveData.markKey,i=this._noneGraphicMarkMouseDownActiveData.dataIndex;if(e&&-1!==i){var a=this._chartData.graphicMarkData(),n=a[e],r={x:t.localX,y:t.localY};switch(e){case kt:case wt:case At:case Dt:case St:case Ct:case Et:case Lt:case It:var s=this._noneGraphicMarkMouseDownActiveData.pointIndex;-1!==s&&(n[i].points[s].xPos=this._xAxis.convertFromPixel(r.x),n[i].points[s].price=this._yAxis.convertFromPixel(r.y));break;case Pt:case Tt:var c=this._noneGraphicMarkMouseDownActiveData.pointIndex;if(-1!==c){var o=this._yAxis.convertFromPixel(r.y);n[i].points[c].xPos=this._xAxis.convertFromPixel(r.x),n[i].points[0].price=o,n[i].points[1].price=o}break;case Mt:case bt:var h=this._noneGraphicMarkMouseDownActiveData.pointIndex;if(-1!==h){var l=this._xAxis.convertFromPixel(r.x);n[i].points[0].xPos=l,n[i].points[1].xPos=l,n[i].points[h].price=this._yAxis.convertFromPixel(r.y)}}a[e]=n,this._chartData.setGraphicMarkPoint({x:t.localX,y:t.localY}),this._chartData.setGraphicMarkData(a)}}},{key:"_onePointGraphicMarkMouseMove",value:function(t,e){var i=this;this._graphicMarkMouseMove(t,e,(function(e,a){var n=i._xAxis.convertFromPixel(t.x),r=i._yAxis.convertFromPixel(t.y);switch(a.drawStep){case Me:e.push({points:[{xPos:n,price:r}],drawStep:we});break;case we:case De:a.points[0].xPos=n,a.points[0].price=r,e[e.length-1]=a}}))}},{key:"_twoPointGraphicMarkMouseMove",value:function(t,e,i){var a=this;this._graphicMarkMouseMove(t,e,(function(e,n){var r=a._xAxis.convertFromPixel(t.x),s=a._yAxis.convertFromPixel(t.y);switch(n.drawStep){case Me:e.push({points:[{xPos:r,price:s},{xPos:r,price:s}],drawStep:we});break;case we:n.points[0]={xPos:r,price:s},n.points[1]={xPos:r,price:s},e[e.length-1]=n;break;case De:n.points[1]={xPos:r,price:s},m(i)&&i(n,{xPos:r,price:s}),e[e.length-1]=n}}))}},{key:"_threePointGraphicMarkMouseMove",value:function(t,e,i){var a=this;this._graphicMarkMouseMove(t,e,(function(e,n){var r=a._xAxis.convertFromPixel(t.x),s=a._yAxis.convertFromPixel(t.y);switch(n.drawStep){case Me:e.push({points:[{xPos:r,price:s},{xPos:r,price:s}],drawStep:we});break;case we:n.points[0]={xPos:r,price:s},n.points[1]={xPos:r,price:s},e[e.length-1]=n;break;case De:m(i)&&i(n,{xPos:r,price:s}),n.points[1]={xPos:r,price:s},e[e.length-1]=n;break;case Pe:n.points[2]={xPos:r,price:s},e[e.length-1]=n}}))}},{key:"_graphicMarkMouseMove",value:function(t,e,i){var a=this._chartData.graphicMarkData(),n=a[e];i(n,n[n.length-1]||{drawStep:Me}),a[e]=n,this._chartData.setGraphicMarkData(a)}},{key:"_checkEventPointY",value:function(t){var e=this._seriesSize.tags[Ge];return t>e.contentTop&&e.contentBottom>t}}]),r}(ke),Te=0,be=1,Ce=2,Ae=function(t){s(a,t);var e=_(a);function a(t,n,r,s){var c;return i(this,a),(c=e.call(this,t,n))._xAxis=r,c._yAxis=s,c}return n(a,[{key:"_draw",value:function(){var t=this._chartData.styleOptions().graphicMark,e=this._chartData.pricePrecision();this._drawHorizontalStraightLine(t),this._drawVerticalStraightLine(t),this._drawStraightLine(t),this._drawHorizontalRayLine(t),this._drawVerticalRayLine(t),this._drawRayLine(t),this._drawSegmentLine(t),this._drawPriceLine(t,e),this._drawPriceChannelLine(t),this._drawParallelStraightLine(t),this._drawFibonacciLine(t,e)}},{key:"_drawHorizontalStraightLine",value:function(t){var e=this;this._drawPointGraphicMark(kt,t,ie,(function(t){return[[{x:0,y:t[0].y},{x:e._width,y:t[0].y}]]}))}},{key:"_drawVerticalStraightLine",value:function(t){var e=this;this._drawPointGraphicMark(wt,t,ie,(function(t){return[[{x:t[0].x,y:0},{x:t[0].x,y:e._height}]]}))}},{key:"_drawStraightLine",value:function(t){var e=this;this._drawPointGraphicMark(Dt,t,ie,(function(t){if(t[0].x===t[1].x)return[[{x:t[0].x,y:0},{x:t[0].x,y:e._height}]];var i=ee(t[0],t[1],[{x:0,y:t[0].y},{x:e._width,y:t[0].y}]);return[[{x:0,y:i[0]},{x:e._width,y:i[1]}]]}))}},{key:"_drawHorizontalRayLine",value:function(t){var e=this;this._drawPointGraphicMark(Pt,t,ae,(function(t){var i={x:0,y:t[0].y};return t[1].x>t[0].x&&(i.x=e._width),[[t[0],i]]}))}},{key:"_drawVerticalRayLine",value:function(t){var e=this;this._drawPointGraphicMark(Mt,t,ae,(function(t){var i={x:t[0].x,y:0};return t[1].y>t[0].y&&(i.y=e._height),[[t[0],i]]}))}},{key:"_drawRayLine",value:function(t){var e=this;this._drawPointGraphicMark(St,t,ae,(function(t){var i;return i=t[0].x===t[1].x&&t[0].y!==t[1].y?t[1].y>t[0].y?{x:t[0].x,y:e._height}:{x:t[0].x,y:0}:t[0].x>t[1].x?{x:0,y:ee(t[0],t[1],[{x:0,y:t[0].y}])[0]}:{x:e._width,y:ee(t[0],t[1],[{x:e._width,y:t[0].y}])[0]},[[t[0],i]]}))}},{key:"_drawSegmentLine",value:function(t){this._drawPointGraphicMark(Tt,t,ne),this._drawPointGraphicMark(bt,t,ne),this._drawPointGraphicMark(Ct,t,ne)}},{key:"_drawPriceLine",value:function(t,e){var i=this;this._drawPointGraphicMark(At,t,ae,(function(t){return[[t[0],{x:i._width,y:t[0].y}]]}),!0,e)}},{key:"_drawPriceChannelLine",value:function(t){var e=this;this._drawPointGraphicMark(Et,t,ie,(function(t){return se(t,{width:e._width,height:e._height},!0)}))}},{key:"_drawParallelStraightLine",value:function(t){var e=this;this._drawPointGraphicMark(Lt,t,ie,(function(t){return se(t,{width:e._width,height:e._height})}))}},{key:"_drawFibonacciLine",value:function(t,e){var i=this;this._drawPointGraphicMark(It,t,ie,(function(t){return ce(t,{width:i._width,height:i._height})}),!0,e,["(100.0%)","(78.6%)","(61.8%)","(50.0%)","(38.2%)","(23.6%)","(0.0%)"])}},{key:"_drawPointGraphicMark",value:function(t,e,i,a,n,r,s){var c=this;this._chartData.graphicMarkData()[t].forEach((function(t){var o=t.drawStep,h=[];t.points.forEach((function(t){var e=t.price,i=c._xAxis.convertToPixel(t.xPos),a=c._yAxis.convertToPixel(e);h.push({x:i,y:a})}));var l=a?a(h):[h];c._drawGraphicMark(e,l,h,o,i,n,r,s)}))}},{key:"_drawGraphicMark",value:function(t,e,i,a,n,r,s){var c=this,o=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],h=this._chartData.graphicMarkPoint(),l=!1;e.forEach((function(e,i){if(e.length>1){var u=n(e[0],e[1],h);if(l||(l=u),a!==we){switch(c._ctx.strokeStyle=t.line.color,c._ctx.lineWidth=t.line.size,c._getLineType(e[0],e[1])){case Te:Ot(c._ctx,(function(){c._ctx.beginPath(),c._ctx.moveTo(e[0].x,e[0].y),c._ctx.lineTo(e[1].x,e[1].y),c._ctx.stroke(),c._ctx.closePath()}));break;case be:Bt(c._ctx,e[0].y,e[0].x,e[1].x);break;case Ce:Vt(c._ctx,e[0].x,e[0].y,e[1].y)}if(r){var _=W(c._yAxis.convertFromPixel(e[0].y),s);c._ctx.font=Yt(t.text.size,t.text.family),c._ctx.fillStyle=t.text.color,c._ctx.fillText("".concat(_," ").concat(o[i]||""),e[0].x+t.text.marginLeft,e[0].y-t.text.marginBottom)}}}}));for(var u=t.point.radius,_=!1,d=0;i.length>d&&!(_=re(i[d],u,h));d++);i.forEach((function(e){var i=re(e,u,h);if(_||l){var a=u,n=t.point.backgroundColor,r=t.point.borderColor,s=t.point.borderSize;i&&(a=t.point.activeRadius,n=t.point.activeBackgroundColor,r=t.point.activeBorderColor,s=t.point.activeBorderSize),c._ctx.fillStyle=n,c._ctx.beginPath(),c._ctx.arc(e.x,e.y,a,0,2*Math.PI),c._ctx.closePath(),c._ctx.fill(),c._ctx.lineWidth=s,c._ctx.strokeStyle=r,c._ctx.beginPath(),c._ctx.arc(e.x,e.y,a,0,2*Math.PI),c._ctx.closePath(),c._ctx.stroke()}}))}},{key:"_getLineType",value:function(t,e){return t.x===e.x?Ce:t.y===e.y?be:Te}}]),a}(Wt),Ee=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.apply(this,arguments)}return n(a,[{key:"_createMainView",value:function(t,e){return new Qt(t,e.chartData,e.xAxis,e.yAxis,e.additionalDataProvider)}},{key:"_createExpandView",value:function(t,e){return new Ae(t,e.chartData,e.xAxis,e.yAxis)}},{key:"_createFloatLayerView",value:function(t,e){return new te(t,e.chartData,e.xAxis,e.yAxis,e.additionalDataProvider)}},{key:"invalidate",value:function(t){t!==ft&&d(c(a.prototype),"invalidate",this).call(this,t),this._expandView.flush()}},{key:"setSize",value:function(t,e){d(c(a.prototype),"setSize",this).call(this,t,e),this._expandView.setSize(t,e)}}]),a}(Nt),Le=function(t){s(a,t);var e=_(a);function a(t){var n;return i(this,a),(n=e.call(this,t))._chartType=E,n}return n(a,[{key:"_createYAxis",value:function(t){return new $t(t.chartData,!0)}},{key:"_createMainWidget",value:function(t,e){return new Ee({container:t,chartData:e.chartData,xAxis:e.xAxis,yAxis:this._yAxis,additionalDataProvider:{technicalIndicator:this.technicalIndicator.bind(this),chartType:this.chartType.bind(this),tag:this.tag.bind(this)}})}},{key:"_isRealTime",value:function(){return this._chartType===A}},{key:"chartType",value:function(){return this._chartType}},{key:"setChartType",value:function(t){this._chartType!==t&&(this._chartType=t,this._chartData.calcTechnicalIndicator(this,this._chartData.technicalIndicator("AVERAGE")))}}]),a}(Jt),Ie=function(t){s(a,t);var e=_(a);function a(t,n,r){var s;return i(this,a),(s=e.call(this,t,n))._xAxis=r,s}return n(a,[{key:"_draw",value:function(){var t=this._chartData.styleOptions().xAxis;t.display&&(this._drawAxisLine(t),this._drawTickLines(t),this._drawTickLabels(t))}},{key:"_drawAxisLine",value:function(t){var e=t.axisLine;e.display&&(this._ctx.strokeStyle=e.color,this._ctx.lineWidth=e.size,Bt(this._ctx,0,0,this._width))}},{key:"_drawTickLines",value:function(t){var e=this,i=t.tickLine;if(i.display){this._ctx.lineWidth=i.size,this._ctx.strokeStyle=i.color;var a=t.axisLine.display?t.axisLine.size:0,n=a+i.length;this._xAxis.ticks().forEach((function(t){Vt(e._ctx,t.x,a,n)}))}}},{key:"_drawTickLabels",value:function(t){var e=t.tickText;if(e.display){var i=t.tickLine;this._ctx.textBaseline="top",this._ctx.font=Yt(e.size,e.family),this._ctx.textAlign="center",this._ctx.fillStyle=e.color;var a=e.margin;t.axisLine.display&&(a+=t.axisLine.size),i.display&&(a+=i.length);for(var n=this._xAxis.ticks(),r=n.length,s=0;r>s;s++)this._ctx.fillText(n[s].v,n[s].x,a)}}}]),a}(Wt),ze=function(t){s(a,t);var e=_(a);function a(t,n,r){var s;return i(this,a),(s=e.call(this,t,n))._xAxis=r,s}return n(a,[{key:"_draw",value:function(){this._drawCrossHairLabel()}},{key:"_drawCrossHairLabel",value:function(){if(this._chartData.crossHairSeriesTag()){var t=this._chartData.styleOptions().floatLayer.crossHair,e=t.vertical,i=e.text;if(t.display&&e.display&&i.display){var a,n=this._chartData.dataList(),r=this._chartData.crossHairPoint(),s=n[a=r?this._xAxis.convertFromPixel(r.x):n.length-1];if(s){var c=this._xAxis.convertToPixel(a),o=G(s.timestamp,"YYYY-MM-DD hh:mm",this._chartData.timezone()),h=i.size;this._ctx.font=Yt(h,i.family);var l=Ht(this._ctx,o),u=c-l/2,_=i.paddingLeft,d=i.paddingRight,v=i.paddingTop,y=i.borderSize;_+y>u?u=_+y:u>this._width-l-y-d&&(u=this._width-l-y-d);var f=u-y-_,p=u+l+y+d,x=0+h+2*y+v+i.paddingBottom;this._ctx.fillStyle=i.backgroundColor,this._ctx.fillRect(f,0,p-f,x-0),this._ctx.lineWidth=y,this._ctx.strokeStyle=i.borderColor,this._ctx.strokeRect(f,0,p-f,x-0),this._ctx.textBaseline="top",this._ctx.fillStyle=i.color,this._ctx.fillText(o,u,y+v)}}}}}]),a}(Wt),Re=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.apply(this,arguments)}return n(a,[{key:"_createMainView",value:function(t,e){return new Ie(t,e.chartData,e.xAxis)}},{key:"_createFloatLayerView",value:function(t,e){return new ze(t,e.chartData,e.xAxis)}}]),a}(Gt),He=function(t){s(a,t);var e=_(a);function a(t){var n;return i(this,a),(n=e.call(this,t))._initMeasureCanvas(),n}return n(a,[{key:"_initMeasureCanvas",value:function(){var t=document.createElement("canvas");this._measureCtx=t.getContext("2d");var e=Rt(this._measureCtx);this._measureCtx.scale(e,e)}},{key:"_computeMinMaxValue",value:function(){var t=this._chartData.from(),e=this._chartData.to()-1;return{min:t,max:e,range:e-t+1}}},{key:"_computeOptimalTicks",value:function(t){var e=[],i=t.length,a=this._chartData.dataList();if(i>0){var n=this._chartData.timezone(),r=this._chartData.styleOptions().xAxis.tickText;this._measureCtx.font=Yt(r.size,r.family);var s=Ht(this._measureCtx,"00-00 00:00"),c=this.convertToPixel(parseInt(t[0].v,10)),o=1;if(i>1){var h=this.convertToPixel(parseInt(t[1].v,10)),l=Math.abs(h-c);s>l&&(o=Math.ceil(s/l))}for(var u=0;i>u;u+=o){var _=parseInt(t[u].v,10),d=a[_].timestamp,v=G(d,"hh:mm",n);if(0!==u)v=this._optimalTickLabel(d,a[parseInt(t[u-o].v,10)].timestamp,n)||v;var y=this.convertToPixel(_);e.push({v:v,x:y,oV:d})}if(1===e.length)e[0].v=G(e[0].oV,"YYYY-MM-DD hh:mm",n);else{var f=e[0].oV,p=e[1].oV;if(e[2]){var x=e[2].v;/^[0-9]{2}-[0-9]{2}$/.test(x)?e[0].v=G(f,"MM-DD",n):/^[0-9]{4}-[0-9]{2}$/.test(x)?e[0].v=G(f,"YYYY-MM",n):/^[0-9]{4}$/.test(x)&&(e[0].v=G(f,"YYYY",n))}else e[0].v=this._optimalTickLabel(f,p,n)||e[0].v}}return e}},{key:"_optimalTickLabel",value:function(t,e,i){var a=G(t,"YYYY",i),n=G(t,"YYYY-MM",i),r=G(t,"MM-DD",i);return a!==G(e,"YYYY",i)?a:n!==G(e,"YYYY-MM",i)?n:r!==G(e,"MM-DD",i)?r:null}},{key:"convertFromPixel",value:function(t){return Math.round(this._chartData.coordinateToFloatIndex(t))-1}},{key:"convertToPixel",value:function(t){var e=this._chartData.dataList().length,i=this._chartData.dataSpace(),a=e+this._chartData.offsetRightBarCount()-t;return this._width-(a-.5)*i+this._chartData.barSpace()/2}}]),a}(qt),Ye=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.apply(this,arguments)}return n(a,[{key:"_initBefore",value:function(){this._xAxis=new He(this._chartData)}},{key:"_createMainWidget",value:function(t,e){return new Re({container:t,chartData:e.chartData,xAxis:this._xAxis})}},{key:"_computeAxis",value:function(){this._xAxis.computeAxis()}},{key:"xAxis",value:function(){return this._xAxis}},{key:"setSize",value:function(t,e){this._xAxis.setSize(t.width,t.height),this._computeAxis(),d(c(a.prototype),"setSize",this).call(this,t,e)}}]),a}(Ft),Be=function(){function t(e,a,n,r,s){i(this,t),this._chartData=a,this._seriesIndex=n,this._width=0,this._offsetLeft=0,this._dragEventHandler=s,this._initElement(e,r)}return n(t,[{key:"_initElement",value:function(t,e){this._container=t,this._wrapper=document.createElement("div"),this._wrapper.style.margin="0",this._wrapper.style.padding="0",this._wrapper.style.overflow="hidden",this._element=document.createElement("div"),this._element.style.margin="0",this._element.style.padding="0",this._element.style.width="100%",this._element.style.position="absolute",this._element.style.zIndex="20",this._element.style.height="5px",e&&(this._element.style.cursor="ns-resize",this._dragEvent=new xe(this._element,{mouseDownEvent:this._mouseDownEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this)},{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0})),this._wrapper.appendChild(this._element);var i=t.lastChild;i?t.insertBefore(this._wrapper,i):t.appendChild(this._wrapper)}},{key:"_mouseDownEvent",value:function(t){this._startY=t.pageY,this._dragEventHandler.startDrag(this._seriesIndex)}},{key:"_pressedMouseMoveEvent",value:function(t){this._dragEventHandler.drag(t.pageY-this._startY,this._seriesIndex)}},{key:"height",value:function(){return this._wrapper.offsetHeight}},{key:"setSize",value:function(t,e){this._offsetLeft=t,this._width=e,this.invalidate()}},{key:"updateSeriesIndex",value:function(t){this._seriesIndex=t}},{key:"invalidate",value:function(){var t=this._chartData.styleOptions().separator;this._wrapper.style.backgroundColor=t.color,this._wrapper.style.height="".concat(t.size,"px"),this._wrapper.style.marginLeft="".concat(t.fill?0:this._offsetLeft,"px"),this._wrapper.style.width=t.fill?"100%":"".concat(this._width,"px")}},{key:"getImage",value:function(){var t=this._chartData.styleOptions().separator,e=document.createElement("canvas"),i=e.getContext("2d"),a=Rt(i),n=this._wrapper.offsetWidth,r=t.size;return e.style.width="".concat(n,"px"),e.style.height="".concat(r,"px"),e.width=n*a,e.height=r*a,i.scale(a,a),i.fillStyle=t.color,i.fillRect(this._offsetLeft,0,n,r),e}},{key:"destroy",value:function(){this._dragEvent&&this._dragEvent.destroy(),this._container.removeChild(this._wrapper)}}]),t}(),Ve=function(t){s(a,t);var e=_(a);function a(t){var n;return i(this,a),(n=e.call(this,t))._startScrollPoint={},n._touchPoint={},n._touchCancelCrossHair=!1,n._touchZoomed=!1,n._pinchScale=1,n}return n(a,[{key:"pinchStartEvent",value:function(){this._pinchScale=1,this._touchZoomed=!0}},{key:"pinchEvent",value:function(t,e){var i=5*(e-this._pinchScale);this._pinchScale=e,this._chartData.zoom(i,t)}},{key:"mouseLeaveEvent",value:function(t){ge(t)&&this._chartData.setCrossHairSeriesTag(null)}},{key:"mouseMoveEvent",value:function(t){if(ge(t))if(this._checkEventPointX(t.localX)){var e=this._translateCrossHairRealY(t.localY);e?(this._chartData.setCrossHairPoint({x:t.localX,y:e.y}),this._chartData.setCrossHairSeriesTag(e.tag)):this._chartData.setCrossHairSeriesTag(null)}else this._chartData.setCrossHairSeriesTag(null)}},{key:"mouseWheelEvent",value:function(t){if(this._checkEventPointX(t.localX)){var e=-t.deltaY/100;if(0!==e){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:e*=120;break;case t.DOM_DELTA_LINE:e*=32}if(0!==e){var i=Math.sign(e)*Math.min(1,Math.abs(e));this._chartData.zoom(i,{x:t.localX,y:t.localY})}}}}},{key:"mouseClickEvent",value:function(t){if(me(t)&&this._checkEventPointX(t.localX)){var e=this._translateCrossHairRealY(t.localY);e&&(this._touchPoint||this._touchCancelCrossHair||this._touchZoomed||(this._touchPoint={x:t.localX,y:t.localY},this._chartData.setCrossHairPoint({x:t.localX,y:e.y}),this._chartData.setCrossHairSeriesTag(e.tag)))}}},{key:"mouseDownEvent",value:function(t){if(this._startScrollPoint={x:t.localX,y:t.localY},this._chartData.startScroll(),me(t)&&this._checkEventPointX(t.localX)){var e=this._translateCrossHairRealY(t.localY);if(e){var i={x:t.localX,y:e.y};if(this._touchZoomed=!1,this._touchPoint){var a=t.localX-this._touchPoint.x,n=t.localY-this._touchPoint.y;10>Math.sqrt(a*a+n*n)?(this._touchPoint={x:t.localX,y:t.localY},this._chartData.setCrossHairPoint(i),this._chartData.setCrossHairSeriesTag(e.tag)):(this._touchCancelCrossHair=!0,this._touchPoint=null,this._chartData.setCrossHairPoint(i),this._chartData.setCrossHairSeriesTag(null))}else this._touchCancelCrossHair=!1}}}},{key:"pressedMouseMoveEvent",value:function(t){if(this._checkEventPointX(t.localX)){var e=this._translateCrossHairRealY(t.localY);if(e){var i={x:t.localX,y:e.y};if(me(t)&&this._touchPoint)return this._touchPoint={x:t.localX,y:t.localY},this._chartData.setCrossHairPoint(i),void this._chartData.setCrossHairSeriesTag(e.tag);var a=t.localX-this._startScrollPoint.x;this._chartData.setCrossHairPoint(i),this._chartData.scroll(a)}}}},{key:"longTapEvent",value:function(t){if(me(t)&&this._checkEventPointX(t.localX)){var e=this._translateCrossHairRealY(t.localY);e&&(this._touchPoint={x:t.localX,y:t.localY},this._chartData.setCrossHairPoint({x:t.localX,y:e.y}),this._chartData.setCrossHairSeriesTag(e.tag))}}},{key:"_translateCrossHairRealY",value:function(t){var e=this._seriesSize.tags||{};for(var i in e){var a=e[i];if(t>a.contentTop&&a.contentBottom>t)return{tag:i,y:t-a.contentTop}}return null}}]),a}(ke),Oe=function(t){s(a,t);var e=_(a);function a(){return i(this,a),e.apply(this,arguments)}return n(a,[{key:"keyBoardDownEvent",value:function(t){if(t.shiftKey)switch(t.code){case"ArrowUp":this._chartData.zoom(-.5,this._chartData.crossHairPoint());break;case"ArrowDown":this._chartData.zoom(.5,this._chartData.crossHairPoint());break;case"ArrowLeft":this._chartData.startScroll(),this._chartData.scroll(-this._chartData.dataSpace());break;case"ArrowRight":this._chartData.startScroll(),this._chartData.scroll(this._chartData.dataSpace())}}}]),a}(ke),Fe=function(){function t(e,a,n,r){i(this,t),this._target=e,this._chartData=a,this._seriesSize={},this._event=new xe(this._target,{pinchStartEvent:this._pinchStartEvent.bind(this),pinchEvent:this._pinchEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this),mouseClickEvent:this._mouseClickEvent.bind(this),mouseDownEvent:this._mouseDownEvent.bind(this),mouseRightDownEvent:this._mouseRightDownEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this),mouseMoveEvent:this._mouseMoveEvent.bind(this),mouseWheelEvent:this._mouseWheelEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),longTapEvent:this._longTapEvent.bind(this)},{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!1}),this._boundKeyBoardDownEvent=this._keyBoardDownEvent.bind(this),this._target.addEventListener("keydown",this._boundKeyBoardDownEvent),this._boundContextMenuEvent=function(t){t.preventDefault()},this._target.addEventListener("contextmenu",this._boundContextMenuEvent,!1),this._zoomScrollEventHandler=new Ve(a),this._graphicMarkEventHandler=new Se(a,n,r),this._keyBoardEventHandler=new Oe(a)}return n(t,[{key:"_keyBoardDownEvent",value:function(t){this._keyBoardEventHandler.keyBoardDownEvent(t)}},{key:"_pinchStartEvent",value:function(){this._zoomScrollEventHandler.pinchStartEvent()}},{key:"_pinchEvent",value:function(t,e){this._zoomScrollEventHandler.pinchEvent(t,e)}},{key:"_mouseUpEvent",value:function(t){this._target.style.cursor="crosshair",t.localX-=this._seriesSize.contentLeft,this._graphicMarkEventHandler.mouseUpEvent(t)}},{key:"_mouseLeaveEvent",value:function(t){this._checkZoomScroll()&&(t.localX-=this._seriesSize.contentLeft,this._zoomScrollEventHandler.mouseLeaveEvent(t))}},{key:"_mouseMoveEvent",value:function(t){t.localX-=this._seriesSize.contentLeft,this._chartData.shouldInvalidateGraphicMark()&&this._graphicMarkEventHandler.mouseMoveEvent(t),this._checkZoomScroll()&&this._zoomScrollEventHandler.mouseMoveEvent(t)}},{key:"_mouseWheelEvent",value:function(t){this._checkZoomScroll()&&this._zoomScrollEventHandler.mouseWheelEvent(t)}},{key:"_mouseClickEvent",value:function(t){this._checkZoomScroll()&&(t.localX-=this._seriesSize.contentLeft,this._zoomScrollEventHandler.mouseClickEvent(t))}},{key:"_mouseDownEvent",value:function(t){this._target.style.cursor="pointer",t.localX-=this._seriesSize.contentLeft,this._graphicMarkEventHandler.mouseDownEvent(t),this._checkZoomScroll()&&this._zoomScrollEventHandler.mouseDownEvent(t)}},{key:"_mouseRightDownEvent",value:function(t){t.localX-=this._seriesSize.contentLeft,this._graphicMarkEventHandler.mouseRightDownEvent(t)}},{key:"_pressedMouseMoveEvent",value:function(t){t.localX-=this._seriesSize.contentLeft,this._chartData.dragGraphicMarkFlag()&&(this._graphicMarkEventHandler.pressedMouseMoveEvent(t),null!==this._chartData.crossHairSeriesTag()&&this._chartData.setCrossHairSeriesTag(null)),this._checkZoomScroll()&&this._zoomScrollEventHandler.pressedMouseMoveEvent(t)}},{key:"_longTapEvent",value:function(t){this._checkZoomScroll()&&(t.localX-=this._seriesSize.contentLeft,this._zoomScrollEventHandler.longTapEvent(t))}},{key:"_checkZoomScroll",value:function(){return!this._chartData.dragGraphicMarkFlag()&&this._chartData.graphicMarkType()===gt}},{key:"setSeriesSize",value:function(t){this._seriesSize=t,this._zoomScrollEventHandler.setSeriesSize(t),this._graphicMarkEventHandler.setSeriesSize(t)}},{key:"destroy",value:function(){this._event.destroy(),this._target.removeEventListener("keydown",this._boundKeyBoardDownEvent),this._target.removeEventListener("contextmenu",this._boundContextMenuEvent)}}]),t}(),Ge="candle_stick_series_tag",We=function(){function t(e,a){i(this,t),this._initChartContainer(e),this._technicalIndicatorBaseId=0,this._technicalIndicatorSeries=[],this._separatorSeries=[],this._separatorDragStartTechnicalIndicatorHeight=0,this._chartData=new zt(a,this._updateSeries.bind(this)),this._xAxisSeries=new Ye({container:this._chartContainer,chartData:this._chartData}),this._candleStickSeries=new Le({container:this._chartContainer,chartData:this._chartData,xAxis:this._xAxisSeries.xAxis(),technicalIndicatorType:"MA",tag:Ge}),this._chartEvent=new Fe(this._chartContainer,this._chartData,this._xAxisSeries.xAxis(),this._candleStickSeries.yAxis()),this.measureSeriesSize()}return n(t,[{key:"_initChartContainer",value:function(t){this._container=t,this._chartContainer=document.createElement("div"),this._chartContainer.style.userSelect="none",this._chartContainer.style.webkitUserSelect="none",this._chartContainer.style.msUserSelect="none",this._chartContainer.style.MozUserSelect="none",this._chartContainer.style.webkitTapHighlightColor="transparent",this._chartContainer.style.position="relative",this._chartContainer.style.outline="none",this._chartContainer.style.borderStyle="none",this._chartContainer.style.width="100%",this._chartContainer.style.cursor="crosshair",this._chartContainer.tabIndex=1,t.appendChild(this._chartContainer)}},{key:"_separatorStartDrag",value:function(t){this._separatorDragStartTechnicalIndicatorHeight=this._technicalIndicatorSeries[t].height()}},{key:"_separatorDrag",value:function(t,e){var i=this._separatorDragStartTechnicalIndicatorHeight-t;0>i&&(i=0),this._technicalIndicatorSeries[e].setHeight(i),this.measureSeriesSize()}},{key:"_measureXAxisHeight",value:function(){var t=this._chartData.styleOptions().xAxis,e=t.axisLine,i=t.tickText,a=t.tickLine,n=0;return t.display&&(e.display&&(n+=e.size),a.display&&(n+=a.length),i.display&&(n+=i.size+i.margin)),n>0&&(n=Math.ceil(Math.max(t.minHeight,Math.min(n,t.maxHeight)))),n}},{key:"_measureYAxisWidth",value:function(){var t=this._chartData.styleOptions().yAxis,e=t.tickText,i=0;return t.display&&(t.axisLine.display&&(i+=t.axisLine.size),t.tickLine.display&&(i+=t.tickLine.length),t.tickText.display&&(i+=e.margin+6*(e.size-2))),i>0&&(i=Math.ceil(Math.max(t.minWidth,Math.min(i,t.maxWidth)))),i}},{key:"_measureSeparatorHeight",value:function(){return this._chartData.styleOptions().separator.size*this._separatorSeries.length}},{key:"_updateSeries",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:mt;if(t!==ft){this._xAxisSeries.invalidate(t);var e,i=y(this._technicalIndicatorSeries);try{for(i.s();!(e=i.n()).done;){var a=e.value;a.invalidate(t)}}catch(t){i.e(t)}finally{i.f()}}this._candleStickSeries.invalidate(t)}},{key:"_calcAllSeriesTechnicalIndicator",value:function(){var t,e=[];this._candleStickSeries.chartType()===E?(t=this._candleStickSeries.technicalIndicator().name,e.push(t)):t="AVERAGE",this._chartData.calcTechnicalIndicator(this._candleStickSeries,t);var i,a=y(this._technicalIndicatorSeries);try{for(a.s();!(i=a.n()).done;){var n=i.value,r=n.technicalIndicator().name;0>e.indexOf(r)?(e.push(r),this._chartData.calcTechnicalIndicator(n,r)):n.invalidate(mt)}}catch(t){a.e(t)}finally{a.f()}}},{key:"chartData",value:function(){return this._chartData}},{key:"measureSeriesSize",value:function(){var t=this._chartData.styleOptions().yAxis,e=t.position===M,i=t.tickText.position===C,a=this._container.offsetWidth,n=this._container.offsetHeight,r=this._measureSeparatorHeight(),s=this._measureXAxisHeight(),c=this._measureYAxisWidth(),o=n-s-r,h=a-(i?c:0),l=a-c,u=0;e&&(l=0,i&&(u=c));var _,d=0,v=y(this._technicalIndicatorSeries);try{for(v.s();!(_=v.n()).done;){var f=_.value,p=f.height();if((d+=p)>o){var x=d-o;d=o,f.setHeight(p-x)}}}catch(t){v.e(t)}finally{v.f()}var m=o-d;this._chartData.setTotalDataSpace(h);var g={};g.contentLeft=u,g.contentRight=u+h;var k={};k[Ge]={contentTop:0,contentBottom:m};var w=m,D=m;this._candleStickSeries.setSize({left:u,width:h,height:m},{left:l,width:c,height:m});for(var P=0;this._technicalIndicatorSeries.length>P;P++){var S=this._technicalIndicatorSeries[P],T=this._separatorSeries[P],b=S.height();S.setSize({left:u,width:h,height:b},{left:l,width:c,height:b}),T.setSize(u,h),D+=b,k[S.tag()]={contentTop:w,contentBottom:D},w=D}g.tags=k,this._xAxisSeries.setSize({left:u,width:h,height:s},{left:l,width:c,height:s}),this._chartEvent.setSeriesSize(g)}},{key:"applyTechnicalIndicatorParams",value:function(t,e){this._chartData.applyTechnicalIndicatorParams(t,e);var i=[];this._candleStickSeries.technicalIndicatorType()===t&&i.push(this._candleStickSeries);var a,n=y(this._technicalIndicatorSeries);try{for(n.s();!(a=n.n()).done;){var r=a.value;r.technicalIndicatorType()===t&&i.push(r)}}catch(t){n.e(t)}finally{n.f()}this._chartData.calcTechnicalIndicator(i,t)}},{key:"_applyDataList",value:function(t,e,i){x(t)&&(m(i)&&i(),this._chartData.addData(t,0,e),this._xAxisSeries.invalidate(mt),this._calcAllSeriesTechnicalIndicator())}},{key:"applyNewData",value:function(t,e){var i=this;this._applyDataList(t,e,(function(){i._chartData.clearDataList()}))}},{key:"applyMoreData",value:function(t,e){this._applyDataList(t,e)}},{key:"updateData",value:function(t){if(g(t)&&!x(t)){var e=this._chartData.dataList(),i=e.length,a=i;+F(t,"timestamp",0)===+F(e[i-1],"timestamp",0)&&(a=i-1),this._chartData.addData(t,a),this._xAxisSeries.invalidate(a===i-1?yt:mt),this._calcAllSeriesTechnicalIndicator()}}},{key:"setCandleStickSeriesType",value:function(t){this._candleStickSeries.setChartType(t)}},{key:"createTechnicalIndicator",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,i=arguments.length>2?arguments[2]:void 0;t&&this._chartData.technicalIndicator(t)&&"NO"!==t&&"AVERAGE"!==t||(t="MACD");var a=this._technicalIndicatorSeries.length,n=!D(i)||i;this._separatorSeries.push(new Be(this._chartContainer,this._chartData,a,n,{startDrag:this._separatorStartDrag.bind(this),drag:this._separatorDrag.bind(this)})),this._technicalIndicatorBaseId++;var r="".concat("technical_indicator_").concat(this._technicalIndicatorBaseId),s=new Jt({container:this._chartContainer,chartData:this._chartData,xAxis:this._xAxisSeries.xAxis(),technicalIndicatorType:t,tag:r});return s.setHeight(e),this._technicalIndicatorSeries.push(s),this.measureSeriesSize(),r}},{key:"removeTechnicalIndicator",value:function(t){for(var e=-1,i=0;this._technicalIndicatorSeries.length>i;i++){if(this._technicalIndicatorSeries[i].tag()===t){e=i;break}}if(-1!==e){this._technicalIndicatorSeries[e].destroy(),this._separatorSeries[e].destroy(),this._technicalIndicatorSeries.splice(e,1),this._separatorSeries.splice(e,1);for(var a=0;this._separatorSeries.length>a;a++)this._separatorSeries[a].updateSeriesIndex(a);this.measureSeriesSize()}}},{key:"setTechnicalIndicatorType",value:function(t,e){if(t===Ge)this._candleStickSeries.setTechnicalIndicatorType(e);else{var i,a,n=y(this._technicalIndicatorSeries);try{for(n.s();!(a=n.n()).done;){var r=a.value;if(r.tag()===t){i=r;break}}}catch(t){n.e(t)}finally{n.f()}i&&("NO"===e?this.removeTechnicalIndicator(t):i.setTechnicalIndicatorType(e))}}},{key:"setTimezone",value:function(t){this._chartData.setTimezone(t),this._xAxisSeries.invalidate(mt)}},{key:"getConvertPictureUrl",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"jpeg",a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"#333333";if("png"!==i&&"jpeg"!==i&&"bmp"!==i)throw Error("Picture format only supports jpeg, png and bmp!!!");var n=document.createElement("canvas"),r=n.getContext("2d"),s=Rt(r),c=this._chartContainer.offsetWidth,o=this._chartContainer.offsetHeight;n.style.width="".concat(c,"px"),n.style.height="".concat(o,"px"),n.width=c*s,n.height=o*s,r.scale(s,s),r.fillStyle=a,r.fillRect(0,0,c,o);var h=0,l=this._candleStickSeries.height();r.drawImage(this._candleStickSeries.getImage(t,e),0,h,c,l),h+=l;for(var u=0;this._separatorSeries.length>u;u++){var _=this._separatorSeries[u],d=_.height(),v=this._technicalIndicatorSeries[u],y=v.height();r.drawImage(_.getImage(),0,h,c,d),h+=d,r.drawImage(v.getImage(t),0,h,c,y),h+=y}return r.drawImage(this._xAxisSeries.getImage(t),0,h,c,this._xAxisSeries.height()),n.toDataURL("image/".concat(i))}},{key:"destroy",value:function(){this._candleStickSeries.destroy(),this._technicalIndicatorSeries.forEach((function(t){t.destroy()})),this._separatorSeries.forEach((function(t){t.destroy()})),this._xAxisSeries.destroy(),this._container.removeChild(this._chartContainer),this._chartEvent.destroy()}}]),t}(),Xe=function(){function t(e,a){i(this,t),this._chartSeries=new We(e,a)}return n(t,[{key:"setStyleOptions",value:function(t){this._chartSeries.chartData().applyStyleOptions(t),this._chartSeries.measureSeriesSize()}},{key:"getStyleOptions",value:function(){return p(this._chartSeries.chartData().styleOptions())}},{key:"setTechnicalIndicatorParams",value:function(t,e){this._chartSeries.applyTechnicalIndicatorParams(t,e)}},{key:"getTechnicalIndicatorParamOptions",value:function(){return p(this._chartSeries.chartData().technicalIndicatorParamOptions())}},{key:"setPrecision",value:function(t,e){this._chartSeries.chartData().applyPrecision(t,e)}},{key:"setTimezone",value:function(t){this._chartSeries.setTimezone(t)}},{key:"resize",value:function(){this._chartSeries.measureSeriesSize()}},{key:"setOffsetRightSpace",value:function(t){this._chartSeries.chartData().setOffsetRightSpace(t)}},{key:"setLeftMinVisibleBarCount",value:function(t){this._chartSeries.chartData().setLeftMinVisibleBarCount(t)}},{key:"setRightMinVisibleBarCount",value:function(t){this._chartSeries.chartData().setRightMinVisibleBarCount(t)}},{key:"setDataSpace",value:function(t){this._chartSeries.chartData().setDataSpace(t)}},{key:"clearData",value:function(){this._chartSeries.chartData().clearDataList()}},{key:"getDataList",value:function(){return this._chartSeries.chartData().dataList()}},{key:"applyNewData",value:function(t,e){this._chartSeries.applyNewData(t,e)}},{key:"applyMoreData",value:function(t,e){this._chartSeries.applyMoreData(t,e)}},{key:"updateData",value:function(t){this._chartSeries.updateData(t)}},{key:"loadMore",value:function(t){this._chartSeries.chartData().loadMore(t)}},{key:"setCandleStickChartType",value:function(t){this._chartSeries.setCandleStickSeriesType(t)}},{key:"setCandleStickTechnicalIndicatorType",value:function(t){this._chartSeries.setTechnicalIndicatorType(Ge,t)}},{key:"setTechnicalIndicatorType",value:function(t,e){this._chartSeries.setTechnicalIndicatorType(t,e)}},{key:"addTechnicalIndicator",value:function(t,e,i){return this._chartSeries.createTechnicalIndicator(t,e,i)}},{key:"removeTechnicalIndicator",value:function(t){this._chartSeries.removeTechnicalIndicator(t)}},{key:"addGraphicMark",value:function(t){var e=this._chartSeries.chartData().graphicMarkType();if(e!==t){var i=this._chartSeries.chartData().graphicMarkData(),a=i[e];a&&x(a)&&(a.splice(a.length-1,1),i[e]=a),i.hasOwnProperty(t)||(t=gt),this._chartSeries.chartData().setGraphicMarkType(t),this._chartSeries.chartData().setGraphicMarkData(i)}}},{key:"removeAllGraphicMark",value:function(){var t=this._chartSeries.chartData().graphicMarkData(),e={};Object.keys(t).forEach((function(t){e[t]=[]})),this._chartSeries.chartData().setGraphicMarkType(gt),this._chartSeries.chartData().setGraphicMarkData(e)}},{key:"getConvertPictureUrl",value:function(t,e,i,a){return this._chartSeries.getConvertPictureUrl(t,e,i,a)}},{key:"destroy",value:function(){this._chartSeries.destroy()}}]),t}(),je={},Ne=1;t.dispose=function(t){var e;t&&("string"==typeof t&&(e=(t=document.getElementById(t)||document.getElementsByClassName(t)).chartId),e||(e=t.chartId),!e&&t instanceof Xe&&(e=t.id),e&&(je[e].destroy(),delete je[e]))},t.init=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i="Chart version is 5.2.2. Root dom is null, can not initialize the chart!!!",a=t;if(!a)throw Error(i);if("string"==typeof a&&(a=document.getElementById(t)||document.getElementsByClassName(t)),!a)throw Error(i);var n=je[a.chartId||""];if(n)return n;var r="".concat("k_line_chart_").concat(Ne++),s=new Xe(a,e);return s.id=r,a.chartId=r,je[r]=s,s},t.version=function(){return"5.2.2"},Object.defineProperty(t,"__esModule",{value:!0})}));
