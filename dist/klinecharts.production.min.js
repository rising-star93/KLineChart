!function(t,i){"object"==typeof exports&&"undefined"!=typeof module?i(exports):"function"==typeof define&&define.amd?define(["exports"],i):i((t=t||self).klinecharts={})}(this,(function(t){"use strict";function i(t){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function e(t,i){if(!(t instanceof i))throw new TypeError("Cannot call a class as a function")}function a(t,i){for(var e=0;i.length>e;e++){var a=i[e];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function n(t,i,e){return i&&a(t.prototype,i),e&&a(t,e),t}function s(t,i,e){return i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t}function r(t,i){if("function"!=typeof i&&null!==i)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(i&&i.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),i&&o(t,i)}function c(t){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function o(t,i){return(o=Object.setPrototypeOf||function(t,i){return t.__proto__=i,t})(t,i)}function h(t,i){return!i||"object"!=typeof i&&"function"!=typeof i?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):i}function l(t,i,e){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,i,e){var a=function(t,i){for(;!Object.prototype.hasOwnProperty.call(t,i)&&null!==(t=c(t)););return t}(t,i);if(a){var n=Object.getOwnPropertyDescriptor(a,i);return n.get?n.get.call(e):n.value}})(t,i,e||t)}function u(t){if(!t||!d(t))return t;var i,e,a;for(e in i=_(t)?[]:{},t)t.hasOwnProperty(e)&&(i[e]=(a=t[e])&&d(a)?u(a):a);return i}function _(t){return"[object Array]"===Object.prototype.toString.call(t)}function d(t){var e=i(t);return"function"===e||!!t&&"object"===e}function v(t){return"number"==typeof t&&!isNaN(t)}var f,p,x="dash",y="left",m="right",g="inside",k="outside",T={REAL_TIME:"real_time",CANDLE:"candle"},D="solid",b="stroke",L="increasing_stroke",w="decreasing_stroke",S="ohlc",M="always",P="follow_cross",A="standard",E={grid:{display:!0,horizontal:{display:!0,size:1,color:"#393939",style:x,dashValue:[2,2]},vertical:{display:!0,size:1,color:"#393939",style:x,dashValue:[2,2]}},candleStick:{bar:{style:D,upColor:"#26A69A",downColor:"#EF5350"},priceMark:{display:!0,high:{display:!0,color:"#D9D9D9",textMargin:5,textSize:10},low:{display:!0,color:"#D9D9D9",textMargin:5,textSize:10},last:{display:!0,upColor:"#26A69A",downColor:"#EF5350",line:{display:!0,style:x,dashValue:[4,4],size:1},text:{display:!0,size:12,paddingLeft:2,paddingTop:2,paddingRight:2,paddingBottom:2,color:"#FFFFFF"}}}},realTime:{timeLine:{color:"#1e88e5",size:1,areaFillColor:"rgba(30, 136, 229, 0.08)"},averageLine:{display:!0,color:"#F5A623",size:1}},technicalIndicator:{bar:{upColor:"#26A69A",downColor:"#EF5350"},line:{size:1,colors:["#D9D9D9","#F5A623","#F601FF","#1587DD","#1e88e5"]}},xAxis:{display:!0,maxHeight:50,minHeight:30,axisLine:{display:!0,color:"#888888",size:1},tickText:{display:!0,color:"#D9D9D9",size:12,margin:3},tickLine:{display:!0,size:1,length:3,color:"#888888"}},yAxis:{display:!0,maxWidth:100,minWidth:60,position:m,axisLine:{display:!0,color:"#888888",size:1},tickText:{position:k,display:!0,color:"#D9D9D9",size:12,margin:3},tickLine:{display:!0,size:1,length:3,color:"#888888"}},floatLayer:{crossHair:{display:!0,horizontal:{display:!0,line:{display:!0,style:x,dashValue:[4,2],size:1,color:"#888888"},text:{display:!0,color:"#D9D9D9",size:12,paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderColor:"#505050",backgroundColor:"#505050"}},vertical:{display:!0,line:{display:!0,style:x,dashValue:[4,2],size:1,color:"#888888"},text:{display:!0,color:"#D9D9D9",size:12,paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderColor:"#505050",backgroundColor:"#505050"}}},prompt:{displayRule:M,candleStick:{showType:A,labels:["时间","开","收","高","低","成交量"],values:null,rect:{paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:6,left:8,top:8,right:8,borderRadius:4,borderSize:1,borderColor:"#3f4254",fillColor:"rgba(17, 17, 17, .3)"},text:{size:12,color:"#D9D9D9",marginLeft:8,marginTop:6,marginRight:8,marginBottom:0}},technicalIndicator:{text:{size:12,color:"#D9D9D9",marginTop:6,marginRight:8,marginBottom:0,marginLeft:8}}}},graphicMark:{line:{color:"#1e88e5",size:1},point:{backgroundColor:"#1e88e5",borderColor:"#1e88e5",borderSize:1,radius:4,activeBackgroundColor:"#1e88e5",activeBorderColor:"#1e88e5",activeBorderSize:1,activeRadius:6},text:{color:"#1e88e5",size:12,marginLeft:2,marginRight:2,marginTop:2,marginBottom:6}}},I={NO:"NO",AVERAGE:"AVERAGE",MA:"MA",VOL:"VOL",MACD:"MACD",BOLL:"BOLL",KDJ:"KDJ",RSI:"RSI",BIAS:"BIAS",BRAR:"BRAR",CCI:"CCI",DMI:"DMI",CR:"CR",PSY:"PSY",DMA:"DMA",TRIX:"TRIX",OBV:"OBV",VR:"VR",WR:"WR",MTM:"MTM",EMV:"EMV",SAR:"SAR"},C=(s(f={},I.MA,[5,10,30,60]),s(f,I.VOL,[5,10,20]),s(f,I.MACD,[12,26,9]),s(f,I.BOLL,[20]),s(f,I.KDJ,[9,3,3]),s(f,I.RSI,[6,12,24]),s(f,I.BIAS,[6,12,24]),s(f,I.BRAR,[26]),s(f,I.CCI,[13]),s(f,I.DMI,[14,6]),s(f,I.CR,[26,10,20,40,60]),s(f,I.PSY,[12]),s(f,I.DMA,[10,50,10]),s(f,I.TRIX,[12,20]),s(f,I.OBV,[30]),s(f,I.VR,[24,30]),s(f,I.WR,[13,34,89]),s(f,I.MTM,[6,10]),s(f,I.EMV,[14,9]),s(f,I.SAR,[2,2,20]),f),R=(s(p={price:2,volume:0},I.NO,2),s(p,I.MA,2),s(p,I.VOL,0),s(p,I.MACD,2),s(p,I.BOLL,2),s(p,I.KDJ,2),s(p,I.RSI,2),s(p,I.BIAS,2),s(p,I.BRAR,4),s(p,I.CCI,4),s(p,I.DMI,4),s(p,I.CR,2),s(p,I.PSY,2),s(p,I.DMA,4),s(p,I.TRIX,4),s(p,I.OBV,4),s(p,I.VR,4),s(p,I.WR,4),s(p,I.MTM,4),s(p,I.EMV,4),s(p,I.SAR,2),p),O={NONE:"none",HORIZONTAL_STRAIGHT_LINE:"horizontalStraightLine",VERTICAL_STRAIGHT_LINE:"verticalStraightLine",STRAIGHT_LINE:"straightLine",HORIZONTAL_RAY_LINE:"horizontalRayLine",VERTICAL_RAY_LINE:"verticalRayLine",RAY_LINE:"rayLine",HORIZONTAL_SEGMENT_LINE:"horizontalSegmentLine",VERTICAL_SEGMENT_LINE:"verticalSegmentLine",SEGMENT_LINE:"segmentLine",PRICE_LINE:"priceLine",PRICE_CHANNEL_LINE:"priceChannelLine",PARALLEL_STRAIGHT_LINE:"parallelStraightLine",FIBONACCI_LINE:"fibonacciLine"},z={};function V(t,i){for(var e=t.length,a=0;e>a;a++)i(a);return t}function Y(t,i){for(var e=0,a=0;t.length>a;a++){var n=t[a].close-i;e+=n*n}var s=e>0,r=Math.sqrt((e=Math.abs(e))/t.length);return s?r:-1*r}function H(t){var i=0;if(t&&t.length>0){var e=t.length;i=t[0].high;for(var a=1;e>a;a++)i=Math.max(t[a].high,i)}return i}function B(t){var i=0;if(t&&t.length>0){var e=t.length;i=t[0].low;for(var a=1;e>a;a++)i=Math.min(t[a].low,i)}return i}function W(t){var i=0,e=0;if(t&&t.length>0){var a=t.length;i=t[0].high,e=t[0].low;for(var n=1;a>n;n++)i=Math.max(t[n].high,i),e=Math.min(t[n].low,e)}return[i,e]}function N(t){return t&&_(t)}function F(t,i){return N(t)&&t.length===i}z[I.AVERAGE]=function(t){var i=0,e=0;return V(t,(function(a){i+=t[a].turnover||0,t[a].average=0!==(e+=t[a].volume||0)?i/e:0}))},z[I.MA]=function(t,i){if(!N(i))return t;var e=[],a=i.length;return V(t,(function(n){for(var s={},r=t[n].close,c=0;a>c;c++){e[c]=(e[c]||0)+r;var o=i[c];o>n?s["ma".concat(o)]=e[c]/(n+1):(e[c]-=t[n-o].close,s["ma".concat(o)]=e[c]/o)}t[n].ma=s}))},z[I.VOL]=function(t,i){if(!N(i))return t;var e=[],a=i.length;return V(t,(function(n){for(var s=t[n].volume,r={},c=0;a>c;c++){e[c]=(e[c]||0)+s;var o=i[c];o>n?r["ma".concat(o)]=e[c]/(n+1):(e[c]-=t[n-o].volume,r["ma".concat(o)]=e[c]/o)}r.num=s,t[n].vol=r}))},z[I.MACD]=function(t,i){if(!F(i,3))return t;var e,a,n=0,s=0,r=0,c=0,o=0;return V(t,(function(h){var l=t[h].close;0===h?(e=l,a=l):(e=(2*l+(i[0]-1)*n)/(i[0]+1),a=(2*l+(i[1]-1)*s)/(i[1]+1)),n=e,s=a,o=c=(2*(r=e-a)+o*(i[2]-1))/(i[2]+1),t[h].macd={diff:r,dea:c,macd:2*(r-c)}}))},z[I.BOLL]=function(t,i){if(!F(i,1))return t;var e,a,n=0;return V(t,(function(s){n+=t[s].close,i[0]>s?(e=n/(s+1),a=Y(t.slice(0,s+1),e)):(e=(n-=t[s-i[0]].close)/i[0],a=Y(t.slice(s-(i[0]-1),s+1),e)),t[s].boll={up:e+2*a,mid:e,dn:e-2*a}}))},z[I.KDJ]=function(t,i){return F(i,3)?V(t,(function(r){var c=t[r].close;i[0]-1>r?(n=B(t.slice(0,r+1)),s=H(t.slice(0,r+1))):(n=B(t.slice(r-(i[0]-1),r+1)),s=H(t.slice(r-(i[0]-1),r+1))),t[r].kdj={k:e=(i[1]-1)/i[1]*(i[0]-1>r?50:t[r-1].kdj.k)+1/i[1]*((c-n)/(s-n==0?1:s-n)*100),d:a=(i[2]-1)/i[2]*(i[0]-1>r?50:t[r-1].kdj.d)+1/i[2]*e,j:3*e-2*a}})):t;var e,a,n,s},z[I.RSI]=function(t,i){if(!F(i,3))return t;var e,a,n,r,c,o,h=0,l=0,u=0,_=0,d=0,v=0;return V(t,(function(f){var p,x=(s(p={},"rsi".concat(i[0]),0),s(p,"rsi".concat(i[1]),0),s(p,"rsi".concat(i[2]),0),p);if(f>0){var y=t[f].close-t[f-1].close;if(y>0)h+=y,u+=y,d+=y;else{var m=Math.abs(y);l+=m,_+=m,v+=m}if(i[0]>f)e=h/(f+1),a=(h+l)/(f+1);else{if(f>i[0]){var g=t[f-i[0]].close-t[f-i[0]-1].close;g>0?h-=g:l-=Math.abs(g)}e=h/i[0],a=(h+l)/i[0]}if(x["rsi".concat(i[0])]=0!==a?e/a*100:0,i[1]>f)n=u/(f+1),r=(u+_)/(f+1);else{if(f>i[1]){var k=t[f-i[1]].close-t[f-i[1]-1].close;k>0?u-=k:_-=Math.abs(k)}n=u/i[1],r=(u+_)/i[1]}if(x["rsi".concat(i[1])]=0!==r?n/r*100:0,i[2]>f)c=d/(f+1),o=(d+v)/(f+1);else{if(f>i[2]){var T=t[f-i[2]].close-t[f-i[2]-1].close;T>0?d-=T:v-=Math.abs(T)}c=d/i[2],o=(d+v)/i[2]}x["rsi".concat(i[2])]=0!==o?c/o*100:0}t[f].rsi=x}))},z[I.BIAS]=function(t,i){if(!F(i,3))return t;var e,a,n,s=0,r=0,c=0;return V(t,(function(o){var h={},l=t[o].close;s+=l,r+=l,c+=l,e=i[0]>o?s/(o+1):(s-=t[o-i[0]].close)/i[0],h["bias".concat(i[0])]=(l-e)/e*100,a=i[1]>o?r/(o+1):(r-=t[o-i[1]].close)/i[1],h["bias".concat(i[1])]=(l-a)/a*100,n=i[2]>o?c/(o+1):(c-=t[o-i[2]].close)/i[2],h["bias".concat(i[2])]=(l-n)/n*100,t[o].bias=h}))},z[I.BRAR]=function(t,i){if(!F(i,1))return t;var e=0,a=0,n=0,s=0,r=0,c=0;return V(t,(function(o){var h=t[o].high,l=t[o].low,u=t[o].open;if(r+=h-u,c+=u-l,o>0){var _=t[o-1].close;if(n+=h-_,s+=_-l,o>i[0]-1){var d=t[o-i[0]].high,v=t[o-i[0]].low,f=t[o-i[0]].open;if(o>i[0]){var p=t[o-i[0]-1].close;n-=d-p,s-=p-v}r-=d-f,c-=f-v}a=0!==c?r/c*100:0,e=0!==s?n/s*100:0}t[o].brar={br:e,ar:a}}))},z[I.CCI]=function(t,i){if(!F(i,1))return t;var e,a,n=0,s=[],r=0;return V(t,(function(c){var o=t[c].close;n+=o;var h=(t[c].high+t[c].low+o)/3;if(i[0]>c)r+=Math.abs((e=n/(c+1))-o),s.push(e),a=r/(c+1);else{var l=t[c-i[0]].close;s.push(e=(n-=l)/i[0]),r+=Math.abs(e-o),a=(r-=Math.abs(s[c-i[0]]-l))/i[0]}t[c].cci={cci:0!==a?(h-e)/a/.015:0}}))},z[I.DMI]=function(t,i){if(!F(i,2))return t;var e=0,a=0,n=0,s=0,r=[0],c=0,o=[0],h=0,l=[0],u=0,_=[0],d=0;return V(t,(function(v){if(v>0){var f=t[v-1].close,p=t[v].high,x=t[v].low,y=p-x,m=Math.abs(p-f),g=Math.abs(x-f),k=p-t[v-1].high,T=t[v-1].low-x,D=Math.max(Math.max(y,m),g);c+=D,r.push(D);var b=k>0&&k>T?k:0;h+=b,o.push(b);var L=T>0&&T>k?T:0;u+=L,l.push(L),v>i[0]-1&&(c-=r[v-i[0]],h-=o[v-i[0]],u-=l[v-i[0]]),0===c?(e=0,a=0):(e=100*h/c,a=100*u/c);var w=Math.abs(a-e)/(a+e)*100;if(d+=w,_.push(w),i[1]>v)s=n=d/(v+1);else{var S=_[v-i[1]];s=((n=(d-=S)/i[1])+S)/2}}t[v].dmi={pdi:e,mdi:a,adx:n,adxr:s}}))},z[I.CR]=function(t,i){if(!F(i,5))return t;var e,a,n,s,r=0,c=0,o=0,h=0,l=[],u=0,_=[],d=0,v=[],f=0,p=[];return V(t,(function(x){if(x>0){var y=(t[x-1].high+t[x-1].close+t[x-1].low+t[x-1].open)/4,m=t[x].high-y;0>m&&(m=0),c+=m;var g=y-t[x].low;if(0>g&&(g=0),o+=g,x>i[0]){var k=(t[x-i[0]-1].high+t[x-i[0]-1].low+t[x-i[0]-1].close+t[x-i[0]-1].open)/4,T=t[x-i[0]].high-k;0>T&&(T=0);var D=k-t[x-i[0]].low;0>D&&(D=0),c-=T,o-=D}0!==o&&(r=c/o*100);var b=(t[x-1].high+t[x-1].low+t[x-1].close)/3,L=t[x].high-b;c+=L>0?L:0;var w=b-t[x].low;o+=w>0?w:0}h+=r,u+=r,d+=r,f+=r,e=i[1]>x?h/(x+1):(h-=t[x-i[1]].cr.cr)/i[1],l.push(e),a=i[2]>x?u/(x+1):(u-=t[x-i[2]].cr.cr)/i[2],_.push(a),n=i[3]>x?d/(x+1):(d-=t[x-i[3]].cr.cr)/i[3],v.push(n),s=i[4]>x?f/(x+1):(f-=t[x-i[4]].cr.cr)/i[4],p.push(s),t[x].cr={cr:r,ma1:5>x?l[0]:l[x-5],ma2:9>x?_[0]:_[x-9],ma3:17>x?v[0]:v[x-17],ma4:25>x?p[0]:p[x-25]}}))},z[I.PSY]=function(t,i){if(!F(i,1))return t;var e=0,a=0;return V(t,(function(n){n>0&&(a+=t[n].close-t[n-1].close>0?1:0,i[0]>n?e=a/(n+1)*100:(n>i[0]&&(a-=t[n-i[0]+1].close-t[n-i[0]].close>0?1:0),e=a/i[0]*100)),t[n].psy={psy:e}}))},z[I.DMA]=function(t,i){if(!F(i,3))return t;var e,a,n,s,r=0,c=0,o=0;return V(t,(function(h){var l=t[h].close;r+=l,c+=l,n=i[0]>h?r/(h+1):(r-=t[h-i[0]].close)/i[0],s=i[1]>h?c/(h+1):(c-=t[h-i[1]].close)/i[1],o+=e=n-s,a=i[2]>h?o/(h+1):(o-=t[h-i[2]].dma.dif)/i[2],t[h].dma={dif:e,difMa:a}}))},z[I.TRIX]=function(t,i){if(!F(i,2))return t;var e,a,n,s,r=0,c=0,o=0,h=0,l=0,u=[];return V(t,(function(_){var d=t[_].close;if(0===_)s=n=a=d;else{s=(2*(n=(2*(a=(2*d+(i[0]-1)*o)/(i[0]+1))+(i[0]-1)*h)/(i[0]+1))+(i[0]-1)*l)/(i[0]+1);var v=u[_-1];r=0===v?0:(s-v)/v*100}o=a,h=n,l=s,u.push(s),c+=r,e=i[1]>_?c/(_+1):(c-=t[_-i[1]].trix.trix)/i[1],t[_].trix={trix:r,maTrix:e}}))},z[I.OBV]=function(t,i){if(!F(i,1))return t;var e,a,n=0,s=0;return V(t,(function(r){var c=t[r].volume;if(0===r)e=c,s+=c;else{var o=t[r-1].close,h=t[r].close;s+=h>o?c:-c,e=h===o?0:s}n+=e,a=i[0]>r?n/(r+1):(n-=t[r-i[0]].obv.obv)/i[0],t[r].obv={obv:e,maObv:a}}))},z[I.VR]=function(t,i){if(!F(i,2))return t;var e,a=0,n=0,s=0,r=0,c=0;return V(t,(function(o){var h=t[o].close,l=t[o].open,u=t[o].volume;if(h>l?a+=u:l>h?n+=u:s+=u,o>i[0]-1){var _=t[o-i[0]].close,d=t[o-i[0]].open,v=t[o-i[0]].volume;_>d?a-=v:d>_?n-=v:s-=v}var f=n+.5*s;0!==f&&(r=(a+.5*s)/f*100),c+=r,e=i[1]>o?c/(o+1):(c-=t[o-i[1]].vr.vr)/i[1],t[o].vr={vr:r,maVr:e}}))},z[I.WR]=function(t,i){if(!F(i,3))return t;var e,a,n,s,r,c=Number.MIN_SAFE_INTEGER,o=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER,u=Number.MIN_SAFE_INTEGER,_=Number.MAX_SAFE_INTEGER;return V(t,(function(d){var v=t[d].close,f=t[d].high,p=t[d].low;if(i[0]>d)c=Math.max(f,c),o=Math.min(p,o);else{var x=W(t.slice(d-i[0],d));c=x[0],o=x[1]}if(e=0!==(n=c-o)?(c-v)/n*100:0,i[1]>d)h=Math.max(f,h),l=Math.min(p,l);else{var y=W(t.slice(d-i[1],d));h=y[0],l=y[1]}if(a=0!==(s=h-l)?(h-v)/s*100:0,i[2]>d)u=Math.max(f,u),_=Math.min(p,_);else{var m=W(t.slice(d-i[2],d));u=m[0],_=m[1]}t[d].wr={wr1:e,wr2:a,wr3:0!==(r=u-_)?(u-v)/r*100:0}}))},z[I.MTM]=function(t,i){if(!F(i,2))return t;var e,a,n=0;return V(t,(function(s){i[0]>s?(e=0,a=0):(n+=e=t[s].close-t[s-i[0]].close,i[0]+i[1]>s?a=n/(s-i[0]+1):(a=n/i[1],n-=t[s-i[1]].mtm.mtm));t[s].mtm={mtm:e,mtmMa:a}}))},z[I.EMV]=function(t,i){if(!F(i,2))return t;var e,a=0,n=0,s=0,r=[];return V(t,(function(c){if(c>0){var o=t[c].high,h=t[c].low;s=((o+h)/2-(t[c-1].high+t[c-1].low)/2)*(o-h)/t[c].turnover}r.push(s),i[0]>c?a+=s:a-=r[c-i[0]],n+=a,e=i[1]>c?n/(c+1):(n-=t[c-i[1]].emv.emv)/i[1],t[c].emv={emv:a,maEmv:e}}))},z[I.SAR]=function(t,i){if(!F(i,3))return t;var e=i[0]/100,a=i[1]/100,n=i[2]/100,s=e,r=-100,c=!1,o=0;return V(t,(function(i){var h=o,l=t[i].high,u=t[i].low;if(c){(-100===r||l>r)&&(r=l,s=Math.min(s+a,n)),o=h+s*(r-h);var _=Math.min(t[Math.max(1,i)-1].low,u);o>t[i].low?(o=r,s=e,r=-100,c=!c):o>_&&(o=_)}else{(-100===r||r>u)&&(r=u,s=Math.min(s+a,n)),o=h+s*(r-h);var d=Math.max(t[Math.max(1,i)-1].high,l);t[i].high>o?(o=r,s=0,r=-100,c=!c):d>o&&(o=d)}t[i].sar={sar:o}}))};var j=1,X=2,G=function(){function t(i,a){e(this,t),this._invalidateHandler=a,this._styleOptions=u(E),function t(i,e){if(d(i)&&d(e))for(var a in e)if(i.hasOwnProperty(a)){var n=i[a],s=e[a];d(s)&&d(n)&&!_(s)&&!_(n)?t(n,s):(e[a]||0===e[a]||!1===e[a])&&(i[a]=e[a])}}(this._styleOptions,i),this._technicalIndicatorParamOptions=u(C),this._precisionOptions=u(R),this._dataList=[],this._totalDataSpace=0,this._offsetRightSpace=50,this._from=0,this._to=0,this._range=0,this._dataSpace=6,this._barSpace=this._calcBarSpace(),this._crossHairPoint=null,this._crossHairSeriesTag=null,this.graphicMarkType=O.NONE,this.graphicMarkPoint=null,this.isDragGraphicMark=!1,this.graphicMarkDatas={horizontalStraightLine:[],verticalStraightLine:[],straightLine:[],horizontalRayLine:[],verticalRayLine:[],rayLine:[],horizontalSegmentLine:[],verticalSegmentLine:[],segmentLine:[],priceLine:[],parallelStraightLine:[],priceChannelLine:[],fibonacciLine:[]}}return n(t,[{key:"_calcRange",value:function(){this._range=Math.floor(this._totalDataSpace/this._dataSpace);var t=this._from+this._range;t>this._dataList.length&&(t=this._dataList.length),this._to=t}},{key:"_calcBarSpace",value:function(){return.75*this._dataSpace}},{key:"_calcRangDif",value:function(){return this._range-Math.floor(this._offsetRightSpace/this._dataSpace)}},{key:"styleOptions",value:function(){return this._styleOptions}},{key:"technicalIndicatorParamOptions",value:function(){return this._technicalIndicatorParamOptions}},{key:"precisionOptions",value:function(){return this._precisionOptions}},{key:"calcTechnicalIndicator",value:function(t){if(t===I.NO)return!0;var i=z[t];return!!i&&(this._dataList=i(this._dataList,this._technicalIndicatorParamOptions[t]),!0)}},{key:"dataList",value:function(){return this._dataList}},{key:"clearDataList",value:function(){this._dataList=[],this._from=0,this._to=0}},{key:"addData",value:function(t,i){if(d(t))if(_(t))if(0===this._dataList.length){this._dataList=t.concat(this._dataList);var e=this._calcRangDif(),a=this._dataList.length-e;0>a&&(a=0),this._from=a,this._to=this._dataList.length}else this._dataList=t.concat(this._dataList),this._from+=t.length;else if(i<this._dataList.length)this._dataList[i]=t;else{var n=this._dataList.length;if(this._dataList.push(t),0!==this._from){if(this._to===n){this._to+=1;var s=this._calcRangDif();this._to-this._from>s&&(this._from+=1)}}else this._calcRangDif()>this._dataList.length?this._to=this._dataList.length:(this._from+=1,this._to+=1)}}},{key:"dataSpace",value:function(){return this._dataSpace}},{key:"barSpace",value:function(){return this._barSpace}},{key:"setDataSpace",value:function(t){2>t||t>20||this._dataSpace!==t&&(this._dataSpace=t,this._barSpace=this._calcBarSpace(),this._calcRange(),this._invalidateHandler())}},{key:"setTotalDataSpace",value:function(t){this._totalDataSpace!==t&&(this._totalDataSpace=t,this._calcRange())}},{key:"from",value:function(){return this._from}},{key:"to",value:function(){return this._to}},{key:"range",value:function(){return this._range}},{key:"crossHairPoint",value:function(){return this._crossHairPoint}},{key:"crossHairSeriesTag",value:function(){return this._crossHairSeriesTag}},{key:"setCrossHairSeriesTag",value:function(t){this._crossHairSeriesTag=t,this._invalidateHandler(j)}},{key:"setCrossHairPoint",value:function(t){this._crossHairPoint=t}},{key:"getCrossHairDataPos",value:function(){var t;this._crossHairPoint?(t=this._from+Math.floor(this._crossHairPoint.x/this._dataSpace)-1)>this._to-1&&(t=this._to-1):t=this._to-1;return t}}]),t}(),K=function(){function t(i){e(this,t),this._container=i.container,this._chartData=i.chartData,this._initBefore(i),this._initElement(),this._mainWidget=this._createMainWidget(this._mainWidgetCell,i),this._yAxisWidget=this._createYAxisWidget(this._yAxisWidgetCell,i)}return n(t,[{key:"_initBefore",value:function(t){}},{key:"_initElement",value:function(){this._element=document.createElement("div"),this._element.style.margin="0",this._element.style.padding="0",this._element.style.width="100%",this._element.style.position="relative",this._element.style.overflow="hidden",this._mainWidgetCell=this._createCell(),this._yAxisWidgetCell=this._createCell(),this._element.appendChild(this._mainWidgetCell),this._element.appendChild(this._yAxisWidgetCell);var t=this._container.lastChild;t?this._container.insertBefore(this._element,t):this._container.appendChild(this._element)}},{key:"_createCell",value:function(){var t=document.createElement("div");return t.style.position="absolute",t.style.margin="0",t.style.padding="0",t.style.top="0",t.style.zIndex="1",t}},{key:"_createMainWidget",value:function(t,i){}},{key:"_createYAxisWidget",value:function(t,i){}},{key:"_setCellSize",value:function(t,i){t.style.left="".concat(i.left,"px"),t.style.width="".concat(i.width,"px"),t.style.height="".concat(i.height,"px")}},{key:"setSize",value:function(t,i){this._element.style.height="".concat(t.height,"px"),this._setCellSize(this._mainWidgetCell,t),this._setCellSize(this._yAxisWidgetCell,i),this._mainWidget.setSize(t.width,t.height),this._yAxisWidget&&this._yAxisWidget.setSize(i.width,i.height)}},{key:"_computeAxis",value:function(){}},{key:"invalidate",value:function(t){t===X&&this._computeAxis(),this._mainWidget.invalidate(t),this._yAxisWidget&&this._yAxisWidget.invalidate(t)}},{key:"destroy",value:function(){this._container.removeChild(this._element)}}]),t}(),q=function(){function t(i){e(this,t),this._initElement(i.container),this._mainView=this._createMainView(this._element,i),this._floatLayerView=this._createFloatLayerView(this._element,i)}return n(t,[{key:"_initElement",value:function(t){this._element=document.createElement("div"),this._element.style.margin="0",this._element.style.padding="0",this._element.style.position="relative",this._element.style.overflow="hidden",t.appendChild(this._element)}},{key:"_createMainView",value:function(){}},{key:"_createFloatLayerView",value:function(){}},{key:"setSize",value:function(t,i){this._element.style.width="".concat(t,"px"),this._element.style.height="".concat(i,"px"),this._mainView.setSize(t,i),this._floatLayerView.setSize(t,i)}},{key:"invalidate",value:function(t){switch(t){case j:this._floatLayerView.flush();break;case X:this._mainView.flush(),this._floatLayerView.flush()}}}]),t}();function J(t){return(window.devicePixelRatio||1)/(t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}function U(t,i){return t.measureText(i).width}function Z(t){return"".concat(t,"px Arial")}var Q=function(){function t(i,a){e(this,t),this._chartData=a,this._initCanvas(i)}return n(t,[{key:"_initCanvas",value:function(t){this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.style.right="0",this._canvas.style.left="0",this._canvas.style.zIndex="2",this._ctx=this._canvas.getContext("2d"),t.appendChild(this._canvas)}},{key:"_redraw",value:function(t){this._ctx.clearRect(0,0,this._width,this._height),t&&t(),this._draw()}},{key:"_draw",value:function(){}},{key:"setSize",value:function(t,i){var e=this;t===this._width&&i===this._height||this._redraw((function(){var a=J(e._ctx);e._width=t,e._height=i,e._canvas.style.top="0",e._canvas.style.width="".concat(t,"px"),e._canvas.style.height="".concat(i,"px"),e._canvas.width=t*a,e._canvas.height=i*a,e._ctx.scale(a,a)}))}},{key:"flush",value:function(){var t,i,e=this;this.requestAnimationId&&(t=this.requestAnimationId,window.cancelAnimationFrame||clearTimeout(t),window.cancelAnimationFrame(t)),this.requestAnimationId=(i=function(){e._redraw()},window.requestAnimationFrame?window.requestAnimationFrame(i):window.setTimeout((function(){i()}),1e3/60))}}]),t}(),$=function(t){function i(t,a,n,s,r){var o;return e(this,i),(o=h(this,c(i).call(this,t,a)))._xAxis=n,o._yAxis=s,o._additionalDataProvider=r,o}return r(i,t),n(i,[{key:"_draw",value:function(){this._drawGrid(),this._drawTechnicalIndicator()}},{key:"_drawGrid",value:function(){var t=this,i=this._chartData.styleOptions().grid;if(i.display){var e=i.horizontal;e.display&&(this._ctx.strokeStyle=e.color,this._ctx.lineWidth=e.size,e.style===x&&this._ctx.setLineDash(e.dashValue),this._xAxis.ticks().forEach((function(i){var e=i.x;t._ctx.beginPath(),t._ctx.moveTo(e,0),t._ctx.lineTo(e,t._height),t._ctx.stroke(),t._ctx.closePath()})));var a=i.vertical;a.display&&(this._ctx.strokeStyle=a.color,this._ctx.lineWidth=a.size,a.style===x&&this._ctx.setLineDash(a.dashValue),this._yAxis.ticks().forEach((function(i){var e=i.y;t._ctx.beginPath(),t._ctx.moveTo(0,e),t._ctx.lineTo(t._width,e),t._ctx.stroke(),t._ctx.closePath()}))),this._ctx.setLineDash([])}}},{key:"_drawTechnicalIndicator",value:function(){var t,i=this,e=this._additionalDataProvider.technicalIndicatorType(),a=this._chartData.technicalIndicatorParamOptions()[e]||[],n=[],s=this._chartData.styleOptions().technicalIndicator;switch(e){case I.MA:var r=[];a.forEach((function(t){r.push("ma".concat(t))})),t=function(t,a,c,o){i._ohlcTechnicalIndicatorDrawing(a,t,o,s,c,e,r,i._yAxis.isCandleStickYAxis(),(function(e){i._prepareLinePoints(t,e,n)}))};break;case I.MACD:var c=this._chartData.dataList();t=function(t,e,a,r){var o=a.macd||{};i._prepareLinePoints(t,[o.diff,o.dea],n);var h=o.macd,l=((c[e-1]||{}).macd||{}).macd||-1/0;h>0?(i._ctx.strokeStyle=s.bar.upColor,i._ctx.fillStyle=s.bar.upColor):(i._ctx.strokeStyle=s.bar.downColor,i._ctx.fillStyle=s.bar.downColor),i._drawBars(t,r,h,!((l||0===l)&&h>l))};break;case I.VOL:var o=this._chartData.dataList();t=function(t,e,r,c){var h=r.vol||{},l=[];a.forEach((function(t){l.push(h["ma".concat(t)])})),i._prepareLinePoints(t,l,n),i._ctx.fillStyle=r.close>((o[e-1]||{}||{}).close||-1/0)?s.bar.upColor:s.bar.downColor,i._drawBars(t,c,h.num,!0)};break;case I.BOLL:t=function(t,a,r,c){i._ohlcTechnicalIndicatorDrawing(a,t,c,s,r,e,["up","mid","dn"],i._yAxis.isCandleStickYAxis(),(function(e){i._prepareLinePoints(t,e,n)}))};break;case I.BIAS:t=function(t,e,s){var r=s.bias||{},c=[];a.forEach((function(t){c.push(r["bias".concat(t)])})),i._prepareLinePoints(t,c,n)};break;case I.BRAR:t=function(t,e,a){var s=a.brar||{};i._prepareLinePoints(t,[s.br,s.ar],n)};break;case I.CCI:t=function(t,e,a){i._prepareLinePoints(t,[(a.cci||{}).cci],n)};break;case I.CR:t=function(t,e,a){var s=a.cr||{};i._prepareLinePoints(t,[s.cr,s.ma1,s.ma2,s.ma3,s.ma4],n)};break;case I.DMA:t=function(t,e,a){var s=a.dma||{};i._prepareLinePoints(t,[s.dif,s.difMa],n)};break;case I.DMI:t=function(t,e,a){var s=a.dmi||{};i._prepareLinePoints(t,[s.mdi,s.pdi,s.adx,s.adxr],n)};break;case I.KDJ:t=function(t,e,a){var s=a.kdj||{};i._prepareLinePoints(t,[s.k,s.d,s.j],n)};break;case I.RSI:t=function(t,e,s){var r=s.rsi||{},c=[];a.forEach((function(t){c.push(r["rsi".concat(t)])})),i._prepareLinePoints(t,c,n)};break;case I.PSY:t=function(t,e,a){i._prepareLinePoints(t,[(a.psy||{}).psy],n)};break;case I.TRIX:t=function(t,e,a){var s=a.trix||{};i._prepareLinePoints(t,[s.trix,s.maTrix],n)};break;case I.OBV:t=function(t,e,a){var s=a.obv||{};i._prepareLinePoints(t,[s.obv,s.maObv],n)};break;case I.VR:t=function(t,e,a){var s=a.vr||{};i._prepareLinePoints(t,[s.vr,s.maVr],n)};break;case I.WR:t=function(t,e,a){var s=a.wr||{};i._prepareLinePoints(t,[s.wr1,s.wr2,s.wr3],n)};break;case I.MTM:t=function(t,e,a){var s=a.mtm||{};i._prepareLinePoints(t,[s.mtm,s.mtmMa],n)};break;case I.EMV:t=function(t,e,a){var s=a.emv||{};i._prepareLinePoints(t,[s.emv,s.maEmv],n)};break;case I.SAR:t=function(t,a,n,r){i._ohlcTechnicalIndicatorDrawing(a,t,r,s,n,e,["sar"],i._yAxis.isCandleStickYAxis(),(function(e){var a=e[0];if(a||0===a){var c=i._yAxis.convertToPixel(a);i._ctx.strokeStyle=(n.high+n.low)/2>a?s.bar.upColor:s.bar.downColor,i._ctx.beginPath(),i._ctx.arc(t,c,r,2*Math.PI,0,!0),i._ctx.stroke(),i._ctx.closePath()}}))}}this._drawGraphics(t,(function(){i._drawLines(n,s)}))}},{key:"_ohlcTechnicalIndicatorDrawing",value:function(t,i,e,a,n,s,r,c,o){var h=n[s.toLowerCase()]||{},l=[];r.forEach((function(t){l.push(h[t])})),o&&o(l);var u=this._chartData.dataList();c||this._drawOhlc(e,i,n,u[t-1]||{},a.bar.upColor,a.bar.downColor)}},{key:"_prepareLinePoints",value:function(t,i,e){for(var a=0;i.length>a;a++){var n=this._yAxis.convertToPixel(i[a]);e[a]?e[a].push({x:t,y:n}):e[a]=[{x:t,y:n}]}}},{key:"_drawLines",value:function(t,i){var e=i.line.colors,a=t.length,n=(e||[]).length;this._ctx.lineWidth=i.line.size;for(var s=0;a>s;s++){var r=t[s];if(r.length>0){this._ctx.strokeStyle=e[s%n],this._ctx.beginPath(),this._ctx.moveTo(r[0].x,r[0].y);for(var c=1;r.length>c;c++)this._ctx.lineTo(r[c].x,r[c].y);this._ctx.stroke(),this._ctx.closePath()}}}},{key:"_drawBars",value:function(t,i,e,a){if(e||0===e){this._ctx.lineWidth=1;var n=this._yAxis.convertToPixel(e),s=this._yAxis.convertToPixel(0),r=n;0>e&&(r=s);var c=Math.abs(s-n);1>c&&(c=1),a?this._ctx.fillRect(t-i,r,2*i,c):this._ctx.strokeRect(t-i,r,2*i,c)}}},{key:"_drawOhlc",value:function(t,i,e,a,n,s){var r=this._yAxis.convertToPixel(e.open),c=this._yAxis.convertToPixel(e.close),o=this._yAxis.convertToPixel(e.high),h=this._yAxis.convertToPixel(e.low);this._ctx.strokeStyle=e.close>a.close?n:s,this._ctx.lineWidth=1,this._ctx.beginPath(),this._ctx.moveTo(i,o),this._ctx.lineTo(i,h),this._ctx.stroke(),this._ctx.closePath(),this._ctx.beginPath(),this._ctx.moveTo(i-t,r),this._ctx.lineTo(i,r),this._ctx.stroke(),this._ctx.closePath(),this._ctx.beginPath(),this._ctx.moveTo(i+t,c),this._ctx.lineTo(i,c),this._ctx.stroke(),this._ctx.closePath()}},{key:"_drawGraphics",value:function(t,i){for(var e=0,a=this._chartData.dataList(),n=this._chartData.barSpace(),s=this._chartData.dataSpace(),r=n/2,c=this._chartData.to(),o=this._chartData.from();c>o;o++){t&&t((e+(e+n))/2,o,a[o],r,n),e+=s}i&&i()}}]),i}(Q);function tt(t){return t.getBoundingClientRect()||{left:0,top:0}}function it(t,i){var e=t.clientX-i.clientX,a=t.clientY-i.clientY;return Math.sqrt(e*e+a*a)}function et(t){return!!t.touches}function at(t){t.cancelable&&t.preventDefault()}var nt=!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints||"ontouchstart"in window||!!(window.DocumentTouch&&document instanceof window.DocumentTouch),st="onorientationchange"in window&&nt,rt=function(){function t(i,a,n){e(this,t),this._target=i,this._handler=a,this._options=n,this._clickCount=0,this._clickTimeoutId=null,this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartPosition=null,this._moveExceededManhattanDistance=!1,this._cancelClick=!1,this._unsubscribeOutsideEvents=null,this._unsubscribeMousemove=null,this._unsubscribeRoot=null,this._startPinchMiddlePoint=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventDragProcess=!1,this._mousePressed=!1,this._init()}return n(t,[{key:"destroy",value:function(){null!==this._unsubscribeOutsideEvents&&(this._unsubscribeOutsideEvents(),this._unsubscribeOutsideEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),this._clearLongTapTimeout(),this._resetClickTimeout()}},{key:"_mouseEnterHandler",value:function(t){var i=this;this._unsubscribeMousemove&&this._unsubscribeMousemove();var e=this._mouseMoveHandler.bind(this);this._unsubscribeMousemove=function(){i._target.removeEventListener("mousemove",e)},this._target.addEventListener("mousemove",e),et(t)&&this._mouseMoveHandler(t);var a=this._makeCompatEvent(t);this._processEvent(a,this._handler.mouseEnterEvent)}},{key:"_resetClickTimeout",value:function(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null}},{key:"_mouseMoveHandler",value:function(t){if(!this._mousePressed||et(t)){var i=this._makeCompatEvent(t);this._processEvent(i,this._handler.mouseMoveEvent)}}},{key:"_mouseMoveWithDownHandler",value:function(t){if(!("button"in t&&0!==t.button)&&null===this._startPinchMiddlePoint){var i=et(t);if(!this._preventDragProcess||!i){this._pinchPrevented=!0;var e=this._makeCompatEvent(t),a=this._mouseMoveStartPosition,n=Math.abs(a.x-e.pageX),s=Math.abs(a.y-e.pageY),r=n+s>5;if(r||!i){if(r&&!this._moveExceededManhattanDistance&&i){var c=.5*n;s>=c&&!this._options.treatVertTouchDragAsPageScroll||c>s&&!this._options.treatHorzTouchDragAsPageScroll||(this._preventDragProcess=!0)}r&&(this._moveExceededManhattanDistance=!0,this._cancelClick=!0,i&&this._clearLongTapTimeout()),this._preventDragProcess||(this._processEvent(e,this._handler.pressedMouseMoveEvent),i&&at(t))}}}}},{key:"_mouseUpHandler",value:function(t){if(!("button"in t&&0!==t.button)){var i=this._makeCompatEvent(t);this._clearLongTapTimeout(),this._mouseMoveStartPosition=null,this._mousePressed=!1,this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),et(t)&&this._mouseLeaveHandler(t),this._processEvent(i,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId&&this._clickCount>1?(this._processEvent(i,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()):this._cancelClick||this._processEvent(i,this._handler.mouseClickEvent),et(t)&&(at(t),this._mouseLeaveHandler(t),0===t.touches.length&&(this._longTapActive=!1))}}},{key:"_clearLongTapTimeout",value:function(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}},{key:"_mouseDownHandler",value:function(t){if(!("button"in t&&0!==t.button)){var i=this._makeCompatEvent(t);this._cancelClick=!1,this._moveExceededManhattanDistance=!1,this._preventDragProcess=!1,et(t)&&this._mouseEnterHandler(t),this._mouseMoveStartPosition={x:i.pageX,y:i.pageY},this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null);var e=this._mouseMoveWithDownHandler.bind(this),a=this._mouseUpHandler.bind(this),n=this._target.ownerDocument.documentElement;this._unsubscribeRoot=function(){n.removeEventListener("touchmove",e),n.removeEventListener("touchend",a),n.removeEventListener("mousemove",e),n.removeEventListener("mouseup",a)},n.addEventListener("touchmove",e,{passive:!1}),n.addEventListener("touchend",a,{passive:!1}),this._clearLongTapTimeout(),et(t)&&1===t.touches.length?this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),500):(n.addEventListener("mousemove",e),n.addEventListener("mouseup",a)),this._mousePressed=!0,this._processEvent(i,this._handler.mouseDownEvent),this._clickTimeoutId||(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500))}}},{key:"_init",value:function(){var t=this;this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));var i=this._target.ownerDocument,e=function(i){t._handler.mouseDownOutsideEvent&&(i.target&&t._target.contains(i.target)||t._handler.mouseDownOutsideEvent())};this._unsubscribeOutsideEvents=function(){i.removeEventListener("mousedown",e),i.removeEventListener("touchstart",e)},i.addEventListener("mousedown",e),i.addEventListener("touchstart",e,{passive:!0}),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._mouseDownHandler.bind(this),{passive:!0}),st||this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",(function(){}),{passive:!1})}},{key:"_initPinch",value:function(){var t=this;void 0===this._handler.pinchStartEvent&&void 0===this._handler.pinchEvent&&void 0===this._handler.pinchEndEvent||(this._target.addEventListener("touchstart",(function(i){return t._checkPinchState(i.touches)}),{passive:!0}),this._target.addEventListener("touchmove",(function(i){if(2===i.touches.length&&null!==t._startPinchMiddlePoint&&void 0!==t._handler.pinchEvent){var e=it(i.touches[0],i.touches[1]);t._handler.pinchEvent(t._startPinchMiddlePoint,e/t._startPinchDistance),at(i)}}),{passive:!1}),this._target.addEventListener("touchend",(function(i){t._checkPinchState(i.touches)})))}},{key:"_checkPinchState",value:function(t){1===t.length&&(this._pinchPrevented=!1),2!==t.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(t)}},{key:"_startPinch",value:function(t){var i=tt(this._target);this._startPinchMiddlePoint={x:(t[0].clientX-i.left+(t[1].clientX-i.left))/2,y:(t[0].clientY-i.top+(t[1].clientY-i.top))/2},this._startPinchDistance=it(t[0],t[1]),void 0!==this._handler.pinchStartEvent&&this._handler.pinchStartEvent(),this._clearLongTapTimeout()}},{key:"_stopPinch",value:function(){null!==this._startPinchMiddlePoint&&(this._startPinchMiddlePoint=null,void 0!==this._handler.pinchEndEvent&&this._handler.pinchEndEvent())}},{key:"_mouseLeaveHandler",value:function(t){this._unsubscribeMousemove&&this._unsubscribeMousemove();var i=this._makeCompatEvent(t);this._processEvent(i,this._handler.mouseLeaveEvent)}},{key:"_longTapHandler",value:function(t){var i=this._makeCompatEvent(t);this._processEvent(i,this._handler.longTapEvent),this._cancelClick=!0,this._longTapActive=!0}},{key:"_processEvent",value:function(t,i){i&&i.call(this._handler,t)}},{key:"_makeCompatEvent",value:function(t){var i;i="touches"in t&&t.touches.length?t.touches[0]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0]:t;var e=tt(this._target);return{clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,screenX:i.screenX,screenY:i.screenY,localX:i.clientX-e.left,localY:i.clientY-e.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,type:t.type.startsWith("mouse")?"mouse":"touch",target:i.target,view:t.view}}}]),t}(),ct=function(){function t(i,a,n){e(this,t),this._chartData=a,this._tag=n,this._event=new rt(i,{mouseLeaveEvent:this._eventLeave.bind(this),mouseMoveEvent:this._eventMove.bind(this)},{treatVertTouchDragAsPageScroll:!0,treatHorzTouchDragAsPageScroll:!0})}return n(t,[{key:"_eventLeave",value:function(){this._chartData.setCrossHairSeriesTag(null)}},{key:"_eventMove",value:function(t){this._chartData.setCrossHairPoint({x:t.localX,y:t.localY}),this._chartData.setCrossHairSeriesTag(this._tag)}},{key:"destroy",value:function(){this._event.destroy()}}]),t}();function ot(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"--";if(t&&d(t)){var a=t[i];if(a||0===a||!1===a)return a}return e}function ht(t,i){if(t&&v(t)){var e=new Date(t),a=""+e.getFullYear(),n=""+(e.getMonth()+1),s=""+e.getDate(),r=""+e.getHours(),c=""+e.getMinutes(),o=1===n.length?"0".concat(n):n,h=1===s.length?"0".concat(s):s,l=1===r.length?"0"+r:r,u=1===c.length?"0"+c:c;switch(i){case"YYYY":return a;case"YYYY-MM":return"".concat(a,"-").concat(o);case"YYYY-MM-DD":return"".concat(a,"-").concat(o,"-").concat(h);case"YYYY-MM-DD hh:mm":return"".concat(a,"-").concat(o,"-").concat(h," ").concat(l,":").concat(u);case"MM-DD":return"".concat(o,"-").concat(h);case"hh:mm":return"".concat(l,":").concat(u);default:return"".concat(o,"-").concat(h," ").concat(l,":").concat(u)}}return"--"}function lt(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,e=+t;return(e||0===e)&&v(e)?t.toFixed(i):"".concat(e)}var ut=function(t){function i(t,a,n,s,r){var o;return e(this,i),(o=h(this,c(i).call(this,t,a)))._xAxis=n,o._yAxis=s,o._additionalDataProvider=r,o._crossHairEvent=new ct(o._canvas,a,r.tag()),o}return r(i,t),n(i,[{key:"_draw",value:function(){var t=this._chartData.getCrossHairDataPos(),i=this._chartData.dataList()[t],e=this._xAxis.convertToPixel(t);this._drawCrossHairHorizontalLine(),this._drawCrossHairVerticalLine(i,e);var a=this._chartData.styleOptions().floatLayer.prompt.displayRule;(a===M||a===P&&this._chartData.crossHairSeriesTag())&&this._drawPrompt(i,e)}},{key:"_drawPrompt",value:function(t,i){this._drawTechnicalIndicatorPrompt(t,i)}},{key:"_drawCrossHairHorizontalLine",value:function(){if(this._chartData.crossHairSeriesTag()===this._additionalDataProvider.tag()){var t=this._chartData.styleOptions().floatLayer.crossHair,i=t.horizontal,e=i.line;if(t.display&&i.display&&e.display){var a=this._chartData.crossHairPoint();a&&(this._ctx.lineWidth=e.size,this._ctx.strokeStyle=e.color,e.style===x&&this._ctx.setLineDash(e.dashValue),this._ctx.beginPath(),this._ctx.moveTo(0,a.y),this._ctx.lineTo(this._width,a.y),this._ctx.stroke(),this._ctx.closePath(),this._ctx.setLineDash([]))}}}},{key:"_drawCrossHairVerticalLine",value:function(t,i){if(this._chartData.crossHairSeriesTag()){var e=this._chartData.styleOptions().floatLayer.crossHair,a=e.vertical,n=a.line;e.display&&a.display&&n.display&&t&&(this._ctx.lineWidth=n.size,this._ctx.strokeStyle=n.color,n.style===x&&this._ctx.setLineDash(n.dashValue),this._ctx.beginPath(),this._ctx.moveTo(i,0),this._ctx.lineTo(i,this._height),this._ctx.stroke(),this._ctx.closePath(),this._ctx.setLineDash([]))}}},{key:"_drawTechnicalIndicatorPrompt",value:function(t,i){var e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=this._chartData.styleOptions().technicalIndicator,n=this._getTechnicalIndicatorPromptData(t),s=a.line.colors;this._drawTechnicalIndicatorPromptText(n,s,e),this._drawTechnicalIndicatorPromptPoint(n.values,s,i)}},{key:"_drawTechnicalIndicatorPromptText",value:function(t,i,e){var a=this._chartData.styleOptions().floatLayer.prompt.technicalIndicator.text,n=t.name,s=t.labels,r=t.values,c=a.marginLeft,o=a.marginRight,h=c,l=a.marginTop+e,u=a.size,_=a.color,d=i.length;this._ctx.textBaseline="top",this._ctx.font=Z(u);var v=U(this._ctx,n);this._ctx.fillStyle=_,this._ctx.fillText(n,h,l),h+=c+v;for(var f=0;s.length>f;f++){var p="".concat(s[f].toUpperCase(),": ").concat(r[f]||"--"),x=U(this._ctx,p);this._ctx.fillStyle=i[f%d]||_,this._ctx.fillText(p,h,l),h+=c+o+x}}},{key:"_drawTechnicalIndicatorPromptPoint",value:function(t,i,e){var a=this._additionalDataProvider.technicalIndicatorType();if(this._chartData.crossHairSeriesTag()&&a!==I.SAR)for(var n=i.length,s=a===I.MACD||a===I.VOL?t.length-1:t.length,r=0;s>r;r++){var c=t[r];if(c||0===c){var o=this._yAxis.convertToPixel(c);this._ctx.fillStyle=i[r%n],this._ctx.beginPath(),this._ctx.arc(e,o,3,0,2*Math.PI),this._ctx.closePath(),this._ctx.fill()}}}},{key:"_getTechnicalIndicatorPromptData",value:function(t){var i=this._additionalDataProvider.technicalIndicatorType(),e=this._chartData.technicalIndicatorParamOptions()[i]||[],a=[],n=[];switch(i){case I.MA:e.forEach((function(t){n.push("ma".concat(t))}));break;case I.VOL:e.forEach((function(t){n.push("ma".concat(t))})),n.push("num");break;case I.MACD:n=["diff","dea","macd"];break;case I.BOLL:n=["up","mid","dn"];break;case I.BIAS:e.forEach((function(t){n.push("bias".concat(t))}));break;case I.BRAR:n=["br","ar"];break;case I.CCI:n=["cci"];break;case I.CR:n=["cr","ma1","ma2","ma3","ma4"];break;case I.DMA:n=["dif","difMa"];break;case I.DMI:n=["mdi","pdi","adx","adxr"];break;case I.KDJ:n=["k","d","j"];break;case I.RSI:e.forEach((function(t){n.push("rsi".concat(t))}));break;case I.PSY:n=["psy"];break;case I.TRIX:n=["trix","maTrix"];break;case I.OBV:n=["obv","maObv"];break;case I.VR:n=["vr","maVr"];break;case I.WR:n=["wr1","wr2","wr3"];break;case I.MTM:n=["mtm","mtmMa"];break;case I.EMV:n=["emv","maEmv"];break;case I.SAR:n=["sar"]}var s="";if(n.length>0){s="".concat(i),e&&_(e)&&e.length>0&&(s="".concat(s,"(").concat(e.join(","),")"));var r=ot(t,i.toLowerCase());n.forEach((function(t){a.push(ot(r,t))}));var c=this._chartData.precisionOptions()[i];a.forEach((function(t,i){a[i]=lt(t,c)}))}return{labels:n,values:a,name:s}}}]),i}(Q),_t=function(t){function i(){return e(this,i),h(this,c(i).apply(this,arguments))}return r(i,t),n(i,[{key:"_createMainView",value:function(t,i){return new $(t,i.chartData,i.xAxis,i.yAxis,i.additionalDataProvider)}},{key:"_createFloatLayerView",value:function(t,i){return new ut(t,i.chartData,i.xAxis,i.yAxis,i.additionalDataProvider)}}]),i}(q),dt=function(t){function i(t,a,n){var s;return e(this,i),(s=h(this,c(i).call(this,t,a)))._axis=n,s}return r(i,t),n(i,[{key:"_draw",value:function(){this._drawAxisLine(),this._drawTickLines(),this._drawTickLabels()}},{key:"_drawAxisLine",value:function(){}},{key:"_drawTickLines",value:function(){}},{key:"_drawTickLabels",value:function(){}}]),i}(Q),vt=function(t){function i(){return e(this,i),h(this,c(i).apply(this,arguments))}return r(i,t),n(i,[{key:"_draw",value:function(){l(c(i.prototype),"_draw",this).call(this),this._drawLastPriceLabel()}},{key:"_drawAxisLine",value:function(){var t=this._chartData.styleOptions().yAxis;t.display&&t.axisLine.display&&(this._ctx.strokeStyle=t.axisLine.color,this._ctx.lineWidth=t.axisLine.size,this._ctx.beginPath(),t.position===y&&t.tickText.position===g||t.position===m&&t.tickText.position===k?(this._ctx.moveTo(0,0),this._ctx.lineTo(0,this._height)):(this._ctx.moveTo(this._width,0),this._ctx.lineTo(this._width,this._height)),this._ctx.stroke(),this._ctx.closePath())}},{key:"_drawTickLines",value:function(){var t=this,i=this._chartData.styleOptions().yAxis,e=i.tickText;if(i.display&&e.display){var a=i.tickLine;this._ctx.lineWidth=a.size,this._ctx.strokeStyle=a.color;var n,s,r=a.length,c=e.position;i.position===y&&c===g||i.position===m&&c===k?(n=0,i.axisLine.display&&(n+=i.axisLine.size),s=n+r):(n=this._width,i.axisLine.display&&(n-=i.axisLine.size),s=n-r),this._axis.ticks().forEach((function(i){var e=i.y;t._ctx.beginPath(),t._ctx.moveTo(n,e),t._ctx.lineTo(s,e),t._ctx.stroke(),t._ctx.closePath()}))}}},{key:"_drawTickLabels",value:function(){var t=this,i=this._chartData.styleOptions().yAxis,e=i.tickText;if(i.display&&e.display){var a,n=i.tickLine,s=e.position,r=n.display,c=n.length,o=e.margin;i.position===y&&s===g||i.position===m&&s===k?(a=o,i.axisLine.display&&(a+=i.axisLine.size),r&&(a+=c),this._ctx.textAlign="left"):(a=this.width-o,i.axisLine.display&&(a-=i.axisLine.size),r&&(a-=c),this._ctx.textAlign="right");var h=e.size;this._ctx.textBaseline="middle",this._ctx.font=Z(h),this._ctx.fillStyle=e.color,this._axis.ticks().forEach((function(i){var e,n=v(e=i.v)?e>5e4?"".concat(+(e/1e3).toFixed(1),"K"):e>5e6?"".concat(+(e/1e6).toFixed(3),"M"):"".concat(e):"--";t._ctx.fillText(n,a,i.y)})),this._ctx.textAlign="left"}}},{key:"_drawLastPriceLabel",value:function(){if(this._axis.isCandleStickYAxis()){var t=this._chartData.styleOptions().candleStick.priceMark,i=t.last,e=this._chartData.dataList(),a=e.length;if(t.display&&i.display&&i.text.display&&0!==a){var n=(e[a-2]||{}).close||-1/0,s=e[a-1].close,r=this._axis.convertToPixel(s);r=+Math.max(.05*this._height,Math.min(r,.98*this._height)).toFixed(0);var c=s>n?i.upColor:i.downColor,o=i.text,h=lt(s,this._chartData.precisionOptions().price),l=i.text.size;this._ctx.font=Z(l);var u,_=U(this._ctx,h)+o.paddingLeft+o.paddingRight,d=o.paddingTop+l+o.paddingBottom,v=this._chartData.styleOptions().yAxis;u=v.position===y&&v.tickText.position===g||v.position===m&&v.tickText.position===k?0:this._width-_,this._ctx.fillStyle=c,this._ctx.fillRect(u,r-o.paddingTop-l/2,_,d),this._ctx.fillStyle=o.color,this._ctx.textBaseline="middle",this._ctx.fillText(h,u+o.paddingLeft,r)}}}}]),i}(dt),ft=function(t){function i(t,a,n,s){var r;return e(this,i),(r=h(this,c(i).call(this,t,a)))._axis=n,r._additionalDataProvider=s,r}return r(i,t),n(i,[{key:"_draw",value:function(){this._drawCrossHairLabel()}},{key:"_drawCrossHairLabel",value:function(){}}]),i}(Q),pt=function(t){function i(){return e(this,i),h(this,c(i).apply(this,arguments))}return r(i,t),n(i,[{key:"_drawCrossHairLabel",value:function(){if(this._chartData.crossHairSeriesTag()===this._additionalDataProvider.tag()){var t=this._chartData.styleOptions().floatLayer.crossHair,i=t.horizontal,e=i.text;if(t.display&&i.display&&e.display){var a=this._chartData.crossHairPoint();if(a){var n=lt(this._axis.convertFromPixel(a.y),this._chartData.precisionOptions[this._axis.isCandleStickYAxis()?"price":this._additionalDataProvider.technicalIndicatorType()]),s=e.size;this._ctx.font=Z(s);var r,c=U(this._ctx,n),o=e.paddingLeft,h=e.paddingTop,l=e.borderSize,u=c+2*l+o+e.paddingRight,_=s+2*l+h+e.paddingBottom,d=this._chartData.styleOptions().yAxis;r=d.position===y&&d.tickText.position===g||d.position===m&&d.tickText.position===k?0:this._width-u;var v=a.y-l-h-s/2;this._ctx.fillStyle=e.backgroundColor,this._ctx.fillRect(r,v,u,_),this._ctx.lineWidth=l,this._ctx.strokeStyle=e.borderColor,this._ctx.strokeRect(r,v,u,_),this._ctx.textBaseline="middle",this._ctx.fillStyle=e.color,this._ctx.fillText(n,r+l+o,a.y)}}}}}]),i}(ft),xt=function(t){function i(){return e(this,i),h(this,c(i).apply(this,arguments))}return r(i,t),n(i,[{key:"_createMainView",value:function(t,i){return new vt(t,i.chartData,i.yAxis)}},{key:"_createFloatLayerView",value:function(t,i){return new pt(t,i.chartData,i.yAxis,i.additionalDataProvider)}}]),i}(q),yt=function(){function t(i){e(this,t),this._chartData=i,this._width=0,this._height=0,this._minValue=0,this._maxValue=0,this._range=0,this._ticks=[]}return n(t,[{key:"setSize",value:function(t,i){this._width=t,this._height=i}},{key:"ticks",value:function(){return this._ticks}},{key:"computeAxis",value:function(){var t=this._computeMinMaxValue(),i=t.max,e=t.range;this._minValue=t.min,this._maxValue=i,this._range=e,this._ticks=this._computeOptimalTicks(this._computeTicks())}},{key:"_computeMinMaxValue",value:function(){}},{key:"_computeOptimalTicks",value:function(t){}},{key:"_computeTicks",value:function(){var t=[];if(this._range>=0){var i=+this._nice(this._range/8),e=this._getIntervalPrecision(i),a=+this._round(Math.ceil(this._minValue/i)*i,e),n=+this._round(Math.floor(this._maxValue/i)*i,e),s=0,r=a;if(0!==i)for(;+n>=r;)++s,r+=i;r=a;for(var c=0;s>c;c++)t[c]={v:+r.toFixed(e)},r+=i}return t}},{key:"_nice",value:function(t){var i=Math.floor(Math.log(t)/Math.log(10)),e=Math.pow(10,i),a=t/e;return t=(1>a?1:2>a?2:3>a?3:5>a?5:10)*e,-20>i?t:+t.toFixed(0>i?-i:0)}},{key:"_getIntervalPrecision",value:function(t){var i=""+t,e=i.indexOf("e");if(e>0){var a=+i.slice(e+1);return 0>a?-a:0}var n=i.indexOf(".");return 0>n?0:i.length-1-n}},{key:"_round",value:function(t,i){return null==i&&(i=10),t=(+t).toFixed(i=Math.min(Math.max(0,i),20))}}]),t}(),mt="candle_stick",gt="technical_indicator",kt=function(t){function i(t,a){var n;return e(this,i),(n=h(this,c(i).call(this,t)))._yAxisType=a,n}return r(i,t),n(i,[{key:"_compareMinMax",value:function(t,i,e){var a=ot(t,i.toLowerCase(),{});return Object.keys(a).forEach((function(t){var i=a[t];(i||0===i)&&(e[0]=Math.min(e[0],i),e[1]=Math.max(e[1],i))})),i!==I.BOLL&&i!==I.SAR||(e[0]=Math.min(e[0],t.low),e[1]=Math.max(e[1],t.high)),e}},{key:"_computeMinMaxValue",value:function(){var t=this._minValue,i=this._maxValue;if(t===1/0||i===-1/0||0===i&&0===t)return{min:0,max:0,range:0};var e=Math.abs(i-t);return 0===e&&(e=Math.abs((i+=1)-(t-=1))),{min:t-=e/100*10,max:i+=e/100*20,range:e=Math.abs(i-t)}}},{key:"_computeOptimalTicks",value:function(t){var i=[],e=t.length;if(e>0){var a=this._chartData.styleOptions().xAxis.tickText.size,n=this.convertToPixel(t[0].v),s=1;if(e>1){var r=this.convertToPixel(t[1].v),c=Math.abs(r-n);2*a>c&&(s=Math.ceil(2*a/c))}for(var o=0;e>o;o+=s){var h=t[o].v,l=this.convertToPixel(h);l>a&&this._height-a>l&&i.push({v:h,y:l})}}return i}},{key:"calcMinMaxValue",value:function(t,i){var e=this._chartData.dataList(),a=this._chartData.from(),n=this._chartData.to(),s=this._chartData.styleOptions().realTime.averageLine.display,r=[1/0,-1/0];if(i)for(var c=a;n>c;c++){var o=e[c],h=[o.close,r[0]],l=[o.close,r[1]];s&&(h.push(o.average),l.push(o.average)),r[0]=Math.min.apply(null,h),r[1]=Math.max.apply(null,l)}else{for(var u=a;n>u;u++){var _=e[u];this._compareMinMax(_,t,r),this.isCandleStickYAxis()&&(r[0]=Math.min(_.low,r[0]),r[1]=Math.max(_.high,r[1]))}t===I.VOL&&(r[0]=0)}r[0]!==1/0&&r[1]!==-1/0&&(this._minValue=r[0],this._maxValue=r[1])}},{key:"isCandleStickYAxis",value:function(){return this._yAxisType===mt}},{key:"convertFromPixel",value:function(t){return(1-t/this._height)*this._range+this._minValue}},{key:"convertToPixel",value:function(t){return Math.floor((1-(t-this._minValue)/this._range)*this._height)}}]),i}(yt),Tt=function(t){function i(t){var a;return e(this,i),(a=h(this,c(i).call(this,t)))._technicalIndicatorType=t.technicalIndicatorType||I.MACD,a._calcTechnicalIndicator(),a}return r(i,t),n(i,[{key:"_initBefore",value:function(t){this._tag=t.tag,this._yAxis=this._createYAxis(t)}},{key:"_createYAxis",value:function(t){return new kt(t.chartData,gt)}},{key:"_createMainWidget",value:function(t,i){return new _t({container:t,chartData:i.chartData,xAxis:i.xAxis,yAxis:this._yAxis,additionalDataProvider:{technicalIndicatorType:this.technicalIndicatorType.bind(this),tag:this.tag.bind(this)}})}},{key:"_createYAxisWidget",value:function(t,i){return new xt({container:t,chartData:i.chartData,yAxis:this._yAxis,additionalDataProvider:{technicalIndicatorType:this.technicalIndicatorType.bind(this),tag:this.tag.bind(this)}})}},{key:"_computeAxis",value:function(){this._yAxis.calcMinMaxValue(this._technicalIndicatorType,this._isRealTime()),this._yAxis.computeAxis()}},{key:"_isRealTime",value:function(){return!1}},{key:"_calcTechnicalIndicator",value:function(){this._chartData.calcTechnicalIndicator(this._technicalIndicatorType)&&this.invalidate(X)}},{key:"tag",value:function(){return this._tag}},{key:"setSize",value:function(t,e){l(c(i.prototype),"setSize",this).call(this,t,e),this._yAxis.setSize(e.width,e.height)}},{key:"technicalIndicatorType",value:function(){return this._technicalIndicatorType}},{key:"setTechnicalIndicatorType",value:function(t){this._technicalIndicatorType!==t&&(this._technicalIndicatorType=t,this._calcTechnicalIndicator())}}]),i}(K),Dt=function(t){function i(){return e(this,i),h(this,c(i).apply(this,arguments))}return r(i,t),n(i,[{key:"_draw",value:function(){this._drawGrid(),this._additionalDataProvider.chartType()===T.REAL_TIME?this._drawRealTime():(this._drawCandleStick(),this._drawTechnicalIndicator(),this._drawHighestPriceMark(),this._drawLowestPriceMark()),this._drawLastPriceLine()}},{key:"_drawRealTime",value:function(){var t=this,i=[],e=[{x:0,y:this._height}],a=[],n=this._chartData.from(),s=this._chartData.range(),r=this._chartData.to();this._drawGraphics((function(s,r,c){var o=c.average,h=t._yAxis.convertToPixel(c.close),l=t._yAxis.convertToPixel(o);i.push({x:s,y:h}),(o||0===o)&&a.push({x:s,y:l}),r===n&&e.push({x:0,y:h}),e.push({x:s,y:h})}),(function(){var c=e.length;if(c>0){var o=e[c-1];!(s>n-r)?(e.push({x:t._width,y:o.y}),e.push({x:t._width,y:t._height})):e.push({x:o.x,y:t._height})}var h=t._chartData.styleOptions().realTime,l=h.timeLine;if(i.length>0){t._ctx.lineWidth=l.size,t._ctx.strokeStyle=l.color,t._ctx.beginPath(),t._ctx.moveTo(i[0].x,i[0].y);for(var u=1;i.length>u;u++)t._ctx.lineTo(i[u].x,i[u].y);t._ctx.stroke(),t._ctx.closePath()}if(e.length>0){t._ctx.fillStyle=l.areaFillColor,t._ctx.beginPath(),t._ctx.moveTo(e[0].x,e[0].y);for(var _=1;e.length>_;_++)t._ctx.lineTo(e[_].x,e[_].y);t._ctx.closePath(),t._ctx.fill()}var d=h.averageLine;if(d.display&&a.length>0){t._ctx.lineWidth=d.size,t._ctx.strokeStyle=d.color,t._ctx.beginPath(),t._ctx.moveTo(a[0].x,a[0].y);for(var v=1;a.length>v;v++)t._ctx.lineTo(a[v].x,a[v].y);t._ctx.stroke(),t._ctx.closePath()}}))}},{key:"_drawCandleStick",value:function(){var t=this;this._ctx.lineWidth=1;var i=[],e=-1/0,a=-1,n=1/0,s=-1,r=this._chartData.dataList(),c=this._chartData.styleOptions().candleStick;this._drawGraphics((function(o,h,l,u,_){var d=r[h-1]||{},v=d.close||-1/0,f=l.high,p=l.low,x=l.close,y=l.open;if(f>e&&(e=f,a=o),n>p&&(n=p,s=o),x>v?(t._ctx.strokeStyle=c.bar.upColor,t._ctx.fillStyle=c.bar.upColor):(t._ctx.strokeStyle=c.bar.downColor,t._ctx.fillStyle=c.bar.downColor),c.bar.style!==S){var m=t._yAxis.convertToPixel(y),g=t._yAxis.convertToPixel(x),k=t._yAxis.convertToPixel(f),T=t._yAxis.convertToPixel(p),M=[],P=[];switch(M[0]=k,P[1]=T,m>g?(M[1]=g,P[0]=m,i=[o-u,g,_,m-g]):g>m?(M[1]=m,P[0]=g,i=[o-u,m,_,g-m]):(M[1]=m,P[0]=g,i=[o-u,m,_,1]),t._ctx.beginPath(),t._ctx.moveTo(o,M[0]),t._ctx.lineTo(o,M[1]),t._ctx.stroke(),t._ctx.closePath(),t._ctx.beginPath(),t._ctx.moveTo(o,P[0]),t._ctx.lineTo(o,P[1]),t._ctx.stroke(),t._ctx.closePath(),1>i[3]&&(i[3]=1),c.bar.style){case D:t._ctx.fillRect(i[0],i[1],i[2],i[3]);break;case b:t._ctx.strokeRect(i[0],i[1],i[2],i[3]);break;case L:x>v?t._ctx.strokeRect(i[0],i[1],i[2],i[3]):t._ctx.fillRect(i[0],i[1],i[2],i[3]);break;case w:x>v?t._ctx.fillRect(i[0],i[1],i[2],i[3]):t._ctx.strokeRect(i[0],i[1],i[2],i[3])}}else t._drawOhlc(u,o,l,d,c.bar.upColor,c.bar.downColor)})),this._highestMarkData={x:a,price:e},this._lowestMarkData={x:s,price:n}}},{key:"_drawHighestPriceMark",value:function(t){if(this._highestMarkData){var i=this._highestMarkData.price,e=this._chartData.styleOptions().candleStick.priceMark,a=e.high;i!==-1/0&&e.display&&a.display&&this._drawLowestHighestPriceMark(a,this._highestMarkData.x,i,!0,this._chartData.precisionOptions().price)}}},{key:"_drawLowestPriceMark",value:function(){if(this._lowestMarkData){var t=this._lowestMarkData.price,i=this._chartData.styleOptions().candleStick.priceMark,e=i.low;t!==1/0&&i.display&&e.display&&this._drawLowestHighestPriceMark(e,this._lowestMarkData.x,t,!1,this._chartData.precisionOptions().price)}}},{key:"_drawLowestHighestPriceMark",value:function(t,i,e,a,n){var s=i,r=this._yAxis.convertToPixel(e)+(a?-2:2);this._ctx.textAlign="left",this._ctx.lineWidth=1,this._ctx.strokeStyle=t.color,this._ctx.fillStyle=t.color,this._ctx.beginPath(),this._ctx.moveTo(s,r),this._ctx.lineTo(s-2,r+(a?-2:2)),this._ctx.stroke(),this._ctx.closePath(),this._ctx.beginPath(),this._ctx.moveTo(s,r),this._ctx.lineTo(s+2,r+(a?-2:2)),this._ctx.stroke(),this._ctx.closePath(),this._ctx.beginPath(),this._ctx.moveTo(s,r),this._ctx.lineTo(s,r+=a?-5:5),this._ctx.stroke(),this._ctx.closePath(),this._ctx.beginPath(),this._ctx.moveTo(s,r),this._ctx.lineTo(s+5,r),this._ctx.stroke(),this._ctx.closePath(),this._ctx.font=Z(t.textSize);var c=lt(e,n);this._ctx.textBaseline="middle",this._ctx.fillText(c,s+5+t.textMargin,r)}},{key:"_drawLastPriceLine",value:function(){var t=this._chartData.dataList(),i=t.length,e=this._chartData.styleOptions().candleStick.priceMark,a=e.last;if(e.display&&a.display&&a.line.display&&0!==i){var n=(t[i-2]||{}).close||-1/0,s=t[i-1].close,r=this._yAxis.convertToPixel(s);r=+Math.max(.05*this._height,Math.min(r,.98*this._height)).toFixed(0);var c=a.line;this._ctx.strokeStyle=s>n?a.upColor:a.downColor,this._ctx.lineWidth=c.size,c.style===x&&this._ctx.setLineDash(c.dashValue),this._ctx.beginPath(),this._ctx.moveTo(0,r),this._ctx.lineTo(this._width,r),this._ctx.stroke(),this._ctx.closePath(),this._ctx.setLineDash([])}}}]),i}($),bt=function(t){function a(){return e(this,a),h(this,c(a).apply(this,arguments))}return r(a,t),n(a,[{key:"_drawPrompt",value:function(t,i){var e=this._chartData.styleOptions().floatLayer.prompt.candleStick,a=this._getCandleStickPromptData(t,e);e.showType===A?(this._drawCandleStickStandardPromptText(e,a),this._drawTechnicalIndicatorPrompt(t,i,e.text.size+e.text.marginTop)):this._drawCandleStickRectPromptText(t,i,e,a)}},{key:"_drawCandleStickStandardPromptText",value:function(t,e){var a=this,n=e,s=t.text.marginLeft,r=t.text.marginRight,c=t.text.size,o=t.text.color,h=t.labels;this._ctx.textBaseline="top",this._ctx.font=Z(c);var l=s,u=t.text.marginTop;h.forEach((function(t,e){var c=t?"".concat(t,": "):"",h=U(a._ctx,c);a._ctx.fillStyle=o,a._ctx.fillText(c,l,u),l+=h;var _,d=n[e]||"--";"object"===i(d)?(_=d.value||"--",a._ctx.fillStyle=d.color||o):(a._ctx.fillStyle=o,_=d);var v=U(a._ctx,_);a._ctx.fillText(_,l,u),l+=v+s+r}))}},{key:"_drawCandleStickRectPromptText",value:function(t,e,a,n){var s=this,r=a.labels,c=n,o=a.text.marginLeft,h=a.text.marginRight,l=a.text.marginTop,u=a.text.marginBottom,_=a.text.size,d=a.text.color;this._ctx.textBaseline="top",this._ctx.font=Z(_);var v=0;r.forEach((function(t,e){var a=c[e]||"--",n=a;"object"===i(a)&&(n=a.value||"--");var r="".concat(t,": ").concat(n),l=U(s._ctx,r)+o+h;v=Math.max(v,l)}));var f=this._getTechnicalIndicatorPromptData(t),p=f.labels||[],x=f.values||[],y=this._chartData.styleOptions().floatLayer.prompt.technicalIndicator,m=y.text.marginLeft,g=y.text.marginRight,k=y.text.marginTop,T=y.text.marginBottom,D=y.text.size;this._ctx.font=Z(D),p.forEach((function(t,i){var e=x[i]||"--",a="".concat(t,": ").concat(e),n=U(s._ctx,a)+m+g;v=Math.max(v,n)}));var b,L=a.rect,w=L.borderSize,S=L.paddingLeft,M=L.paddingRight,P=L.paddingTop,A=2*w+v+S+M,E=2*w+P+L.paddingBottom+(u+l+_)*r.length+(k+T+D)*p.length;b=this._width/2>e?this._width-L.right-A:L.left;var I=L.top,C=L.borderRadius;this._ctx.lineWidth=w,this._ctx.strokeStyle=L.borderColor,this._ctx.fillStyle=L.fillColor,this._drawRoundRect(b,I,A,E,C),this._ctx.stroke(),this._drawRoundRect(b,I,A,E,C),this._ctx.fill();var R=b+w+S+o,O=I+w+P;this._ctx.font=Z(_),r.forEach((function(t,e){O+=l,s._ctx.textAlign="left",s._ctx.fillStyle=d,s._ctx.fillText("".concat(t,": "),R,O);var a,n=c[e]||"--";s._ctx.fillStyle=n.color||d,a="object"===i(n)?n.value||"--":n,s._ctx.textAlign="right",s._ctx.fillText(a,b+A-w-h-M,O),O+=_+u}));var z=this._chartData.styleOptions().technicalIndicator,V=z.line.colors,Y=b+w+S+m,H=V.length;this._ctx.font=Z(D),p.forEach((function(t,i){O+=k,s._ctx.textAlign="left",s._ctx.fillStyle=V[i%H]||z.text.color,s._ctx.fillText("".concat(t.toUpperCase(),": "),Y,O),s._ctx.textAlign="right",s._ctx.fillText(x[i]||"--",b+A-w-g-M,O),O+=D+T})),this._ctx.textAlign="left"}},{key:"_drawRoundRect",value:function(t,i,e,a,n){this._ctx.beginPath(),this._ctx.moveTo(t+n,i),this._ctx.arcTo(t+e,i,t+e,i+a,n),this._ctx.arcTo(t+e,i+a,t,i+a,n),this._ctx.arcTo(t,i+a,t,i,n),this._ctx.arcTo(t,i,t+e,i,n),this._ctx.closePath()}},{key:"_getCandleStickPromptData",value:function(t,i){var e=i.values,a=[];if(e)a="function"==typeof e?e(t)||[]:e;else{var n=this._chartData.precisionOptions();(a=[ot(t,"timestamp"),ot(t,"open"),ot(t,"close"),ot(t,"high"),ot(t,"low"),ot(t,"volume")]).forEach((function(t,i){switch(i){case 0:a[i]=ht(t,"YYYY-MM-DD hh:mm");break;case a.length-1:a[i]=lt(t,n.volume);break;default:a[i]=lt(t,n.price)}}))}return a}}]),a}(ut),Lt=function(t){function i(){return e(this,i),h(this,c(i).apply(this,arguments))}return r(i,t),n(i,[{key:"_createMainView",value:function(t,i){return new Dt(t,i.chartData,i.xAxis,i.yAxis,i.additionalDataProvider)}},{key:"_createFloatLayerView",value:function(t,i){return new bt(t,i.chartData,i.xAxis,i.yAxis,i.additionalDataProvider)}}]),i}(_t),wt=function(t){function i(t){var a;return e(this,i),(a=h(this,c(i).call(this,t)))._chartType=T.CANDLE,a}return r(i,t),n(i,[{key:"_createYAxis",value:function(t){return new kt(t.chartData,mt)}},{key:"_createMainWidget",value:function(t,i){return new Lt({container:t,chartData:i.chartData,xAxis:i.xAxis,yAxis:this._yAxis,additionalDataProvider:{technicalIndicatorType:this.technicalIndicatorType.bind(this),chartType:this.chartType.bind(this),tag:this.tag.bind(this)}})}},{key:"_isRealTime",value:function(){return this._chartType===T.REAL_TIME}},{key:"chartType",value:function(){return this._chartType}},{key:"setChartType",value:function(t){this._chartType!==t&&(this._chartType=t,this._chartData.styleOptions().realTime.averageLine.display&&this._isRealTime()&&(this._chartData.calcTechnicalIndicator(I.AVERAGE),this.invalidate(X)))}}]),i}(Tt),St=function(t){function i(){return e(this,i),h(this,c(i).apply(this,arguments))}return r(i,t),n(i,[{key:"_drawAxisLine",value:function(){var t=this._chartData.styleOptions().xAxis;t.display&&t.axisLine.display&&(this._ctx.strokeStyle=t.axisLine.color,this._ctx.lineWidth=t.axisLine.size,this._ctx.beginPath(),this._ctx.moveTo(0,0),this._ctx.lineTo(this._width,0),this._ctx.stroke(),this._ctx.closePath())}},{key:"_drawTickLines",value:function(){var t=this,i=this._chartData.styleOptions().xAxis,e=i.tickLine;if(i.display&&e.display){this._ctx.lineWidth=e.size,this._ctx.strokeStyle=e.color;var a=i.axisLine.display?i.axisLine.size:0,n=a+e.length;this._axis.ticks().forEach((function(i){var e=i.x;t._ctx.beginPath(),t._ctx.moveTo(e,a),t._ctx.lineTo(e,n),t._ctx.stroke(),t._ctx.closePath()}))}}},{key:"_drawTickLabels",value:function(){var t=this._chartData.styleOptions().xAxis,i=t.tickText;if(t.display&&i.display){var e=t.tickLine;this._ctx.textBaseline="top",this._ctx.font=Z(i.size),this._ctx.textAlign="center",this._ctx.fillStyle=i.color;var a=i.margin;t.axisLine.display&&(a+=t.axisLine.size),e.display&&(a+=e.length);for(var n=this._chartData.dataList(),s=this._axis.ticks(),r=s.length,c=0;r>c;c++){var o=s[c].x,h=n[parseInt(s[c].v)].timestamp,l=ht(h,this._axis.tickLabelFormatType());if(c!==r-1){var u=n[parseInt(s[c+1].v)].timestamp,_=ht(h,"YYYY"),d=ht(h,"YYYY-MM"),v=ht(h,"MM-DD");_!==ht(u,"YYYY")?l=_:d!==ht(u,"YYYY-MM")?l=d:v!==ht(u,"MM-DD")&&(l=v)}this._ctx.fillText(l,o,a)}}}}]),i}(dt),Mt=function(t){function i(){return e(this,i),h(this,c(i).apply(this,arguments))}return r(i,t),n(i,[{key:"_drawCrossHairLabel",value:function(){if(this._chartData.crossHairSeriesTag()){var t=this._chartData.styleOptions().floatLayer.crossHair,i=t.vertical,e=i.text;if(t.display&&i.display&&e.display){var a=this._chartData.getCrossHairDataPos(),n=this._chartData.dataList()[a];if(n){var s=this._axis.convertToPixel(a),r=ht(n.timestamp,"YYYY-MM-DD hh:mm"),c=e.size;this._ctx.font=Z(c);var o=U(this._ctx,r),h=s-o/2,l=e.paddingLeft,u=e.paddingRight,_=e.paddingTop,d=e.borderSize;l+d>h?h=l+d:h>this._width-o-d-u&&(h=this._width-o-d-u);var v=h-d-l,f=h+o+d+u,p=0+c+2*d+_+e.paddingBottom;this._ctx.fillStyle=e.backgroundColor,this._ctx.fillRect(v,0,f-v,p-0),this._ctx.lineWidth=d,this._ctx.strokeStyle=e.borderColor,this._ctx.strokeRect(v,0,f-v,p-0),this._ctx.textBaseline="top",this._ctx.fillStyle=e.color,this._ctx.fillText(r,h,d+_)}}}}}]),i}(ft),Pt=function(t){function i(){return e(this,i),h(this,c(i).apply(this,arguments))}return r(i,t),n(i,[{key:"_createMainView",value:function(t,i){return new St(t,i.chartData,i.xAxis)}},{key:"_createFloatLayerView",value:function(t,i){return new Mt(t,i.chartData,i.xAxis)}}]),i}(q),At=function(t){function i(t){var a;return e(this,i),(a=h(this,c(i).call(this,t)))._initMeasureCanvas(),a}return r(i,t),n(i,[{key:"_initMeasureCanvas",value:function(){var t=document.createElement("canvas");this._measureCtx=t.getContext("2d");var i=J(this._measureCtx);this._measureCtx.scale(i,i)}},{key:"_computeMinMaxValue",value:function(){var t=this._chartData.from(),i=this._chartData.to()-1;return{min:t,max:i,range:i-t}}},{key:"_computeOptimalTicks",value:function(t){var i=[],e=t.length,a=this._chartData.dataList();if(e>0){var n=this._chartData.styleOptions().xAxis.tickText.size;this._measureCtx.font=Z(n);var s=U(this._measureCtx,"00-00 00:00"),r=parseInt(t[0].v),c=ot(a[r],"timestamp",0),o=this.convertToPixel(r),h=1;if(this._tickLabelFormatType="MM:DD hh:mm",e>1){var l=parseInt(t[1].v),u=ot(a[l],"timestamp",0),_=this.convertToPixel(l),d=Math.abs(_-o);s>d&&(h=Math.ceil(s/d));var v=(u-c)/1e3/60;this._tickLabelFormatType=720>v?"hh:mm":21600>v?"MM-DD":259200>v?"YYYY-MM":"YYYY"}for(var f=0;e>f;f+=h){var p=t[f].v,x=this.convertToPixel(p);x>s/2&&this._width-s/2>x&&i.push({v:p,x:x})}}return i}},{key:"tickLabelFormatType",value:function(){return this._tickLabelFormatType}},{key:"convertFromPixel",value:function(t){var i=this._chartData.dataSpace(),e=Math.floor(t/i);return this._chartData.from()+e-1}},{key:"convertToPixel",value:function(t){var i=this._chartData.dataSpace();return Math.floor((t-this._chartData.from())*i+this._chartData.barSpace()/2)}}]),i}(yt),Et=function(t){function i(){return e(this,i),h(this,c(i).apply(this,arguments))}return r(i,t),n(i,[{key:"_initBefore",value:function(){this._xAxis=new At(this._chartData)}},{key:"_createMainWidget",value:function(t,i){return new Pt({container:t,chartData:i.chartData,xAxis:this._xAxis})}},{key:"_computeAxis",value:function(){this._xAxis.computeAxis()}},{key:"xAxis",value:function(){return this._xAxis}},{key:"setSize",value:function(t,e){l(c(i.prototype),"setSize",this).call(this,t,e),this._xAxis.setSize(t.width,t.height)}}]),i}(K),It="candle_stick_series_tag",Ct=function(){function t(i,a){e(this,t),this._container=i,this._technicalIndicatorBaseId=0,this._chartData=new G(a,this._updateSeries.bind(this)),this._xAxisSeries=new Et({container:i,chartData:this._chartData}),this._candleStickSeries=new wt({container:i,chartData:this._chartData,xAxis:this._xAxisSeries.xAxis(),technicalIndicatorType:I.MA,tag:It}),this._technicalIndicatorSeries={},this.measureSeriesSize()}return n(t,[{key:"_measureXAxisHeight",value:function(){var t=this._chartData.styleOptions().xAxis,i=t.tickText,e=t.tickLine,a=i.size+i.margin;return t.display&&e.display&&(a+=e.length),t.display&&t.axisLine.display&&(a+=t.axisLine.size),+Math.ceil(+(a=Math.max(t.minHeight,Math.min(a,t.maxHeight)))).toFixed(0)}},{key:"_measureYAxisWidth",value:function(){var t=this._chartData.styleOptions().yAxis,i=t.tickText,e=t.tickLine;if(((i.display||e.display||i.margin>0)&&i.position===k||t.axisLine.display)&&t.display){var a=0;i.position===k&&(a+=i.margin,t.display&&e.display&&(a+=e.length));var n=t.axisLine.size;return t.display&&t.axisLine.display&&(a+=n),a>n&&(a=Math.max(t.minWidth,Math.min(a,t.maxWidth))),Math.ceil(a)}return 0}},{key:"_updateSeries",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:X;for(var i in this._xAxisSeries.invalidate(t),this._candleStickSeries.invalidate(t),this._technicalIndicatorSeries)this._technicalIndicatorSeries[i].invalidate(t)}},{key:"_calcAllSeriesTechnicalIndicator",value:function(){var t=[];for(var i in this._candleStickSeries.chartType()===T.CANDLE?t.push(this._candleStickSeries.technicalIndicatorType()):this._chartData.calcTechnicalIndicator(I.AVERAGE),this._technicalIndicatorSeries){var e=this._technicalIndicatorSeries[i].technicalIndicatorType();0>t.indexOf(e)&&t.push(e)}for(var a=0,n=t;n.length>a;a++){this._chartData.calcTechnicalIndicator(n[a])}this._updateSeries()}},{key:"chartData",value:function(){return this._chartData}},{key:"measureSeriesSize",value:function(){var t,i=this._container.offsetHeight,e=this._container.offsetWidth,a=this._measureXAxisHeight(),n=this._measureYAxisWidth(),s=i-a,r=e-n,c=Object.values(this._technicalIndicatorSeries).length,o=s-c*(t=Math.floor(.2*c>.4?.6*s/c:.2*s)),h=this._chartData.styleOptions().yAxis.position===y,l=r,u=0;for(var _ in h&&(l=0,u=n),this._chartData.setTotalDataSpace(r),this._candleStickSeries.setSize({left:u,width:r,height:o},{left:l,width:n,height:o}),this._technicalIndicatorSeries)this._technicalIndicatorSeries[_].setSize({left:u,width:r,height:t},{left:l,width:n,height:t});this._xAxisSeries.setSize({left:u,width:r,height:a},{left:l,width:n,height:a})}},{key:"applyStyleOptions",value:function(t){this._chartData.applyStyleOptions(t),this.measureSeriesSize()}},{key:"applyNewData",value:function(t){_(t)&&(this._chartData.clearDataList(),this._chartData.addData(t,0),this._calcAllSeriesTechnicalIndicator())}},{key:"applyMoreData",value:function(t){_(t)&&(this._chartData.addData(t,0),this._calcAllSeriesTechnicalIndicator())}},{key:"updateData",value:function(t){if(d(t)&&!_(t)){var i=this._chartData.dataList(),e=i.length,a=e;+ot(t,"timestamp",0)===+ot(i[e-1],"timestamp",0)&&(a=e-1),this._chartData.addData(t,a),this._calcAllSeriesTechnicalIndicator()}}},{key:"createTechnicalIndicator",value:function(t){this._technicalIndicatorBaseId++;var i="".concat("technical_indicator_").concat(this._technicalIndicatorBaseId);return this._technicalIndicatorSeries[i]=new Tt({container:this._container,chartData:this._chartData,xAxis:this._xAxisSeries.xAxis(),technicalIndicatorType:t,tag:i}),this.measureSeriesSize(),i}},{key:"removeTechnicalIndicator",value:function(t){var i=this._technicalIndicatorSeries[t];i&&(i.destroy(),delete this._technicalIndicatorSeries[t],this.measureSeriesSize())}},{key:"setTechnicalIndicatorType",value:function(t,i){if(t===It)this._technicalIndicatorSeries.setTechnicalIndicatorType(i);else{var e=this._technicalIndicatorSeries[t];e&&(i===I.NO?this.removeTechnicalIndicator(t):e.setTechnicalIndicatorType(i))}}}]),t}(),Rt=function(){function t(i,a){e(this,t),this._chartSeries=new Ct(i,a)}return n(t,[{key:"resize",value:function(){this._chartSeries.measureSeriesSize()}},{key:"clearData",value:function(){this._chartSeries.chartData().clearDataList()}},{key:"applyStyleOptions",value:function(t){this._chartSeries.applyStyleOptions(t)}},{key:"applyNewData",value:function(t){this._chartSeries.applyNewData(t)}},{key:"applyMoreData",value:function(t){this._chartSeries.applyMoreData(t)}},{key:"updateData",value:function(t){this._chartSeries.updateData(t)}},{key:"setCandleStickTechnicalIndicatorType",value:function(t){this._chartSeries.setTechnicalIndicatorType(It,t)}},{key:"setTechnicalIndicatorType",value:function(t,i){this._chartSeries.setTechnicalIndicatorType(t,i)}},{key:"addTechnicalIndicator",value:function(t){return this._chartSeries.createTechnicalIndicator(t)}},{key:"removeTechnicalIndicator",value:function(t){this._chartSeries.removeTechnicalIndicator(t)}}]),t}(),Ot="development"===process.env.NODE_ENV,zt={},Vt=1;t.dispose=function(t){if(t){var i=t.chart_id;!i&&t instanceof Rt&&(i=t.id),i&&delete zt[i]}},t.init=function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)throw Error("Chart version is 4.2.0. Root dom is null, can not initialize the chart!!!");var e=zt[t.chart_id||""];if(e)return Ot&&console.warn("The chart has been initialized on the dom！！！"),e;var a="k_line_chart_".concat(Vt++),n=new Rt(t,i);return n.id=a,t.chart_id=a,zt[a]=n,n},t.version=function(){return"4.2.0"},Object.defineProperty(t,"__esModule",{value:!0})}));
