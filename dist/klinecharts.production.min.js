!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t=t||self).klinecharts={})}(this,(function(t){"use strict";function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var i=0;e.length>i;i++){var a=e[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,a.key,a)}}function n(t,e,i){return e&&a(t.prototype,e),i&&a(t,i),t}function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&c(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function c(t,e){return(c=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function h(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}function l(t,e,i){return(l="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(t,e,i){var a=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=o(t)););return t}(t,e);if(a){var n=Object.getOwnPropertyDescriptor(a,e);return n.get?n.get.call(i):n.value}})(t,e,i||t)}function _(t,e){if(p(t)&&p(e))for(var i in e)if(t.hasOwnProperty(i)){var a=t[i],n=e[i];p(n)&&p(a)&&!v(n)&&!v(a)?_(a,n):(e[i]||0===e[i]||!1===e[i])&&(t[i]=e[i])}}function u(t){if(!t||!p(t))return t;var e,i,a;for(i in e=v(t)?[]:{},t)t.hasOwnProperty(i)&&(e[i]=(a=t[i])&&p(a)?u(a):a);return e}function v(t){return"[object Array]"===Object.prototype.toString.call(t)}function d(t){return"function"==typeof t}function p(t){var i=e(t);return"function"===i||!!t&&"object"===i}function f(t){return"number"==typeof t&&!isNaN(t)}var x,y,m="dash",g="left",k="right",T="inside",M="outside",D={REAL_TIME:"real_time",CANDLE:"candle"},S="solid",w="stroke",L="increasing_stroke",E="decreasing_stroke",A="ohlc",P="always",b="follow_cross",I="standard",C={grid:{display:!0,horizontal:{display:!0,size:1,color:"#393939",style:m,dashValue:[2,2]},vertical:{display:!0,size:1,color:"#393939",style:m,dashValue:[2,2]}},candleStick:{bar:{style:S,upColor:"#26A69A",downColor:"#EF5350"},priceMark:{display:!0,high:{display:!0,color:"#D9D9D9",textMargin:5,textSize:10},low:{display:!0,color:"#D9D9D9",textMargin:5,textSize:10},last:{display:!0,upColor:"#26A69A",downColor:"#EF5350",line:{display:!0,style:m,dashValue:[4,4],size:1},text:{display:!0,size:12,paddingLeft:2,paddingTop:2,paddingRight:2,paddingBottom:2,color:"#FFFFFF"}}}},realTime:{timeLine:{color:"#1e88e5",size:1,areaFillColor:"rgba(30, 136, 229, 0.08)"},averageLine:{display:!0,color:"#F5A623",size:1}},technicalIndicator:{bar:{upColor:"#26A69A",downColor:"#EF5350"},line:{size:1,colors:["#D9D9D9","#F5A623","#F601FF","#1587DD","#1e88e5"]}},xAxis:{display:!0,maxHeight:50,minHeight:30,axisLine:{display:!0,color:"#888888",size:1},tickText:{display:!0,color:"#D9D9D9",size:12,margin:3},tickLine:{display:!0,size:1,length:3,color:"#888888"}},yAxis:{display:!0,maxWidth:100,minWidth:60,position:k,axisLine:{display:!0,color:"#888888",size:1},tickText:{position:M,display:!0,color:"#D9D9D9",size:12,margin:3},tickLine:{display:!0,size:1,length:3,color:"#888888"}},separator:{size:1,color:"#888888",fill:!1},floatLayer:{crossHair:{display:!0,horizontal:{display:!0,line:{display:!0,style:m,dashValue:[4,2],size:1,color:"#888888"},text:{display:!0,color:"#D9D9D9",size:12,paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderColor:"#505050",backgroundColor:"#505050"}},vertical:{display:!0,line:{display:!0,style:m,dashValue:[4,2],size:1,color:"#888888"},text:{display:!0,color:"#D9D9D9",size:12,paddingLeft:2,paddingRight:2,paddingTop:2,paddingBottom:2,borderSize:1,borderColor:"#505050",backgroundColor:"#505050"}}},prompt:{displayRule:P,candleStick:{showType:I,labels:["时间","开","收","高","低","成交量"],values:null,rect:{paddingLeft:0,paddingRight:0,paddingTop:0,paddingBottom:6,left:8,top:8,right:8,borderRadius:4,borderSize:1,borderColor:"#3f4254",fillColor:"rgba(17, 17, 17, .3)"},text:{size:12,color:"#D9D9D9",marginLeft:8,marginTop:6,marginRight:8,marginBottom:0}},technicalIndicator:{text:{size:12,color:"#D9D9D9",marginTop:6,marginRight:8,marginBottom:0,marginLeft:8}}}},graphicMark:{line:{color:"#1e88e5",size:1},point:{backgroundColor:"#1e88e5",borderColor:"#1e88e5",borderSize:1,radius:4,activeBackgroundColor:"#1e88e5",activeBorderColor:"#1e88e5",activeBorderSize:1,activeRadius:6},text:{color:"#1e88e5",size:12,marginLeft:2,marginRight:2,marginTop:2,marginBottom:6}}},R={NO:"NO",AVERAGE:"AVERAGE",MA:"MA",VOL:"VOL",MACD:"MACD",BOLL:"BOLL",KDJ:"KDJ",RSI:"RSI",BIAS:"BIAS",BRAR:"BRAR",CCI:"CCI",DMI:"DMI",CR:"CR",PSY:"PSY",DMA:"DMA",TRIX:"TRIX",OBV:"OBV",VR:"VR",WR:"WR",MTM:"MTM",EMV:"EMV",SAR:"SAR"},O=(r(x={},R.MA,[5,10,30,60]),r(x,R.VOL,[5,10,20]),r(x,R.MACD,[12,26,9]),r(x,R.BOLL,[20]),r(x,R.KDJ,[9,3,3]),r(x,R.RSI,[6,12,24]),r(x,R.BIAS,[6,12,24]),r(x,R.BRAR,[26]),r(x,R.CCI,[13]),r(x,R.DMI,[14,6]),r(x,R.CR,[26,10,20,40,60]),r(x,R.PSY,[12]),r(x,R.DMA,[10,50,10]),r(x,R.TRIX,[12,20]),r(x,R.OBV,[30]),r(x,R.VR,[24,30]),r(x,R.WR,[13,34,89]),r(x,R.MTM,[6,10]),r(x,R.EMV,[14,9]),r(x,R.SAR,[2,2,20]),x),N=(r(y={price:2,volume:0},R.NO,2),r(y,R.MA,2),r(y,R.VOL,0),r(y,R.MACD,2),r(y,R.BOLL,2),r(y,R.KDJ,2),r(y,R.RSI,2),r(y,R.BIAS,2),r(y,R.BRAR,4),r(y,R.CCI,4),r(y,R.DMI,4),r(y,R.CR,2),r(y,R.PSY,2),r(y,R.DMA,4),r(y,R.TRIX,4),r(y,R.OBV,4),r(y,R.VR,4),r(y,R.WR,4),r(y,R.MTM,4),r(y,R.EMV,4),r(y,R.SAR,2),y),H={};function z(t,e){for(var i=t.length,a=0;i>a;a++)e(a);return t}function G(t,e){for(var i=0,a=0;t.length>a;a++){var n=t[a].close-e;i+=n*n}var r=i>0,s=Math.sqrt((i=Math.abs(i))/t.length);return r?s:-1*s}function Y(t){var e=0;if(t&&t.length>0){var i=t.length;e=t[0].high;for(var a=1;i>a;a++)e=Math.max(t[a].high,e)}return e}function V(t){var e=0;if(t&&t.length>0){var i=t.length;e=t[0].low;for(var a=1;i>a;a++)e=Math.min(t[a].low,e)}return e}function F(t){var e=0,i=0;if(t&&t.length>0){var a=t.length;e=t[0].high,i=t[0].low;for(var n=1;a>n;n++)e=Math.max(t[n].high,e),i=Math.min(t[n].low,i)}return[e,i]}function B(t){return t&&v(t)}function W(t,e){return B(t)&&t.length===e}H[R.AVERAGE]=function(t){var e=0,i=0;return z(t,(function(a){e+=t[a].turnover||0,t[a].average=0!==(i+=t[a].volume||0)?e/i:0}))},H[R.MA]=function(t,e){if(!B(e))return t;var i=[],a=e.length;return z(t,(function(n){for(var r={},s=t[n].close,o=0;a>o;o++){i[o]=(i[o]||0)+s;var c=e[o];c>n?r["ma".concat(c)]=i[o]/(n+1):(i[o]-=t[n-c].close,r["ma".concat(c)]=i[o]/c)}t[n].ma=r}))},H[R.VOL]=function(t,e){if(!B(e))return t;var i=[],a=e.length;return z(t,(function(n){for(var r=t[n].volume,s={},o=0;a>o;o++){i[o]=(i[o]||0)+r;var c=e[o];c>n?s["ma".concat(c)]=i[o]/(n+1):(i[o]-=t[n-c].volume,s["ma".concat(c)]=i[o]/c)}s.num=r,t[n].vol=s}))},H[R.MACD]=function(t,e){if(!W(e,3))return t;var i,a,n=0,r=0,s=0,o=0,c=0;return z(t,(function(h){var l=t[h].close;0===h?(i=l,a=l):(i=(2*l+(e[0]-1)*n)/(e[0]+1),a=(2*l+(e[1]-1)*r)/(e[1]+1)),n=i,r=a,c=o=(2*(s=i-a)+c*(e[2]-1))/(e[2]+1),t[h].macd={diff:s,dea:o,macd:2*(s-o)}}))},H[R.BOLL]=function(t,e){if(!W(e,1))return t;var i,a,n=0;return z(t,(function(r){n+=t[r].close,e[0]>r?(i=n/(r+1),a=G(t.slice(0,r+1),i)):(i=(n-=t[r-e[0]].close)/e[0],a=G(t.slice(r-(e[0]-1),r+1),i)),t[r].boll={up:i+2*a,mid:i,dn:i-2*a}}))},H[R.KDJ]=function(t,e){return W(e,3)?z(t,(function(s){var o=t[s].close;e[0]-1>s?(n=V(t.slice(0,s+1)),r=Y(t.slice(0,s+1))):(n=V(t.slice(s-(e[0]-1),s+1)),r=Y(t.slice(s-(e[0]-1),s+1))),t[s].kdj={k:i=(e[1]-1)/e[1]*(e[0]-1>s?50:t[s-1].kdj.k)+1/e[1]*((o-n)/(r-n==0?1:r-n)*100),d:a=(e[2]-1)/e[2]*(e[0]-1>s?50:t[s-1].kdj.d)+1/e[2]*i,j:3*i-2*a}})):t;var i,a,n,r},H[R.RSI]=function(t,e){if(!W(e,3))return t;var i,a,n,s,o,c,h=0,l=0,_=0,u=0,v=0,d=0;return z(t,(function(p){var f,x=(r(f={},"rsi".concat(e[0]),0),r(f,"rsi".concat(e[1]),0),r(f,"rsi".concat(e[2]),0),f);if(p>0){var y=t[p].close-t[p-1].close;if(y>0)h+=y,_+=y,v+=y;else{var m=Math.abs(y);l+=m,u+=m,d+=m}if(e[0]>p)i=h/(p+1),a=(h+l)/(p+1);else{if(p>e[0]){var g=t[p-e[0]].close-t[p-e[0]-1].close;g>0?h-=g:l-=Math.abs(g)}i=h/e[0],a=(h+l)/e[0]}if(x["rsi".concat(e[0])]=0!==a?i/a*100:0,e[1]>p)n=_/(p+1),s=(_+u)/(p+1);else{if(p>e[1]){var k=t[p-e[1]].close-t[p-e[1]-1].close;k>0?_-=k:u-=Math.abs(k)}n=_/e[1],s=(_+u)/e[1]}if(x["rsi".concat(e[1])]=0!==s?n/s*100:0,e[2]>p)o=v/(p+1),c=(v+d)/(p+1);else{if(p>e[2]){var T=t[p-e[2]].close-t[p-e[2]-1].close;T>0?v-=T:d-=Math.abs(T)}o=v/e[2],c=(v+d)/e[2]}x["rsi".concat(e[2])]=0!==c?o/c*100:0}t[p].rsi=x}))},H[R.BIAS]=function(t,e){if(!W(e,3))return t;var i,a,n,r=0,s=0,o=0;return z(t,(function(c){var h={},l=t[c].close;r+=l,s+=l,o+=l,i=e[0]>c?r/(c+1):(r-=t[c-e[0]].close)/e[0],h["bias".concat(e[0])]=(l-i)/i*100,a=e[1]>c?s/(c+1):(s-=t[c-e[1]].close)/e[1],h["bias".concat(e[1])]=(l-a)/a*100,n=e[2]>c?o/(c+1):(o-=t[c-e[2]].close)/e[2],h["bias".concat(e[2])]=(l-n)/n*100,t[c].bias=h}))},H[R.BRAR]=function(t,e){if(!W(e,1))return t;var i=0,a=0,n=0,r=0,s=0,o=0;return z(t,(function(c){var h=t[c].high,l=t[c].low,_=t[c].open;if(s+=h-_,o+=_-l,c>0){var u=t[c-1].close;if(n+=h-u,r+=u-l,c>e[0]-1){var v=t[c-e[0]].high,d=t[c-e[0]].low,p=t[c-e[0]].open;if(c>e[0]){var f=t[c-e[0]-1].close;n-=v-f,r-=f-d}s-=v-p,o-=p-d}a=0!==o?s/o*100:0,i=0!==r?n/r*100:0}t[c].brar={br:i,ar:a}}))},H[R.CCI]=function(t,e){if(!W(e,1))return t;var i,a,n=0,r=[],s=0;return z(t,(function(o){var c=t[o].close;n+=c;var h=(t[o].high+t[o].low+c)/3;if(e[0]>o)s+=Math.abs((i=n/(o+1))-c),r.push(i),a=s/(o+1);else{var l=t[o-e[0]].close;r.push(i=(n-=l)/e[0]),s+=Math.abs(i-c),a=(s-=Math.abs(r[o-e[0]]-l))/e[0]}t[o].cci={cci:0!==a?(h-i)/a/.015:0}}))},H[R.DMI]=function(t,e){if(!W(e,2))return t;var i=0,a=0,n=0,r=0,s=[0],o=0,c=[0],h=0,l=[0],_=0,u=[0],v=0;return z(t,(function(d){if(d>0){var p=t[d-1].close,f=t[d].high,x=t[d].low,y=f-x,m=Math.abs(f-p),g=Math.abs(x-p),k=f-t[d-1].high,T=t[d-1].low-x,M=Math.max(Math.max(y,m),g);o+=M,s.push(M);var D=k>0&&k>T?k:0;h+=D,c.push(D);var S=T>0&&T>k?T:0;_+=S,l.push(S),d>e[0]-1&&(o-=s[d-e[0]],h-=c[d-e[0]],_-=l[d-e[0]]),0===o?(i=0,a=0):(i=100*h/o,a=100*_/o);var w=Math.abs(a-i)/(a+i)*100;if(v+=w,u.push(w),e[1]>d)r=n=v/(d+1);else{var L=u[d-e[1]];r=((n=(v-=L)/e[1])+L)/2}}t[d].dmi={pdi:i,mdi:a,adx:n,adxr:r}}))},H[R.CR]=function(t,e){if(!W(e,5))return t;var i,a,n,r,s=0,o=0,c=0,h=0,l=[],_=0,u=[],v=0,d=[],p=0,f=[];return z(t,(function(x){if(x>0){var y=(t[x-1].high+t[x-1].close+t[x-1].low+t[x-1].open)/4,m=t[x].high-y;0>m&&(m=0),o+=m;var g=y-t[x].low;if(0>g&&(g=0),c+=g,x>e[0]){var k=(t[x-e[0]-1].high+t[x-e[0]-1].low+t[x-e[0]-1].close+t[x-e[0]-1].open)/4,T=t[x-e[0]].high-k;0>T&&(T=0);var M=k-t[x-e[0]].low;0>M&&(M=0),o-=T,c-=M}0!==c&&(s=o/c*100);var D=(t[x-1].high+t[x-1].low+t[x-1].close)/3,S=t[x].high-D;o+=S>0?S:0;var w=D-t[x].low;c+=w>0?w:0}h+=s,_+=s,v+=s,p+=s,i=e[1]>x?h/(x+1):(h-=t[x-e[1]].cr.cr)/e[1],l.push(i),a=e[2]>x?_/(x+1):(_-=t[x-e[2]].cr.cr)/e[2],u.push(a),n=e[3]>x?v/(x+1):(v-=t[x-e[3]].cr.cr)/e[3],d.push(n),r=e[4]>x?p/(x+1):(p-=t[x-e[4]].cr.cr)/e[4],f.push(r),t[x].cr={cr:s,ma1:5>x?l[0]:l[x-5],ma2:9>x?u[0]:u[x-9],ma3:17>x?d[0]:d[x-17],ma4:25>x?f[0]:f[x-25]}}))},H[R.PSY]=function(t,e){if(!W(e,1))return t;var i=0,a=0;return z(t,(function(n){n>0&&(a+=t[n].close-t[n-1].close>0?1:0,e[0]>n?i=a/(n+1)*100:(n>e[0]&&(a-=t[n-e[0]+1].close-t[n-e[0]].close>0?1:0),i=a/e[0]*100)),t[n].psy={psy:i}}))},H[R.DMA]=function(t,e){if(!W(e,3))return t;var i,a,n,r,s=0,o=0,c=0;return z(t,(function(h){var l=t[h].close;s+=l,o+=l,n=e[0]>h?s/(h+1):(s-=t[h-e[0]].close)/e[0],r=e[1]>h?o/(h+1):(o-=t[h-e[1]].close)/e[1],c+=i=n-r,a=e[2]>h?c/(h+1):(c-=t[h-e[2]].dma.dif)/e[2],t[h].dma={dif:i,difMa:a}}))},H[R.TRIX]=function(t,e){if(!W(e,2))return t;var i,a,n,r,s=0,o=0,c=0,h=0,l=0,_=[];return z(t,(function(u){var v=t[u].close;if(0===u)r=n=a=v;else{r=(2*(n=(2*(a=(2*v+(e[0]-1)*c)/(e[0]+1))+(e[0]-1)*h)/(e[0]+1))+(e[0]-1)*l)/(e[0]+1);var d=_[u-1];s=0===d?0:(r-d)/d*100}c=a,h=n,l=r,_.push(r),o+=s,i=e[1]>u?o/(u+1):(o-=t[u-e[1]].trix.trix)/e[1],t[u].trix={trix:s,maTrix:i}}))},H[R.OBV]=function(t,e){if(!W(e,1))return t;var i,a,n=0,r=0;return z(t,(function(s){var o=t[s].volume;if(0===s)i=o,r+=o;else{var c=t[s-1].close,h=t[s].close;r+=h>c?o:-o,i=h===c?0:r}n+=i,a=e[0]>s?n/(s+1):(n-=t[s-e[0]].obv.obv)/e[0],t[s].obv={obv:i,maObv:a}}))},H[R.VR]=function(t,e){if(!W(e,2))return t;var i,a=0,n=0,r=0,s=0,o=0;return z(t,(function(c){var h=t[c].close,l=t[c].open,_=t[c].volume;if(h>l?a+=_:l>h?n+=_:r+=_,c>e[0]-1){var u=t[c-e[0]].close,v=t[c-e[0]].open,d=t[c-e[0]].volume;u>v?a-=d:v>u?n-=d:r-=d}var p=n+.5*r;0!==p&&(s=(a+.5*r)/p*100),o+=s,i=e[1]>c?o/(c+1):(o-=t[c-e[1]].vr.vr)/e[1],t[c].vr={vr:s,maVr:i}}))},H[R.WR]=function(t,e){if(!W(e,3))return t;var i,a,n,r,s,o=Number.MIN_SAFE_INTEGER,c=Number.MAX_SAFE_INTEGER,h=Number.MIN_SAFE_INTEGER,l=Number.MAX_SAFE_INTEGER,_=Number.MIN_SAFE_INTEGER,u=Number.MAX_SAFE_INTEGER;return z(t,(function(v){var d=t[v].close,p=t[v].high,f=t[v].low;if(e[0]>v)o=Math.max(p,o),c=Math.min(f,c);else{var x=F(t.slice(v-e[0],v));o=x[0],c=x[1]}if(i=0!==(n=o-c)?(o-d)/n*100:0,e[1]>v)h=Math.max(p,h),l=Math.min(f,l);else{var y=F(t.slice(v-e[1],v));h=y[0],l=y[1]}if(a=0!==(r=h-l)?(h-d)/r*100:0,e[2]>v)_=Math.max(p,_),u=Math.min(f,u);else{var m=F(t.slice(v-e[2],v));_=m[0],u=m[1]}t[v].wr={wr1:i,wr2:a,wr3:0!==(s=_-u)?(_-d)/s*100:0}}))},H[R.MTM]=function(t,e){if(!W(e,2))return t;var i,a,n=0;return z(t,(function(r){e[0]>r?(i=0,a=0):(n+=i=t[r].close-t[r-e[0]].close,e[0]+e[1]>r?a=n/(r-e[0]+1):(a=n/e[1],n-=t[r-e[1]].mtm.mtm));t[r].mtm={mtm:i,mtmMa:a}}))},H[R.EMV]=function(t,e){if(!W(e,2))return t;var i,a=0,n=0,r=0,s=[];return z(t,(function(o){if(o>0){var c=t[o].high,h=t[o].low;r=((c+h)/2-(t[o-1].high+t[o-1].low)/2)*(c-h)/t[o].turnover}s.push(r),e[0]>o?a+=r:a-=s[o-e[0]],n+=a,i=e[1]>o?n/(o+1):(n-=t[o-e[1]].emv.emv)/e[1],t[o].emv={emv:a,maEmv:i}}))},H[R.SAR]=function(t,e){if(!W(e,3))return t;var i=e[0]/100,a=e[1]/100,n=e[2]/100,r=i,s=-100,o=!1,c=0;return z(t,(function(e){var h=c,l=t[e].high,_=t[e].low;if(o){(-100===s||l>s)&&(s=l,r=Math.min(r+a,n)),c=h+r*(s-h);var u=Math.min(t[Math.max(1,e)-1].low,_);c>t[e].low?(c=s,r=i,s=-100,o=!o):c>u&&(c=u)}else{(-100===s||s>_)&&(s=_,r=Math.min(r+a,n)),c=h+r*(s-h);var v=Math.max(t[Math.max(1,e)-1].high,l);t[e].high>c?(c=s,r=0,s=-100,o=!o):v>c&&(c=v)}t[e].sar={sar:c}}))};var X=1,j=2,Z=3,K={NONE:"none",HORIZONTAL_STRAIGHT_LINE:"horizontalStraightLine",VERTICAL_STRAIGHT_LINE:"verticalStraightLine",STRAIGHT_LINE:"straightLine",HORIZONTAL_RAY_LINE:"horizontalRayLine",VERTICAL_RAY_LINE:"verticalRayLine",RAY_LINE:"rayLine",HORIZONTAL_SEGMENT_LINE:"horizontalSegmentLine",VERTICAL_SEGMENT_LINE:"verticalSegmentLine",SEGMENT_LINE:"segmentLine",PRICE_LINE:"priceLine",PRICE_CHANNEL_LINE:"priceChannelLine",PARALLEL_STRAIGHT_LINE:"parallelStraightLine",FIBONACCI_LINE:"fibonacciLine"},U=function(){function t(e,a){i(this,t),this._invalidateHandler=a,this._styleOptions=u(C),_(this._styleOptions,e),this._technicalIndicatorParamOptions=u(O),this._precisionOptions=u(N),this._dataList=[],this._totalDataSpace=0,this._offsetRightSpace=50,this._from=0,this._to=0,this._range=0,this._dataSpace=6,this._barSpace=this._calcBarSpace(),this._crossHairPoint=null,this._crossHairSeriesTag=null,this._preFrom=0,this._graphicMarkType=K.NONE,this._graphicMarkPoint=null,this._dragGraphicMarkFlag=!1,this._graphicMarkDatas={horizontalStraightLine:[],verticalStraightLine:[],straightLine:[],horizontalRayLine:[],verticalRayLine:[],rayLine:[],horizontalSegmentLine:[],verticalSegmentLine:[],segmentLine:[],priceLine:[],parallelStraightLine:[],priceChannelLine:[],fibonacciLine:[]}}return n(t,[{key:"_calcRange",value:function(){this._range=Math.floor(this._totalDataSpace/this._dataSpace);var t=this._from+this._range;t>this._dataList.length&&(t=this._dataList.length),this._to=t}},{key:"_calcBarSpace",value:function(){return.75*this._dataSpace}},{key:"_calcRangDif",value:function(){return this._range-Math.floor(this._offsetRightSpace/this._dataSpace)}},{key:"_innerSetDataSpace",value:function(t){return!(!t||3>t||t>30)&&(this._dataSpace!==t?(this._dataSpace=t,this._barSpace=this._calcBarSpace(),this._calcRange(),!0):void 0)}},{key:"_xToPos",value:function(t){var e=t/this._dataSpace,i=Math.floor(e);return e=this._barSpace/2>(e-i)*this._dataSpace?i:Math.ceil(e)}},{key:"styleOptions",value:function(){return this._styleOptions}},{key:"applyStyleOptions",value:function(t){_(this._styleOptions,t)}},{key:"technicalIndicatorParamOptions",value:function(){return this._technicalIndicatorParamOptions}},{key:"applyTechnicalIndicatorParams",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this._technicalIndicatorParamOptions.hasOwnProperty(t)&&(this._technicalIndicatorParamOptions[t]=e)}},{key:"precisionOptions",value:function(){return this._precisionOptions}},{key:"applyPrecision",value:function(t,e){!t&&0!==t||0>t||(this._precisionOptions.price=t,this._precisionOptions[R.MA]=t,this._precisionOptions[R.BOLL]=t,this._precisionOptions[R.SAR]=t),!e&&0!==e||0>e||(this._precisionOptions.volume=e,this._precisionOptions[R.VOL]=e)}},{key:"calcTechnicalIndicator",value:function(t){if(t===R.NO)return!0;var e=H[t];return!!e&&(this._dataList=e(this._dataList,this._technicalIndicatorParamOptions[t]),!0)}},{key:"dataList",value:function(){return this._dataList}},{key:"clearDataList",value:function(){this._dataList=[],this._from=0,this._to=0}},{key:"addData",value:function(t,e){if(p(t))if(v(t))if(0===this._dataList.length){this._dataList=t.concat(this._dataList);var i=this._calcRangDif();this._from=this._dataList.length-i,this.adjustFromTo()}else this._dataList=t.concat(this._dataList),this._from+=t.length;else if(e<this._dataList.length)this._dataList[e]=t;else{var a=this._dataList.length;if(this._dataList.push(t),0!==this._from){if(this._to===a){this._to+=1;var n=this._calcRangDif();this._to-this._from>n&&(this._from+=1)}}else this._calcRangDif()>this._dataList.length?this._to=this._dataList.length:(this._from+=1,this._to+=1)}}},{key:"dataSpace",value:function(){return this._dataSpace}},{key:"barSpace",value:function(){return this._barSpace}},{key:"setDataSpace",value:function(t){this._innerSetDataSpace(t)&&this._invalidateHandler()}},{key:"setTotalDataSpace",value:function(t){this._totalDataSpace!==t&&(this._totalDataSpace=t,this._calcRange())}},{key:"setOffsetRightSpace",value:function(t){0>t&&(t=0),this._offsetRightSpace=t}},{key:"from",value:function(){return this._from}},{key:"to",value:function(){return this._to}},{key:"range",value:function(){return this._range}},{key:"crossHairPoint",value:function(){return this._crossHairPoint}},{key:"crossHairSeriesTag",value:function(){return this._crossHairSeriesTag}},{key:"setCrossHairSeriesTag",value:function(t){this._crossHairSeriesTag=t,this._invalidateHandler(X)}},{key:"setCrossHairPoint",value:function(t){this._crossHairPoint=t}},{key:"getCrossHairDataPos",value:function(){var t;if(this._crossHairPoint){var e=this._xToPos(this._crossHairPoint.x);(t=this._from+e-1)>this._to-1&&(t=this._to-1)}else t=this._to-1;return t}},{key:"startDrag",value:function(){this._preFrom=this._from}},{key:"drag",value:function(t){if(Math.abs(t)>=this._dataSpace/2){var e=t/this._dataSpace;if(0!==(e=0>e?Math.floor(e):Math.ceil(e))){if(e>0){if(0===this._from)return void this._invalidateHandler(X)}else{var i=this._calcRangDif();if(this._from===this._dataList.length-i)return void this._invalidateHandler(X)}this._from=this._preFrom-e,this.adjustFromTo(),this._invalidateHandler()}}}},{key:"zoom",value:function(t){this._innerSetDataSpace(this._dataSpace+t*(this._dataSpace/10))&&(this.adjustFromTo(),this._invalidateHandler())}},{key:"adjustFromTo",value:function(){var t=this._dataList.length,e=this._calcRangDif();this._from>t-e&&(this._from=t-e),0>this._from&&(this._from=0),this._to=this._from+this._range,this._to>t&&(this._to=t)}},{key:"graphicMarkType",value:function(){return this._graphicMarkType}},{key:"setGraphicMarkType",value:function(t){this._graphicMarkType=t}},{key:"dragGraphicMarkFlag",value:function(){return this._dragGraphicMarkFlag}},{key:"setDragGraphicMarkFlag",value:function(t){this._dragGraphicMarkFlag=t}},{key:"graphicMarkPoint",value:function(){return this._graphicMarkPoint}},{key:"setGraphicMarkPoint",value:function(t){this._graphicMarkPoint=t}},{key:"graphicMarkData",value:function(){return this._graphicMarkDatas}},{key:"setGraphicMarkData",value:function(t){this._graphicMarkDatas=t,this._invalidateHandler(j)}}]),t}(),q=function(){function t(e){i(this,t),this._container=e.container,this._chartData=e.chartData,this._width=-1,this._height=-1,this._initBefore(e),this._initElement(),this._mainWidget=this._createMainWidget(this._mainWidgetCell,e),this._yAxisWidget=this._createYAxisWidget(this._yAxisWidgetCell,e)}return n(t,[{key:"_initBefore",value:function(t){}},{key:"_initElement",value:function(){this._element=document.createElement("div"),this._element.style.margin="0",this._element.style.padding="0",this._element.style.width="100%",this._element.style.position="relative",this._element.style.overflow="hidden",this._width=this._element.offsetWidth,this._mainWidgetCell=this._createCell(),this._yAxisWidgetCell=this._createCell(),this._element.appendChild(this._mainWidgetCell),this._element.appendChild(this._yAxisWidgetCell);var t=this._container.lastChild;t?this._container.insertBefore(this._element,t):this._container.appendChild(this._element)}},{key:"_createCell",value:function(){var t=document.createElement("div");return t.style.position="absolute",t.style.margin="0",t.style.padding="0",t.style.top="0",t.style.zIndex="1",t}},{key:"_createMainWidget",value:function(t,e){}},{key:"_createYAxisWidget",value:function(t,e){}},{key:"_setCellSize",value:function(t,e){t.style.left="".concat(e.left,"px"),t.style.width="".concat(e.width,"px"),t.style.height="".concat(e.height,"px")}},{key:"_computeAxis",value:function(){}},{key:"width",value:function(){return this._width}},{key:"height",value:function(){return this._height}},{key:"setTempHeight",value:function(t){this._height=t}},{key:"setSize",value:function(t,e){this._element.style.height="".concat(t.height,"px"),this._setCellSize(this._mainWidgetCell,t),this._setCellSize(this._yAxisWidgetCell,e),this._height=t.height,this._mainWidget.setSize(t.width,t.height),this._yAxisWidget&&this._yAxisWidget.setSize(e.width,e.height)}},{key:"invalidate",value:function(t){t===Z&&this._computeAxis(),t!==j&&this._yAxisWidget&&this._yAxisWidget.invalidate(t),this._mainWidget.invalidate(t)}},{key:"destroy",value:function(){this._container.removeChild(this._element)}}]),t}(),J=function(){function t(e){i(this,t),this._initElement(e.container),this._mainView=this._createMainView(this._element,e),this._expandView=this._createExpandView(this._element,e),this._floatLayerView=this._createFloatLayerView(this._element,e)}return n(t,[{key:"_initElement",value:function(t){this._element=document.createElement("div"),this._element.style.margin="0",this._element.style.padding="0",this._element.style.position="relative",this._element.style.overflow="hidden",t.appendChild(this._element)}},{key:"_createMainView",value:function(t,e){}},{key:"_createExpandView",value:function(t,e){}},{key:"_createFloatLayerView",value:function(t,e){}},{key:"setSize",value:function(t,e){this._element.style.width="".concat(t,"px"),this._element.style.height="".concat(e,"px"),this._mainView.setSize(t,e),this._floatLayerView.setSize(t,e)}},{key:"invalidate",value:function(t){switch(t){case X:this._floatLayerView.flush();break;case Z:this._mainView.flush(),this._floatLayerView.flush()}}}]),t}();function Q(t){return(window.devicePixelRatio||1)/(t.backingStorePixelRatio||t.webkitBackingStorePixelRatio||t.mozBackingStorePixelRatio||t.msBackingStorePixelRatio||t.oBackingStorePixelRatio||t.backingStorePixelRatio||1)}function $(t,e){return t.measureText(e).width}function tt(t){return"".concat(t,"px Arial")}var et=function(){function t(e,a){i(this,t),this._chartData=a,this._initCanvas(e)}return n(t,[{key:"_initCanvas",value:function(t){this._canvas=document.createElement("canvas"),this._canvas.style.position="absolute",this._canvas.style.right="0",this._canvas.style.left="0",this._canvas.style.zIndex="2",this._ctx=this._canvas.getContext("2d"),t.appendChild(this._canvas)}},{key:"_redraw",value:function(t){this._ctx.clearRect(0,0,this._width,this._height),t&&t(),this._draw()}},{key:"_draw",value:function(){}},{key:"setSize",value:function(t,e){var i=this;t===this._width&&e===this._height||this._redraw((function(){var a=Q(i._ctx);i._width=t,i._height=e,i._canvas.style.top="0",i._canvas.style.width="".concat(t,"px"),i._canvas.style.height="".concat(e,"px"),i._canvas.width=t*a,i._canvas.height=e*a,i._ctx.scale(a,a)}))}},{key:"flush",value:function(){var t,e,i=this;this.requestAnimationId&&(t=this.requestAnimationId,window.cancelAnimationFrame||clearTimeout(t),window.cancelAnimationFrame(t)),this.requestAnimationId=(e=function(){i._redraw()},window.requestAnimationFrame?window.requestAnimationFrame(e):window.setTimeout((function(){e()}),1e3/60))}}]),t}(),it=function(t){function e(t,a,n,r,s){var c;return i(this,e),(c=h(this,o(e).call(this,t,a)))._xAxis=n,c._yAxis=r,c._additionalDataProvider=s,c}return s(e,t),n(e,[{key:"_draw",value:function(){this._drawGrid(),this._drawTechnicalIndicator()}},{key:"_drawGrid",value:function(){var t=this,e=this._chartData.styleOptions().grid;if(e.display){var i=e.horizontal;i.display&&(this._ctx.strokeStyle=i.color,this._ctx.lineWidth=i.size,i.style===m&&this._ctx.setLineDash(i.dashValue),this._xAxis.ticks().forEach((function(e){var i=e.x;t._ctx.beginPath(),t._ctx.moveTo(i,0),t._ctx.lineTo(i,t._height),t._ctx.stroke(),t._ctx.closePath()})));var a=e.vertical;a.display&&(this._ctx.strokeStyle=a.color,this._ctx.lineWidth=a.size,a.style===m&&this._ctx.setLineDash(a.dashValue),this._yAxis.ticks().forEach((function(e){var i=e.y;t._ctx.beginPath(),t._ctx.moveTo(0,i),t._ctx.lineTo(t._width,i),t._ctx.stroke(),t._ctx.closePath()}))),this._ctx.setLineDash([])}}},{key:"_drawTechnicalIndicator",value:function(){var t,e=this,i=this._additionalDataProvider.technicalIndicatorType(),a=this._chartData.technicalIndicatorParamOptions()[i]||[],n=[],r=this._chartData.styleOptions().technicalIndicator;switch(i){case R.MA:var s=[];a.forEach((function(t){s.push("ma".concat(t))})),t=function(t,a,o,c){e._ohlcTechnicalIndicatorDrawing(a,t,c,r,o,i,s,e._yAxis.isCandleStickYAxis(),(function(i){e._prepareLinePoints(t,i,n)}))};break;case R.MACD:var o=this._chartData.dataList();t=function(t,i,a,s){var c=a.macd||{};e._prepareLinePoints(t,[c.diff,c.dea],n);var h=c.macd,l=((o[i-1]||{}).macd||{}).macd||-1/0;h>0?(e._ctx.strokeStyle=r.bar.upColor,e._ctx.fillStyle=r.bar.upColor):(e._ctx.strokeStyle=r.bar.downColor,e._ctx.fillStyle=r.bar.downColor),e._drawBars(t,s,h,!((l||0===l)&&h>l))};break;case R.VOL:var c=this._chartData.dataList();t=function(t,i,s,o){var h=s.vol||{},l=[];a.forEach((function(t){l.push(h["ma".concat(t)])})),e._prepareLinePoints(t,l,n),e._ctx.fillStyle=s.close>((c[i-1]||{}||{}).close||-1/0)?r.bar.upColor:r.bar.downColor,e._drawBars(t,o,h.num,!0)};break;case R.BOLL:t=function(t,a,s,o){e._ohlcTechnicalIndicatorDrawing(a,t,o,r,s,i,["up","mid","dn"],e._yAxis.isCandleStickYAxis(),(function(i){e._prepareLinePoints(t,i,n)}))};break;case R.BIAS:t=function(t,i,r){var s=r.bias||{},o=[];a.forEach((function(t){o.push(s["bias".concat(t)])})),e._prepareLinePoints(t,o,n)};break;case R.BRAR:t=function(t,i,a){var r=a.brar||{};e._prepareLinePoints(t,[r.br,r.ar],n)};break;case R.CCI:t=function(t,i,a){e._prepareLinePoints(t,[(a.cci||{}).cci],n)};break;case R.CR:t=function(t,i,a){var r=a.cr||{};e._prepareLinePoints(t,[r.cr,r.ma1,r.ma2,r.ma3,r.ma4],n)};break;case R.DMA:t=function(t,i,a){var r=a.dma||{};e._prepareLinePoints(t,[r.dif,r.difMa],n)};break;case R.DMI:t=function(t,i,a){var r=a.dmi||{};e._prepareLinePoints(t,[r.mdi,r.pdi,r.adx,r.adxr],n)};break;case R.KDJ:t=function(t,i,a){var r=a.kdj||{};e._prepareLinePoints(t,[r.k,r.d,r.j],n)};break;case R.RSI:t=function(t,i,r){var s=r.rsi||{},o=[];a.forEach((function(t){o.push(s["rsi".concat(t)])})),e._prepareLinePoints(t,o,n)};break;case R.PSY:t=function(t,i,a){e._prepareLinePoints(t,[(a.psy||{}).psy],n)};break;case R.TRIX:t=function(t,i,a){var r=a.trix||{};e._prepareLinePoints(t,[r.trix,r.maTrix],n)};break;case R.OBV:t=function(t,i,a){var r=a.obv||{};e._prepareLinePoints(t,[r.obv,r.maObv],n)};break;case R.VR:t=function(t,i,a){var r=a.vr||{};e._prepareLinePoints(t,[r.vr,r.maVr],n)};break;case R.WR:t=function(t,i,a){var r=a.wr||{};e._prepareLinePoints(t,[r.wr1,r.wr2,r.wr3],n)};break;case R.MTM:t=function(t,i,a){var r=a.mtm||{};e._prepareLinePoints(t,[r.mtm,r.mtmMa],n)};break;case R.EMV:t=function(t,i,a){var r=a.emv||{};e._prepareLinePoints(t,[r.emv,r.maEmv],n)};break;case R.SAR:t=function(t,a,n,s){e._ohlcTechnicalIndicatorDrawing(a,t,s,r,n,i,["sar"],e._yAxis.isCandleStickYAxis(),(function(i){var a=i[0];if(a||0===a){var o=e._yAxis.convertToPixel(a);e._ctx.strokeStyle=(n.high+n.low)/2>a?r.bar.upColor:r.bar.downColor,e._ctx.beginPath(),e._ctx.arc(t,o,s,2*Math.PI,0,!0),e._ctx.stroke(),e._ctx.closePath()}}))}}this._drawGraphics(t,(function(){e._drawLines(n,r)}))}},{key:"_ohlcTechnicalIndicatorDrawing",value:function(t,e,i,a,n,r,s,o,c){var h=n[r.toLowerCase()]||{},l=[];s.forEach((function(t){l.push(h[t])})),c&&c(l);var _=this._chartData.dataList();o||this._drawOhlc(i,e,n,_[t-1]||{},a.bar.upColor,a.bar.downColor)}},{key:"_prepareLinePoints",value:function(t,e,i){for(var a=0;e.length>a;a++){var n=this._yAxis.convertToPixel(e[a]);i[a]?i[a].push({x:t,y:n}):i[a]=[{x:t,y:n}]}}},{key:"_drawLines",value:function(t,e){var i=e.line.colors,a=t.length,n=(i||[]).length;this._ctx.lineWidth=e.line.size;for(var r=0;a>r;r++){var s=t[r];if(s.length>0){this._ctx.strokeStyle=i[r%n],this._ctx.beginPath(),this._ctx.moveTo(s[0].x,s[0].y);for(var o=1;s.length>o;o++)this._ctx.lineTo(s[o].x,s[o].y);this._ctx.stroke(),this._ctx.closePath()}}}},{key:"_drawBars",value:function(t,e,i,a){if(i||0===i){this._ctx.lineWidth=1;var n=this._yAxis.convertToPixel(i),r=this._yAxis.convertToPixel(0),s=n;0>i&&(s=r);var o=Math.abs(r-n);1>o&&(o=1),a?this._ctx.fillRect(t-e,s,2*e,o):this._ctx.strokeRect(t-e,s,2*e,o)}}},{key:"_drawOhlc",value:function(t,e,i,a,n,r){var s=this._yAxis.convertToPixel(i.open),o=this._yAxis.convertToPixel(i.close),c=this._yAxis.convertToPixel(i.high),h=this._yAxis.convertToPixel(i.low);this._ctx.strokeStyle=i.close>a.close?n:r,this._ctx.lineWidth=1,this._ctx.beginPath(),this._ctx.moveTo(e,c),this._ctx.lineTo(e,h),this._ctx.stroke(),this._ctx.closePath(),this._ctx.beginPath(),this._ctx.moveTo(e-t,s),this._ctx.lineTo(e,s),this._ctx.stroke(),this._ctx.closePath(),this._ctx.beginPath(),this._ctx.moveTo(e+t,o),this._ctx.lineTo(e,o),this._ctx.stroke(),this._ctx.closePath()}},{key:"_drawGraphics",value:function(t,e){for(var i=0,a=this._chartData.dataList(),n=this._chartData.barSpace(),r=this._chartData.dataSpace(),s=n/2,o=this._chartData.to(),c=this._chartData.from();o>c;c++){t&&t((i+(i+n))/2,c,a[c],s,n),i+=r}e&&e()}}]),e}(et);function at(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"--";if(t&&p(t)){var a=t[e];if(a||0===a||!1===a)return a}return i}function nt(t,e){if(t&&f(t)){var i=new Date(t),a=""+i.getFullYear(),n=""+(i.getMonth()+1),r=""+i.getDate(),s=""+i.getHours(),o=""+i.getMinutes(),c=1===n.length?"0".concat(n):n,h=1===r.length?"0".concat(r):r,l=1===s.length?"0"+s:s,_=1===o.length?"0"+o:o;switch(e){case"YYYY":return a;case"YYYY-MM":return"".concat(a,"-").concat(c);case"YYYY-MM-DD":return"".concat(a,"-").concat(c,"-").concat(h);case"YYYY-MM-DD hh:mm":return"".concat(a,"-").concat(c,"-").concat(h," ").concat(l,":").concat(_);case"MM-DD":return"".concat(c,"-").concat(h);case"hh:mm":return"".concat(l,":").concat(_);default:return"".concat(c,"-").concat(h," ").concat(l,":").concat(_)}}return"--"}function rt(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,i=+t;return(i||0===i)&&f(i)?t.toFixed(e):"".concat(i)}var st=function(t){function e(t,a,n,r,s){var c;return i(this,e),(c=h(this,o(e).call(this,t,a)))._xAxis=n,c._yAxis=r,c._additionalDataProvider=s,c}return s(e,t),n(e,[{key:"_draw",value:function(){var t=this._chartData.getCrossHairDataPos(),e=this._chartData.dataList()[t],i=this._xAxis.convertToPixel(t);this._drawCrossHairHorizontalLine(),this._drawCrossHairVerticalLine(e,i);var a=this._chartData.styleOptions().floatLayer.prompt.displayRule;(a===P||a===b&&this._chartData.crossHairSeriesTag())&&this._drawPrompt(e,i)}},{key:"_drawPrompt",value:function(t,e){this._drawTechnicalIndicatorPrompt(t,e)}},{key:"_drawCrossHairHorizontalLine",value:function(){if(this._chartData.crossHairSeriesTag()===this._additionalDataProvider.tag()){var t=this._chartData.styleOptions().floatLayer.crossHair,e=t.horizontal,i=e.line;if(t.display&&e.display&&i.display){var a=this._chartData.crossHairPoint();a&&(this._ctx.lineWidth=i.size,this._ctx.strokeStyle=i.color,i.style===m&&this._ctx.setLineDash(i.dashValue),this._ctx.beginPath(),this._ctx.moveTo(0,a.y),this._ctx.lineTo(this._width,a.y),this._ctx.stroke(),this._ctx.closePath(),this._ctx.setLineDash([]))}}}},{key:"_drawCrossHairVerticalLine",value:function(t,e){if(this._chartData.crossHairSeriesTag()){var i=this._chartData.styleOptions().floatLayer.crossHair,a=i.vertical,n=a.line;i.display&&a.display&&n.display&&t&&(this._ctx.lineWidth=n.size,this._ctx.strokeStyle=n.color,n.style===m&&this._ctx.setLineDash(n.dashValue),this._ctx.beginPath(),this._ctx.moveTo(e,0),this._ctx.lineTo(e,this._height),this._ctx.stroke(),this._ctx.closePath(),this._ctx.setLineDash([]))}}},{key:"_drawTechnicalIndicatorPrompt",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=this._chartData.styleOptions().technicalIndicator,n=this._getTechnicalIndicatorPromptData(t),r=a.line.colors;this._drawTechnicalIndicatorPromptText(n,r,i),this._drawTechnicalIndicatorPromptPoint(n.values,r,e)}},{key:"_drawTechnicalIndicatorPromptText",value:function(t,e,i){var a=this._chartData.styleOptions().floatLayer.prompt.technicalIndicator.text,n=t.name,r=t.labels,s=t.values,o=a.marginLeft,c=a.marginRight,h=o,l=a.marginTop+i,_=a.size,u=a.color,v=e.length;this._ctx.textBaseline="top",this._ctx.font=tt(_);var d=$(this._ctx,n);this._ctx.fillStyle=u,this._ctx.fillText(n,h,l),h+=o+d;for(var p=0;r.length>p;p++){var f="".concat(r[p].toUpperCase(),": ").concat(s[p]||"--"),x=$(this._ctx,f);this._ctx.fillStyle=e[p%v]||u,this._ctx.fillText(f,h,l),h+=o+c+x}}},{key:"_drawTechnicalIndicatorPromptPoint",value:function(t,e,i){var a=this._additionalDataProvider.technicalIndicatorType();if(this._chartData.crossHairSeriesTag()&&a!==R.SAR)for(var n=e.length,r=a===R.MACD||a===R.VOL?t.length-1:t.length,s=0;r>s;s++){var o=t[s];if(o||0===o){var c=this._yAxis.convertToPixel(o);this._ctx.fillStyle=e[s%n],this._ctx.beginPath(),this._ctx.arc(i,c,3,0,2*Math.PI),this._ctx.closePath(),this._ctx.fill()}}}},{key:"_getTechnicalIndicatorPromptData",value:function(t){var e=this._additionalDataProvider.technicalIndicatorType(),i=this._chartData.technicalIndicatorParamOptions()[e]||[],a=[],n=[];switch(e){case R.MA:i.forEach((function(t){n.push("ma".concat(t))}));break;case R.VOL:i.forEach((function(t){n.push("ma".concat(t))})),n.push("num");break;case R.MACD:n=["diff","dea","macd"];break;case R.BOLL:n=["up","mid","dn"];break;case R.BIAS:i.forEach((function(t){n.push("bias".concat(t))}));break;case R.BRAR:n=["br","ar"];break;case R.CCI:n=["cci"];break;case R.CR:n=["cr","ma1","ma2","ma3","ma4"];break;case R.DMA:n=["dif","difMa"];break;case R.DMI:n=["mdi","pdi","adx","adxr"];break;case R.KDJ:n=["k","d","j"];break;case R.RSI:i.forEach((function(t){n.push("rsi".concat(t))}));break;case R.PSY:n=["psy"];break;case R.TRIX:n=["trix","maTrix"];break;case R.OBV:n=["obv","maObv"];break;case R.VR:n=["vr","maVr"];break;case R.WR:n=["wr1","wr2","wr3"];break;case R.MTM:n=["mtm","mtmMa"];break;case R.EMV:n=["emv","maEmv"];break;case R.SAR:n=["sar"]}var r="";if(n.length>0){r="".concat(e),i&&v(i)&&i.length>0&&(r="".concat(r,"(").concat(i.join(","),")"));var s=at(t,e.toLowerCase());n.forEach((function(t){a.push(at(s,t))}));var o=this._chartData.precisionOptions()[e];a.forEach((function(t,e){a[e]=rt(t,o)}))}return{labels:n,values:a,name:r}}}]),e}(et),ot=function(t){function e(){return i(this,e),h(this,o(e).apply(this,arguments))}return s(e,t),n(e,[{key:"_createMainView",value:function(t,e){return new it(t,e.chartData,e.xAxis,e.yAxis,e.additionalDataProvider)}},{key:"_createFloatLayerView",value:function(t,e){return new st(t,e.chartData,e.xAxis,e.yAxis,e.additionalDataProvider)}}]),e}(J),ct=function(t){function e(t,a,n){var r;return i(this,e),(r=h(this,o(e).call(this,t,a)))._axis=n,r}return s(e,t),n(e,[{key:"_draw",value:function(){this._drawAxisLine(),this._drawTickLines(),this._drawTickLabels()}},{key:"_drawAxisLine",value:function(){}},{key:"_drawTickLines",value:function(){}},{key:"_drawTickLabels",value:function(){}}]),e}(et),ht=function(t){function e(){return i(this,e),h(this,o(e).apply(this,arguments))}return s(e,t),n(e,[{key:"_draw",value:function(){l(o(e.prototype),"_draw",this).call(this),this._drawLastPriceLabel()}},{key:"_drawAxisLine",value:function(){var t=this._chartData.styleOptions().yAxis;if(t.display&&t.axisLine.display){var e=t.axisLine.size;if(this._ctx.strokeStyle=t.axisLine.color,this._ctx.lineWidth=e,this._ctx.beginPath(),t.position===g&&t.tickText.position===T||t.position===k&&t.tickText.position===M){var i=e/2;this._ctx.moveTo(i,0),this._ctx.lineTo(i,this._height)}else{var a=this._width-e/2;this._ctx.moveTo(a,0),this._ctx.lineTo(a,this._height)}this._ctx.stroke(),this._ctx.closePath()}}},{key:"_drawTickLines",value:function(){var t=this,e=this._chartData.styleOptions().yAxis,i=e.tickText;if(e.display&&i.display){var a=e.tickLine;this._ctx.lineWidth=a.size,this._ctx.strokeStyle=a.color;var n,r,s=a.length,o=i.position;e.position===g&&o===T||e.position===k&&o===M?(n=0,e.axisLine.display&&(n+=e.axisLine.size),r=n+s):(n=this._width,e.axisLine.display&&(n-=e.axisLine.size),r=n-s),this._axis.ticks().forEach((function(e){var i=e.y;t._ctx.beginPath(),t._ctx.moveTo(n,i),t._ctx.lineTo(r,i),t._ctx.stroke(),t._ctx.closePath()}))}}},{key:"_drawTickLabels",value:function(){var t=this,e=this._chartData.styleOptions().yAxis,i=e.tickText;if(e.display&&i.display){var a,n=e.tickLine,r=i.position,s=n.display,o=n.length,c=i.margin;e.position===g&&r===T||e.position===k&&r===M?(a=c,e.axisLine.display&&(a+=e.axisLine.size),s&&(a+=o),this._ctx.textAlign="left"):(a=this.width-c,e.axisLine.display&&(a-=e.axisLine.size),s&&(a-=o),this._ctx.textAlign="right");var h=i.size;this._ctx.textBaseline="middle",this._ctx.font=tt(h),this._ctx.fillStyle=i.color,this._axis.ticks().forEach((function(e){var i,n=f(i=e.v)?i>5e4?"".concat(+(i/1e3).toFixed(1),"K"):i>5e6?"".concat(+(i/1e6).toFixed(3),"M"):"".concat(i):"--";t._ctx.fillText(n,a,e.y)})),this._ctx.textAlign="left"}}},{key:"_drawLastPriceLabel",value:function(){if(this._axis.isCandleStickYAxis()){var t=this._chartData.styleOptions().candleStick.priceMark,e=t.last,i=this._chartData.dataList(),a=i.length;if(t.display&&e.display&&e.text.display&&0!==a){var n=(i[a-2]||{}).close||-1/0,r=i[a-1].close,s=this._axis.convertToPixel(r);s=+Math.max(.05*this._height,Math.min(s,.98*this._height)).toFixed(0);var o=r>n?e.upColor:e.downColor,c=e.text,h=rt(r,this._chartData.precisionOptions().price),l=e.text.size;this._ctx.font=tt(l);var _,u=$(this._ctx,h)+c.paddingLeft+c.paddingRight,v=c.paddingTop+l+c.paddingBottom,d=this._chartData.styleOptions().yAxis;_=d.position===g&&d.tickText.position===T||d.position===k&&d.tickText.position===M?0:this._width-u,this._ctx.fillStyle=o,this._ctx.fillRect(_,s-c.paddingTop-l/2,u,v),this._ctx.fillStyle=c.color,this._ctx.textBaseline="middle",this._ctx.fillText(h,_+c.paddingLeft,s)}}}}]),e}(ct),lt=function(t){function e(t,a,n,r){var s;return i(this,e),(s=h(this,o(e).call(this,t,a)))._axis=n,s._additionalDataProvider=r,s}return s(e,t),n(e,[{key:"_draw",value:function(){this._drawCrossHairLabel()}},{key:"_drawCrossHairLabel",value:function(){}}]),e}(et),_t=function(t){function e(){return i(this,e),h(this,o(e).apply(this,arguments))}return s(e,t),n(e,[{key:"_drawCrossHairLabel",value:function(){if(this._chartData.crossHairSeriesTag()===this._additionalDataProvider.tag()){var t=this._chartData.styleOptions().floatLayer.crossHair,e=t.horizontal,i=e.text;if(t.display&&e.display&&i.display){var a=this._chartData.crossHairPoint();if(a){var n=rt(this._axis.convertFromPixel(a.y),this._chartData.precisionOptions[this._axis.isCandleStickYAxis()?"price":this._additionalDataProvider.technicalIndicatorType()]),r=i.size;this._ctx.font=tt(r);var s,o=$(this._ctx,n),c=i.paddingLeft,h=i.paddingTop,l=i.borderSize,_=o+2*l+c+i.paddingRight,u=r+2*l+h+i.paddingBottom,v=this._chartData.styleOptions().yAxis;s=v.position===g&&v.tickText.position===T||v.position===k&&v.tickText.position===M?0:this._width-_;var d=a.y-l-h-r/2;this._ctx.fillStyle=i.backgroundColor,this._ctx.fillRect(s,d,_,u),this._ctx.lineWidth=l,this._ctx.strokeStyle=i.borderColor,this._ctx.strokeRect(s,d,_,u),this._ctx.textBaseline="middle",this._ctx.fillStyle=i.color,this._ctx.fillText(n,s+l+c,a.y)}}}}}]),e}(lt),ut=function(t){function e(){return i(this,e),h(this,o(e).apply(this,arguments))}return s(e,t),n(e,[{key:"_createMainView",value:function(t,e){return new ht(t,e.chartData,e.yAxis)}},{key:"_createFloatLayerView",value:function(t,e){return new _t(t,e.chartData,e.yAxis,e.additionalDataProvider)}}]),e}(J),vt=function(){function t(e){i(this,t),this._chartData=e,this._width=0,this._height=0,this._minValue=0,this._maxValue=0,this._range=0,this._ticks=[]}return n(t,[{key:"setSize",value:function(t,e){this._width=t,this._height=e}},{key:"ticks",value:function(){return this._ticks}},{key:"computeAxis",value:function(){var t=this._computeMinMaxValue(),e=t.max,i=t.range;this._minValue=t.min,this._maxValue=e,this._range=i,this._ticks=this._computeOptimalTicks(this._computeTicks())}},{key:"_computeMinMaxValue",value:function(){}},{key:"_computeOptimalTicks",value:function(t){}},{key:"_computeTicks",value:function(){var t=[];if(this._range>=0){var e=+this._nice(this._range/8),i=this._getIntervalPrecision(e),a=+this._round(Math.ceil(this._minValue/e)*e,i),n=+this._round(Math.floor(this._maxValue/e)*e,i),r=0,s=a;if(0!==e)for(;+n>=s;)++r,s+=e;s=a;for(var o=0;r>o;o++)t[o]={v:+s.toFixed(i)},s+=e}return t}},{key:"_nice",value:function(t){var e=Math.floor(Math.log(t)/Math.log(10)),i=Math.pow(10,e),a=t/i;return t=(1>a?1:2>a?2:3>a?3:5>a?5:10)*i,-20>e?t:+t.toFixed(0>e?-e:0)}},{key:"_getIntervalPrecision",value:function(t){var e=""+t,i=e.indexOf("e");if(i>0){var a=+e.slice(i+1);return 0>a?-a:0}var n=e.indexOf(".");return 0>n?0:e.length-1-n}},{key:"_round",value:function(t,e){return null==e&&(e=10),t=(+t).toFixed(e=Math.min(Math.max(0,e),20))}}]),t}(),dt="candle_stick",pt="technical_indicator",ft=function(t){function e(t,a){var n;return i(this,e),(n=h(this,o(e).call(this,t)))._yAxisType=a,n}return s(e,t),n(e,[{key:"_compareMinMax",value:function(t,e,i){var a=at(t,e.toLowerCase(),{});return Object.keys(a).forEach((function(t){var e=a[t];(e||0===e)&&(i[0]=Math.min(i[0],e),i[1]=Math.max(i[1],e))})),e!==R.BOLL&&e!==R.SAR||(i[0]=Math.min(i[0],t.low),i[1]=Math.max(i[1],t.high)),i}},{key:"_computeMinMaxValue",value:function(){var t=this._minValue,e=this._maxValue;if(t===1/0||e===-1/0||0===e&&0===t)return{min:0,max:0,range:0};var i=Math.abs(e-t);return 0===i&&(i=Math.abs((e+=1)-(t-=1))),{min:t-=i/100*10,max:e+=i/100*20,range:i=Math.abs(e-t)}}},{key:"_computeOptimalTicks",value:function(t){var e=[],i=t.length;if(i>0){var a=this._chartData.styleOptions().xAxis.tickText.size,n=this.convertToPixel(t[0].v),r=1;if(i>1){var s=this.convertToPixel(t[1].v),o=Math.abs(s-n);2*a>o&&(r=Math.ceil(2*a/o))}for(var c=0;i>c;c+=r){var h=t[c].v,l=this.convertToPixel(h);l>a&&this._height-a>l&&e.push({v:h,y:l})}}return e}},{key:"calcMinMaxValue",value:function(t,e){var i=this._chartData.dataList(),a=this._chartData.from(),n=this._chartData.to(),r=this._chartData.styleOptions().realTime.averageLine.display,s=[1/0,-1/0];if(e)for(var o=a;n>o;o++){var c=i[o],h=[c.close,s[0]],l=[c.close,s[1]];r&&(h.push(c.average),l.push(c.average)),s[0]=Math.min.apply(null,h),s[1]=Math.max.apply(null,l)}else{for(var _=a;n>_;_++){var u=i[_];this._compareMinMax(u,t,s),this.isCandleStickYAxis()&&(s[0]=Math.min(u.low,s[0]),s[1]=Math.max(u.high,s[1]))}t===R.VOL&&(s[0]=0)}s[0]!==1/0&&s[1]!==-1/0&&(this._minValue=s[0],this._maxValue=s[1])}},{key:"isCandleStickYAxis",value:function(){return this._yAxisType===dt}},{key:"convertFromPixel",value:function(t){return(1-t/this._height)*this._range+this._minValue}},{key:"convertToPixel",value:function(t){return Math.floor((1-(t-this._minValue)/this._range)*this._height)}}]),e}(vt),xt=function(t){function e(t){var a;return i(this,e),(a=h(this,o(e).call(this,t)))._technicalIndicatorType=t.technicalIndicatorType||R.MACD,a._calcTechnicalIndicator(),a}return s(e,t),n(e,[{key:"_initBefore",value:function(t){this._tag=t.tag,this._yAxis=this._createYAxis(t)}},{key:"_createYAxis",value:function(t){return new ft(t.chartData,pt)}},{key:"_createMainWidget",value:function(t,e){return new ot({container:t,chartData:e.chartData,xAxis:e.xAxis,yAxis:this._yAxis,additionalDataProvider:{technicalIndicatorType:this.technicalIndicatorType.bind(this),tag:this.tag.bind(this)}})}},{key:"_createYAxisWidget",value:function(t,e){return new ut({container:t,chartData:e.chartData,yAxis:this._yAxis,additionalDataProvider:{technicalIndicatorType:this.technicalIndicatorType.bind(this),tag:this.tag.bind(this)}})}},{key:"_computeAxis",value:function(){this._yAxis.calcMinMaxValue(this._technicalIndicatorType,this._isRealTime()),this._yAxis.computeAxis()}},{key:"_isRealTime",value:function(){return!1}},{key:"_calcTechnicalIndicator",value:function(){this._chartData.calcTechnicalIndicator(this._technicalIndicatorType)&&this.invalidate(Z)}},{key:"tag",value:function(){return this._tag}},{key:"setSize",value:function(t,i){this._yAxis.setSize(i.width,i.height),this._computeAxis(),l(o(e.prototype),"setSize",this).call(this,t,i)}},{key:"yAxis",value:function(){return this._yAxis}},{key:"technicalIndicatorType",value:function(){return this._technicalIndicatorType}},{key:"setTechnicalIndicatorType",value:function(t){this._technicalIndicatorType!==t&&(this._technicalIndicatorType=t,this._calcTechnicalIndicator())}}]),e}(q),yt=function(t){function e(){return i(this,e),h(this,o(e).apply(this,arguments))}return s(e,t),n(e,[{key:"_draw",value:function(){this._drawGrid(),this._additionalDataProvider.chartType()===D.REAL_TIME?this._drawRealTime():(this._drawCandleStick(),this._drawTechnicalIndicator(),this._drawHighestPriceMark(),this._drawLowestPriceMark()),this._drawLastPriceLine()}},{key:"_drawRealTime",value:function(){var t=this,e=[],i=[{x:0,y:this._height}],a=[],n=this._chartData.from(),r=this._chartData.range(),s=this._chartData.to();this._drawGraphics((function(r,s,o){var c=o.average,h=t._yAxis.convertToPixel(o.close),l=t._yAxis.convertToPixel(c);e.push({x:r,y:h}),(c||0===c)&&a.push({x:r,y:l}),s===n&&i.push({x:0,y:h}),i.push({x:r,y:h})}),(function(){var o=i.length;if(o>0){var c=i[o-1];!(r>n-s)?(i.push({x:t._width,y:c.y}),i.push({x:t._width,y:t._height})):i.push({x:c.x,y:t._height})}var h=t._chartData.styleOptions().realTime,l=h.timeLine;if(e.length>0){t._ctx.lineWidth=l.size,t._ctx.strokeStyle=l.color,t._ctx.beginPath(),t._ctx.moveTo(e[0].x,e[0].y);for(var _=1;e.length>_;_++)t._ctx.lineTo(e[_].x,e[_].y);t._ctx.stroke(),t._ctx.closePath()}if(i.length>0){t._ctx.fillStyle=l.areaFillColor,t._ctx.beginPath(),t._ctx.moveTo(i[0].x,i[0].y);for(var u=1;i.length>u;u++)t._ctx.lineTo(i[u].x,i[u].y);t._ctx.closePath(),t._ctx.fill()}var v=h.averageLine;if(v.display&&a.length>0){t._ctx.lineWidth=v.size,t._ctx.strokeStyle=v.color,t._ctx.beginPath(),t._ctx.moveTo(a[0].x,a[0].y);for(var d=1;a.length>d;d++)t._ctx.lineTo(a[d].x,a[d].y);t._ctx.stroke(),t._ctx.closePath()}}))}},{key:"_drawCandleStick",value:function(){var t=this;this._ctx.lineWidth=1;var e=[],i=-1/0,a=-1,n=1/0,r=-1,s=this._chartData.dataList(),o=this._chartData.styleOptions().candleStick;this._drawGraphics((function(c,h,l,_,u){var v=s[h-1]||{},d=v.close||-1/0,p=l.high,f=l.low,x=l.close,y=l.open;if(p>i&&(i=p,a=c),n>f&&(n=f,r=c),x>d?(t._ctx.strokeStyle=o.bar.upColor,t._ctx.fillStyle=o.bar.upColor):(t._ctx.strokeStyle=o.bar.downColor,t._ctx.fillStyle=o.bar.downColor),o.bar.style!==A){var m=t._yAxis.convertToPixel(y),g=t._yAxis.convertToPixel(x),k=t._yAxis.convertToPixel(p),T=t._yAxis.convertToPixel(f),M=[],D=[];switch(M[0]=k,D[1]=T,m>g?(M[1]=g,D[0]=m,e=[c-_,g,u,m-g]):g>m?(M[1]=m,D[0]=g,e=[c-_,m,u,g-m]):(M[1]=m,D[0]=g,e=[c-_,m,u,1]),t._ctx.beginPath(),t._ctx.moveTo(c,M[0]),t._ctx.lineTo(c,M[1]),t._ctx.stroke(),t._ctx.closePath(),t._ctx.beginPath(),t._ctx.moveTo(c,D[0]),t._ctx.lineTo(c,D[1]),t._ctx.stroke(),t._ctx.closePath(),1>e[3]&&(e[3]=1),o.bar.style){case S:t._ctx.fillRect(e[0],e[1],e[2],e[3]);break;case w:t._ctx.strokeRect(e[0],e[1],e[2],e[3]);break;case L:x>d?t._ctx.strokeRect(e[0],e[1],e[2],e[3]):t._ctx.fillRect(e[0],e[1],e[2],e[3]);break;case E:x>d?t._ctx.fillRect(e[0],e[1],e[2],e[3]):t._ctx.strokeRect(e[0],e[1],e[2],e[3])}}else t._drawOhlc(_,c,l,v,o.bar.upColor,o.bar.downColor)})),this._highestMarkData={x:a,price:i},this._lowestMarkData={x:r,price:n}}},{key:"_drawHighestPriceMark",value:function(t){if(this._highestMarkData){var e=this._highestMarkData.price,i=this._chartData.styleOptions().candleStick.priceMark,a=i.high;e!==-1/0&&i.display&&a.display&&this._drawLowestHighestPriceMark(a,this._highestMarkData.x,e,!0,this._chartData.precisionOptions().price)}}},{key:"_drawLowestPriceMark",value:function(){if(this._lowestMarkData){var t=this._lowestMarkData.price,e=this._chartData.styleOptions().candleStick.priceMark,i=e.low;t!==1/0&&e.display&&i.display&&this._drawLowestHighestPriceMark(i,this._lowestMarkData.x,t,!1,this._chartData.precisionOptions().price)}}},{key:"_drawLowestHighestPriceMark",value:function(t,e,i,a,n){var r=e,s=this._yAxis.convertToPixel(i)+(a?-2:2);this._ctx.textAlign="left",this._ctx.lineWidth=1,this._ctx.strokeStyle=t.color,this._ctx.fillStyle=t.color,this._ctx.beginPath(),this._ctx.moveTo(r,s),this._ctx.lineTo(r-2,s+(a?-2:2)),this._ctx.stroke(),this._ctx.closePath(),this._ctx.beginPath(),this._ctx.moveTo(r,s),this._ctx.lineTo(r+2,s+(a?-2:2)),this._ctx.stroke(),this._ctx.closePath(),this._ctx.beginPath(),this._ctx.moveTo(r,s),this._ctx.lineTo(r,s+=a?-5:5),this._ctx.stroke(),this._ctx.closePath(),this._ctx.beginPath(),this._ctx.moveTo(r,s),this._ctx.lineTo(r+5,s),this._ctx.stroke(),this._ctx.closePath(),this._ctx.font=tt(t.textSize);var o=rt(i,n);this._ctx.textBaseline="middle",this._ctx.fillText(o,r+5+t.textMargin,s)}},{key:"_drawLastPriceLine",value:function(){var t=this._chartData.dataList(),e=t.length,i=this._chartData.styleOptions().candleStick.priceMark,a=i.last;if(i.display&&a.display&&a.line.display&&0!==e){var n=(t[e-2]||{}).close||-1/0,r=t[e-1].close,s=this._yAxis.convertToPixel(r);s=+Math.max(.05*this._height,Math.min(s,.98*this._height)).toFixed(0);var o=a.line;this._ctx.strokeStyle=r>n?a.upColor:a.downColor,this._ctx.lineWidth=o.size,o.style===m&&this._ctx.setLineDash(o.dashValue),this._ctx.beginPath(),this._ctx.moveTo(0,s),this._ctx.lineTo(this._width,s),this._ctx.stroke(),this._ctx.closePath(),this._ctx.setLineDash([])}}}]),e}(it),mt=function(t){function a(){return i(this,a),h(this,o(a).apply(this,arguments))}return s(a,t),n(a,[{key:"_drawPrompt",value:function(t,e){var i=this._chartData.styleOptions().floatLayer.prompt.candleStick,a=this._getCandleStickPromptData(t,i);i.showType===I?(this._drawCandleStickStandardPromptText(i,a),this._drawTechnicalIndicatorPrompt(t,e,i.text.size+i.text.marginTop)):this._drawCandleStickRectPromptText(t,e,i,a)}},{key:"_drawCandleStickStandardPromptText",value:function(t,i){var a=this,n=i,r=t.text.marginLeft,s=t.text.marginRight,o=t.text.size,c=t.text.color,h=t.labels;this._ctx.textBaseline="top",this._ctx.font=tt(o);var l=r,_=t.text.marginTop;h.forEach((function(t,i){var o=t?"".concat(t,": "):"",h=$(a._ctx,o);a._ctx.fillStyle=c,a._ctx.fillText(o,l,_),l+=h;var u,v=n[i]||"--";"object"===e(v)?(u=v.value||"--",a._ctx.fillStyle=v.color||c):(a._ctx.fillStyle=c,u=v);var d=$(a._ctx,u);a._ctx.fillText(u,l,_),l+=d+r+s}))}},{key:"_drawCandleStickRectPromptText",value:function(t,i,a,n){var r=this,s=a.labels,o=n,c=a.text.marginLeft,h=a.text.marginRight,l=a.text.marginTop,_=a.text.marginBottom,u=a.text.size,v=a.text.color;this._ctx.textBaseline="top",this._ctx.font=tt(u);var d=0;s.forEach((function(t,i){var a=o[i]||"--",n=a;"object"===e(a)&&(n=a.value||"--");var s="".concat(t,": ").concat(n),l=$(r._ctx,s)+c+h;d=Math.max(d,l)}));var p=this._getTechnicalIndicatorPromptData(t),f=p.labels||[],x=p.values||[],y=this._chartData.styleOptions().floatLayer.prompt.technicalIndicator,m=y.text.marginLeft,g=y.text.marginRight,k=y.text.marginTop,T=y.text.marginBottom,M=y.text.size;this._ctx.font=tt(M),f.forEach((function(t,e){var i=x[e]||"--",a="".concat(t,": ").concat(i),n=$(r._ctx,a)+m+g;d=Math.max(d,n)}));var D,S=a.rect,w=S.borderSize,L=S.paddingLeft,E=S.paddingRight,A=S.paddingTop,P=2*w+d+L+E,b=2*w+A+S.paddingBottom+(_+l+u)*s.length+(k+T+M)*f.length;D=this._width/2>i?this._width-S.right-P:S.left;var I=S.top,C=S.borderRadius;this._ctx.lineWidth=w,this._ctx.strokeStyle=S.borderColor,this._ctx.fillStyle=S.fillColor,this._drawRoundRect(D,I,P,b,C),this._ctx.stroke(),this._drawRoundRect(D,I,P,b,C),this._ctx.fill();var R=D+w+L+c,O=I+w+A;this._ctx.font=tt(u),s.forEach((function(t,i){O+=l,r._ctx.textAlign="left",r._ctx.fillStyle=v,r._ctx.fillText("".concat(t,": "),R,O);var a,n=o[i]||"--";r._ctx.fillStyle=n.color||v,a="object"===e(n)?n.value||"--":n,r._ctx.textAlign="right",r._ctx.fillText(a,D+P-w-h-E,O),O+=u+_}));var N=this._chartData.styleOptions().technicalIndicator,H=N.line.colors,z=D+w+L+m,G=H.length;this._ctx.font=tt(M),f.forEach((function(t,e){O+=k,r._ctx.textAlign="left",r._ctx.fillStyle=H[e%G]||N.text.color,r._ctx.fillText("".concat(t.toUpperCase(),": "),z,O),r._ctx.textAlign="right",r._ctx.fillText(x[e]||"--",D+P-w-g-E,O),O+=M+T})),this._ctx.textAlign="left"}},{key:"_drawRoundRect",value:function(t,e,i,a,n){this._ctx.beginPath(),this._ctx.moveTo(t+n,e),this._ctx.arcTo(t+i,e,t+i,e+a,n),this._ctx.arcTo(t+i,e+a,t,e+a,n),this._ctx.arcTo(t,e+a,t,e,n),this._ctx.arcTo(t,e,t+i,e,n),this._ctx.closePath()}},{key:"_getCandleStickPromptData",value:function(t,e){var i=e.values,a=[];if(i)a=d(i)?i(t)||[]:i;else{var n=this._chartData.precisionOptions();(a=[at(t,"timestamp"),at(t,"open"),at(t,"close"),at(t,"high"),at(t,"low"),at(t,"volume")]).forEach((function(t,e){switch(e){case 0:a[e]=nt(t,"YYYY-MM-DD hh:mm");break;case a.length-1:a[e]=rt(t,n.volume);break;default:a[e]=rt(t,n.price)}}))}return a}}]),a}(st);function gt(t,e,i){var a=[];if(t&&e&&i.length>0){var n=t.x-e.x;if(0===n)i.forEach((function(t){a.push(t.y)}));else{var r=(t.y-e.y)/n,s=t.y-r*t.x;i.forEach((function(t){a.push(t.x*r+s)}))}}return a}function kt(t,e,i){return!!(i&&t&&e)&&(t.x===e.x?1>Math.abs(i.x-t.x):t.y===e.y?1>Math.abs(i.y-t.y):1>Math.abs(i.y-gt(t,e,[i])[0]))}function Tt(t,e,i){return!!(i&&t&&e)&&(!!kt(t,e,i)&&(t.x===e.x?e.y>t.y?i.y>t.y-2:t.y+2>i.y:e.x>t.x?i.x>t.x-2:t.x+2>i.x))}function Mt(t,e,i){return!!(i&&t&&e)&&(!!kt(t,e,i)&&2>Math.abs(Math.sqrt(Math.pow(i.x-t.x,2)+Math.pow(i.y-t.y,2))+Math.sqrt(Math.pow(i.x-e.x,2)+Math.pow(i.y-e.y,2))-Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))))}function Dt(t,e,i){if(!i)return!1;var a=i.x-t.x,n=i.y-t.y;return!(a*a+n*n>e*e)}function St(t,e,i){var a=[];if(t.length>1)if(t[0].x===t[1].x){var n=e.height;if(a.push([{x:t[0].x,y:0},{x:t[0].x,y:n}]),t.length>2&&(a.push([{x:t[2].x,y:0},{x:t[2].x,y:n}]),i)){var r=t[0].x-t[2].x;a.push([{x:t[0].x+r,y:0},{x:t[0].x+r,y:n}])}}else{var s=e.width;if(t[0].y===t[1].y){if(a.push([{x:0,y:t[0].y},{x:s,y:t[0].y}]),t.length>2&&(a.push([{x:0,y:t[2].y},{x:s,y:t[2].y}]),i)){var o=t[0].y-t[2].y;a.push([{x:0,y:t[0].y+o},{x:s,y:t[0].y+o}])}}else{var c=(t[0].y-t[1].y)/(t[0].x-t[1].x),h=t[0].y-c*t[0].x;if(a.push([{x:0,y:0*c+h},{x:s,y:s*c+h}]),t.length>2){var l=t[2].y-c*t[2].x;if(a.push([{x:0,y:0*c+l},{x:s,y:s*c+l}]),i){var _=h+(h-l);a.push([{x:0,y:0*c+_},{x:s,y:s*c+_}])}}}}return a}function wt(t,e){var i=[];if(t.length>0){var a=e.width;if(i.push([{x:0,y:t[0].y},{x:a,y:t[0].y}]),t.length>1){var n=t[0].y-t[1].y;i.push([{x:0,y:t[1].y+.786*n},{x:a,y:t[1].y+.786*n}]),i.push([{x:0,y:t[1].y+.618*n},{x:a,y:t[1].y+.618*n}]),i.push([{x:0,y:t[1].y+.5*n},{x:a,y:t[1].y+.5*n}]),i.push([{x:0,y:t[1].y+.382*n},{x:a,y:t[1].y+.382*n}]),i.push([{x:0,y:t[1].y+.236*n},{x:a,y:t[1].y+.236*n}]),i.push([{x:0,y:t[1].y},{x:a,y:t[1].y}])}}return i}function Lt(t){return t.getBoundingClientRect()||{left:0,top:0}}function Et(t){return!!t.touches}function At(t){t.cancelable&&t.preventDefault()}var Pt=!!navigator.maxTouchPoints||!!navigator.msMaxTouchPoints||"ontouchstart"in window||!!(window.DocumentTouch&&document instanceof window.DocumentTouch),bt="onorientationchange"in window&&Pt;function It(t,e){var i=t.clientX-e.clientX,a=t.clientY-e.clientY;return Math.sqrt(i*i+a*a)}var Ct={MOUSE:"mouse",TOUCH:"touch"},Rt=function(){function t(e,a,n){i(this,t),this._target=e,this._handler=a,this._options=n,this._clickCount=0,this._clickTimeoutId=null,this._longTapTimeoutId=null,this._longTapActive=!1,this._mouseMoveStartPosition=null,this._moveExceededManhattanDistance=!1,this._cancelClick=!1,this._unsubscribeOutsideEvents=null,this._unsubscribeMousemove=null,this._unsubscribeRoot=null,this._startPinchMiddlePoint=null,this._startPinchDistance=0,this._pinchPrevented=!1,this._preventDragProcess=!1,this._mousePressed=!1,this._init()}return n(t,[{key:"destroy",value:function(){null!==this._unsubscribeOutsideEvents&&(this._unsubscribeOutsideEvents(),this._unsubscribeOutsideEvents=null),null!==this._unsubscribeMousemove&&(this._unsubscribeMousemove(),this._unsubscribeMousemove=null),null!==this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),this._clearLongTapTimeout(),this._resetClickTimeout()}},{key:"_mouseEnterHandler",value:function(t){var e=this;this._unsubscribeMousemove&&this._unsubscribeMousemove();var i=this._mouseMoveHandler.bind(this),a=this._mouseWheelHandler.bind(this);this._unsubscribeMousemove=function(){e._target.removeEventListener("mousemove",i),e._target.removeEventListener("wheel",a)},this._target.addEventListener("mousemove",i),this._target.addEventListener("wheel",a,{passive:!1}),Et(t)&&this._mouseMoveHandler(t);var n=this._makeCompatEvent(t);this._processEvent(n,this._handler.mouseEnterEvent)}},{key:"_resetClickTimeout",value:function(){null!==this._clickTimeoutId&&clearTimeout(this._clickTimeoutId),this._clickCount=0,this._clickTimeoutId=null}},{key:"_mouseMoveHandler",value:function(t){if(!this._mousePressed||Et(t)){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseMoveEvent)}}},{key:"_mouseWheelHandler",value:function(t){var e=this._makeCompatEvent(t);t.localX=e.localX,t.localY=e.localY,this._processEvent(t,this._handler.mouseWheelEvent)}},{key:"_mouseMoveWithDownHandler",value:function(t){if(!("button"in t&&0!==t.button)&&null===this._startPinchMiddlePoint){var e=Et(t);if(!this._preventDragProcess||!e){this._pinchPrevented=!0;var i=this._makeCompatEvent(t),a=this._mouseMoveStartPosition,n=Math.abs(a.x-i.pageX),r=Math.abs(a.y-i.pageY),s=n+r>5;if(s||!e){if(s&&!this._moveExceededManhattanDistance&&e){var o=.5*n;r>=o&&!this._options.treatVertTouchDragAsPageScroll||o>r&&!this._options.treatHorzTouchDragAsPageScroll||(this._preventDragProcess=!0)}s&&(this._moveExceededManhattanDistance=!0,this._cancelClick=!0,e&&this._clearLongTapTimeout()),this._preventDragProcess||(this._processEvent(i,this._handler.pressedMouseMoveEvent),e&&At(t))}}}}},{key:"_mouseUpHandler",value:function(t){if(!("button"in t&&0!==t.button)){var e=this._makeCompatEvent(t);this._clearLongTapTimeout(),this._mouseMoveStartPosition=null,this._mousePressed=!1,this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null),Et(t)&&this._mouseLeaveHandler(t),this._processEvent(e,this._handler.mouseUpEvent),++this._clickCount,this._clickTimeoutId&&this._clickCount>1?(this._processEvent(e,this._handler.mouseDoubleClickEvent),this._resetClickTimeout()):this._cancelClick||this._processEvent(e,this._handler.mouseClickEvent),Et(t)&&(At(t),this._mouseLeaveHandler(t),0===t.touches.length&&(this._longTapActive=!1))}}},{key:"_clearLongTapTimeout",value:function(){null!==this._longTapTimeoutId&&(clearTimeout(this._longTapTimeoutId),this._longTapTimeoutId=null)}},{key:"_mouseDownHandler",value:function(t){if(!("button"in t&&0!==t.button)){var e=this._makeCompatEvent(t);this._cancelClick=!1,this._moveExceededManhattanDistance=!1,this._preventDragProcess=!1,Et(t)&&this._mouseEnterHandler(t),this._mouseMoveStartPosition={x:e.pageX,y:e.pageY},this._unsubscribeRoot&&(this._unsubscribeRoot(),this._unsubscribeRoot=null);var i=this._mouseMoveWithDownHandler.bind(this),a=this._mouseUpHandler.bind(this),n=this._target.ownerDocument.documentElement;this._unsubscribeRoot=function(){n.removeEventListener("touchmove",i),n.removeEventListener("touchend",a),n.removeEventListener("mousemove",i),n.removeEventListener("mouseup",a)},n.addEventListener("touchmove",i,{passive:!1}),n.addEventListener("touchend",a,{passive:!1}),this._clearLongTapTimeout(),Et(t)&&1===t.touches.length?this._longTapTimeoutId=setTimeout(this._longTapHandler.bind(this,t),600):(n.addEventListener("mousemove",i),n.addEventListener("mouseup",a)),this._mousePressed=!0,this._processEvent(e,this._handler.mouseDownEvent),this._clickTimeoutId||(this._clickCount=0,this._clickTimeoutId=setTimeout(this._resetClickTimeout.bind(this),500))}}},{key:"_init",value:function(){var t=this;this._target.addEventListener("mouseenter",this._mouseEnterHandler.bind(this)),this._target.addEventListener("touchcancel",this._clearLongTapTimeout.bind(this));var e=this._target.ownerDocument,i=function(e){t._handler.mouseDownOutsideEvent&&(e.target&&t._target.contains(e.target)||t._handler.mouseDownOutsideEvent())};this._unsubscribeOutsideEvents=function(){e.removeEventListener("mousedown",i),e.removeEventListener("touchstart",i)},e.addEventListener("mousedown",i),e.addEventListener("touchstart",i,{passive:!0}),this._target.addEventListener("mouseleave",this._mouseLeaveHandler.bind(this)),this._target.addEventListener("touchstart",this._mouseDownHandler.bind(this),{passive:!0}),bt||this._target.addEventListener("mousedown",this._mouseDownHandler.bind(this)),this._initPinch(),this._target.addEventListener("touchmove",(function(){}),{passive:!1})}},{key:"_initPinch",value:function(){var t=this;void 0===this._handler.pinchStartEvent&&void 0===this._handler.pinchEvent&&void 0===this._handler.pinchEndEvent||(this._target.addEventListener("touchstart",(function(e){return t._checkPinchState(e.touches)}),{passive:!0}),this._target.addEventListener("touchmove",(function(e){if(2===e.touches.length&&null!==t._startPinchMiddlePoint&&void 0!==t._handler.pinchEvent){var i=It(e.touches[0],e.touches[1]);t._handler.pinchEvent(t._startPinchMiddlePoint,i/t._startPinchDistance),At(e)}}),{passive:!1}),this._target.addEventListener("touchend",(function(e){t._checkPinchState(e.touches)})))}},{key:"_checkPinchState",value:function(t){1===t.length&&(this._pinchPrevented=!1),2!==t.length||this._pinchPrevented||this._longTapActive?this._stopPinch():this._startPinch(t)}},{key:"_startPinch",value:function(t){var e=Lt(this._target);this._startPinchMiddlePoint={x:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,y:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this._startPinchDistance=It(t[0],t[1]),void 0!==this._handler.pinchStartEvent&&this._handler.pinchStartEvent(),this._clearLongTapTimeout()}},{key:"_stopPinch",value:function(){null!==this._startPinchMiddlePoint&&(this._startPinchMiddlePoint=null,void 0!==this._handler.pinchEndEvent&&this._handler.pinchEndEvent())}},{key:"_mouseLeaveHandler",value:function(t){this._unsubscribeMousemove&&this._unsubscribeMousemove();var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.mouseLeaveEvent)}},{key:"_longTapHandler",value:function(t){var e=this._makeCompatEvent(t);this._processEvent(e,this._handler.longTapEvent),this._cancelClick=!0,this._longTapActive=!0}},{key:"_processEvent",value:function(t,e){e&&e.call(this._handler,t)}},{key:"_makeCompatEvent",value:function(t){var e;e="touches"in t&&t.touches.length?t.touches[0]:"changedTouches"in t&&t.changedTouches.length?t.changedTouches[0]:t;var i=Lt(this._target);return{clientX:e.clientX,clientY:e.clientY,pageX:e.pageX,pageY:e.pageY,screenX:e.screenX,screenY:e.screenY,localX:e.clientX-i.left,localY:e.clientY-i.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,type:t.type.startsWith("mouse")?Ct.MOUSE:Ct.TOUCH,target:e.target,view:t.view}}}]),t}();function Ot(t){return t.type===Ct.TOUCH}function Nt(t){return t.type===Ct.MOUSE}var Ht=function(){function t(e){i(this,t),this._chartData=e,this._seriesSize={}}return n(t,[{key:"_checkEventPointX",value:function(t){return t>this._seriesSize.contentLeft&&this._seriesSize.contentRight>t}},{key:"setSeriesSize",value:function(t){this._seriesSize=t}}]),t}(),zt="step_1",Gt="step_2",Yt="step_3",Vt="step_done",Ft=function(t){function a(t,e,n){var r;return i(this,a),(r=h(this,o(a).call(this,t)))._xAxis=e,r._yAxis=n,r._noneGraphicMarkMouseDownFlag=!1,r._noneGraphicMarkMouseDownActiveData={markKey:null,dataIndex:-1,onLine:!1,onCircle:!1,pointIndex:-1},r}return s(a,t),n(a,[{key:"mouseUpEvent",value:function(t){this._noneGraphicMarkMouseDownFlag=!1,this._noneGraphicMarkMouseDownActiveData={markKey:null,dataIndex:-1,onLine:!1,onCircle:!1,pointIndex:-1}}},{key:"mouseDownEvent",value:function(t){if(this._checkEventPointX(t.localX)&&this._checkEventPointY(t.localY)){this._chartData.setGraphicMarkPoint({x:t.localX,y:t.localY});var e=this._chartData.graphicMarkType();switch(e){case K.HORIZONTAL_STRAIGHT_LINE:case K.VERTICAL_STRAIGHT_LINE:case K.STRAIGHT_LINE:case K.HORIZONTAL_RAY_LINE:case K.VERTICAL_RAY_LINE:case K.RAY_LINE:case K.HORIZONTAL_SEGMENT_LINE:case K.VERTICAL_SEGMENT_LINE:case K.SEGMENT_LINE:case K.PRICE_LINE:case K.FIBONACCI_LINE:this._twoStepGraphicMarkMouseDown(t,e);break;case K.PRICE_CHANNEL_LINE:case K.PARALLEL_STRAIGHT_LINE:this._threeStepGraphicMarkMouseDown(t,e);break;case K.NONE:this._noneGraphicMarkMouseDown(t)}}}},{key:"_twoStepGraphicMarkMouseDown",value:function(t,e){var i=this;this._graphicMarkMouseDown(t,e,(function(t){switch(t.drawStep){case zt:t.drawStep=Gt;break;case Gt:t.drawStep=Vt,i._chartData.setGraphicMarkType(K.NONE)}}))}},{key:"_threeStepGraphicMarkMouseDown",value:function(t,e){var i=this;this._graphicMarkMouseDown(t,e,(function(t){switch(t.drawStep){case zt:t.drawStep=Gt;break;case Gt:t.drawStep=Yt;break;case Yt:t.drawStep=Vt,i._chartData.setGraphicMarkType(K.NONE)}}))}},{key:"_graphicMarkMouseDown",value:function(t,e,i){var a=this._chartData.graphicMarkData(),n=a[e];if(2===t.button)n.splice(n.length-1,1),this._chartData.setGraphicMarkType(K.NONE);else{var r=n[n.length-1];i(r),n[n.length-1]=r}a[e]=n,this._chartData.setGraphicMarkData(a)}},{key:"_noneGraphicMarkMouseDown",value:function(t){this._findNoneGraphicMarkMouseDownActiveData(t);var e=this._noneGraphicMarkMouseDownActiveData.markKey,i=this._noneGraphicMarkMouseDownActiveData.dataIndex;if(e&&-1!==i)if(2===t.button){var a=this._chartData.graphicMarkData(),n=a[e];n.splice(i,1),a[e]=n,this._chartData.setGraphicMarkData(a)}else this._noneGraphicMarkMouseDownActiveData.onCircle&&(this._noneGraphicMarkMouseDownFlag=!0,this._chartData.setDragGraphicMarkFlag(!0))}},{key:"_findNoneGraphicMarkMouseDownActiveData",value:function(t){for(var i=this,a={x:t.localX,y:t.localY},n=Object.keys(this._chartData.graphicMarkData()),r=function(t){var e=n[t];switch(e){case K.HORIZONTAL_STRAIGHT_LINE:case K.PRICE_LINE:if(i._realFindNoneGraphicMarkMouseDownActiveData(e,a,(function(t){return kt(t[0],{x:i._seriesSize.contentRight,y:t[0].y},a)})))return{v:void 0};break;case K.VERTICAL_STRAIGHT_LINE:if(i._realFindNoneGraphicMarkMouseDownActiveData(e,a,(function(t){return kt(t[0],{x:t[0].x,y:i._seriesSize.tags[te].contentBottom},a)})))return{v:void 0};break;case K.STRAIGHT_LINE:if(i._realFindNoneGraphicMarkMouseDownActiveData(e,a,(function(t){return kt(t[0],t[1],a)})))return{v:void 0};break;case K.HORIZONTAL_RAY_LINE:case K.VERTICAL_RAY_LINE:case K.RAY_LINE:if(i._realFindNoneGraphicMarkMouseDownActiveData(e,a,(function(t){return Tt(t[0],t[1],a)})))return{v:void 0};break;case K.HORIZONTAL_SEGMENT_LINE:case K.VERTICAL_SEGMENT_LINE:case K.SEGMENT_LINE:if(i._realFindNoneGraphicMarkMouseDownActiveData(e,a,(function(t){return Mt(t[0],t[1],a)})))return{v:void 0};break;case K.PRICE_CHANNEL_LINE:case K.PARALLEL_STRAIGHT_LINE:case K.FIBONACCI_LINE:if(i._realFindNoneGraphicMarkMouseDownActiveData(e,a,(function(t){var n=[],r={width:i._seriesSize.contentRight-i._seriesSize.contentLeft,height:i._seriesSize.tags[te].contentBottom-i._seriesSize.tags[te].contentTop};switch(e){case K.PRICE_CHANNEL_LINE:n=St(t,r,!0);break;case K.PARALLEL_STRAIGHT_LINE:n=St(t,r);break;case K.FIBONACCI_LINE:n=wt(t,r)}for(var s=!1,o=0;n.length>o;o++){var c=n[o];if(s=kt(c[0],c[1],a))return s}return s})))return{v:void 0}}},s=0;n.length>s;s++){var o=r(s);if("object"===e(o))return o.v}}},{key:"_realFindNoneGraphicMarkMouseDownActiveData",value:function(t,e,i){var a=this,n=this._chartData.graphicMarkData()[t],r=this._chartData.styleOptions().graphicMark;return n.forEach((function(n,s){var o=[],c=!1,h=-1;n.points.forEach((function(t,i){var n=a._xAxis.convertToPixel(t.xPos),s=a._yAxis.convertToPixel(t.price);o.push({x:n,y:s});var l=Dt({x:n,y:s},r.point.radius,e);l&&(h=i),c||(c=l)}));var l=i(o,e);if(l||c)return a._noneGraphicMarkMouseDownActiveData={markKey:t,dataIndex:s,onLine:l,onCircle:c,pointIndex:h},!0})),!1}},{key:"mouseMoveEvent",value:function(t){if(this._checkEventPointX(t.localX)&&this._checkEventPointY(t.localY)){var e={x:t.localX,y:t.localY};if(this._chartData.setGraphicMarkPoint(e),!this.waitingForMouseMoveAnimationFrame){this.waitingForMouseMoveAnimationFrame=!0;var i=this._chartData.graphicMarkType();switch(i){case K.HORIZONTAL_STRAIGHT_LINE:case K.VERTICAL_STRAIGHT_LINE:case K.PRICE_LINE:this._onePointGraphicMarkMouseMove(e,i);break;case K.STRAIGHT_LINE:case K.RAY_LINE:case K.SEGMENT_LINE:case K.FIBONACCI_LINE:this._twoPointGraphicMarkMouseMove(e,i);break;case K.HORIZONTAL_RAY_LINE:case K.HORIZONTAL_SEGMENT_LINE:this._twoPointGraphicMarkMouseMove(e,i,(function(t,e){t.points[0].price=e.price}));break;case K.VERTICAL_RAY_LINE:case K.VERTICAL_SEGMENT_LINE:this._twoPointGraphicMarkMouseMove(e,i,(function(t,e){t.points[0].xPos=e.xPos}));break;case K.PRICE_CHANNEL_LINE:case K.PARALLEL_STRAIGHT_LINE:this._threePointGraphicMarkMouseMove(e,i);break;case K.NONE:this._noneGraphicMarkMouseMove(e)}this.waitingForMouseMoveAnimationFrame=!1}}}},{key:"_onePointGraphicMarkMouseMove",value:function(t,e){var i=this;this._graphicMarkMouseMove(t,e,(function(e,a){var n=i._xAxis.convertFromPixel(t.x),r=i._yAxis.convertFromPixel(t.y);switch(a.drawStep){case Vt:e.push({points:[{xPos:n,price:r}],drawStep:zt});break;case zt:case Gt:a.points[0].xPos=n,a.points[0].price=r,e[e.length-1]=a}}))}},{key:"_twoPointGraphicMarkMouseMove",value:function(t,e,i){var a=this;this._graphicMarkMouseMove(t,e,(function(e,n){var r=a._xAxis.convertFromPixel(t.x),s=a._yAxis.convertFromPixel(t.y);switch(n.drawStep){case Vt:e.push({points:[{xPos:r,price:s},{xPos:r,price:s}],drawStep:zt});break;case zt:n.points[0]={xPos:r,price:s},n.points[1]={xPos:r,price:s},e[e.length-1]=n;break;case Gt:n.points[1]={xPos:r,price:s},d(i)&&i(n,{xPos:r,price:s}),e[e.length-1]=n}}))}},{key:"_threePointGraphicMarkMouseMove",value:function(t,e,i){var a=this;this._graphicMarkMouseMove(t,e,(function(e,n){var r=a._xAxis.convertFromPixel(t.x),s=a._yAxis.convertFromPixel(t.y);switch(n.drawStep){case Vt:e.push({points:[{xPos:r,price:s},{xPos:r,price:s}],drawStep:zt});break;case zt:n.points[0]={xPos:r,price:s},n.points[1]={xPos:r,price:s},e[e.length-1]=n;break;case Gt:d(i)&&i(n,{xPos:r,price:s}),n.points[1]={xPos:r,price:s},e[e.length-1]=n;break;case Yt:n.points[2]={xPos:r,price:s},e[e.length-1]=n}}))}},{key:"_graphicMarkMouseMove",value:function(t,e,i){var a=this._chartData.graphicMarkData(),n=a[e];i(n,n[n.length-1]||{drawStep:Vt}),a[e]=n,this._chartData.setGraphicMarkData(a)}},{key:"_noneGraphicMarkMouseMove",value:function(t){if(this._noneGraphicMarkMouseDownFlag){var e=this._noneGraphicMarkMouseDownActiveData.markKey,i=this._noneGraphicMarkMouseDownActiveData.dataIndex;if(e&&-1!==i){var a=this._chartData.graphicMarkData(),n=a[e];switch(e){case K.HORIZONTAL_STRAIGHT_LINE:case K.VERTICAL_STRAIGHT_LINE:case K.PRICE_LINE:case K.STRAIGHT_LINE:case K.RAY_LINE:case K.SEGMENT_LINE:case K.PRICE_CHANNEL_LINE:case K.PARALLEL_STRAIGHT_LINE:case K.FIBONACCI_LINE:var r=this._noneGraphicMarkMouseDownActiveData.pointIndex;-1!==r&&(n[i].points[r].xPos=this._xAxis.convertFromPixel(t.x),n[i].points[r].price=this._yAxis.convertFromPixel(t.y));break;case K.HORIZONTAL_RAY_LINE:case K.HORIZONTAL_SEGMENT_LINE:var s=this._noneGraphicMarkMouseDownActiveData.pointIndex;if(-1!==s){var o=this._yAxis.convertFromPixel(t.y);n[i].points[s].xPos=this._xAxis.convertFromPixel(t.x),n[i].points[0].price=o,n[i].points[1].price=o}break;case K.VERTICAL_RAY_LINE:case K.VERTICAL_SEGMENT_LINE:var c=this._noneGraphicMarkMouseDownActiveData.pointIndex;if(-1!==c){var h=this._xAxis.convertFromPixel(t.x);n[i].points[0].xPos=h,n[i].points[1].xPos=h,n[i].points[c].price=this._yAxis.convertFromPixel(t.y)}}a[e]=n,this._chartData.setGraphicMarkData(a)}}}},{key:"_checkEventPointY",value:function(t){var e=this._seriesSize.tags[te];return t>e.contentTop&&e.contentBottom>t}}]),a}(Ht),Bt=function(t){function e(t,a,n,r){var s;return i(this,e),(s=h(this,o(e).call(this,t,a)))._xAxis=n,s._yAxis=r,s}return s(e,t),n(e,[{key:"_draw",value:function(){var t=this._chartData.styleOptions().graphicMark,e=this._chartData.precisionOptions().price;this._drawHorizontalStraightLine(t),this._drawVerticalStraightLine(t),this._drawStraightLine(t),this._drawHorizontalRayLine(t),this._drawVerticalRayLine(t),this._drawRayLine(t),this._drawSegmentLine(t),this._drawPriceLine(t,e),this._drawPriceChannelLine(t),this._drawParallelStraightLine(t),this._drawFibonacciLine(t,e)}},{key:"_drawHorizontalStraightLine",value:function(t){var e=this;this._drawPointGraphicMark(K.HORIZONTAL_STRAIGHT_LINE,t,kt,(function(t){return[[{x:0,y:t[0].y},{x:e._width,y:t[0].y}]]}))}},{key:"_drawVerticalStraightLine",value:function(t){var e=this;this._drawPointGraphicMark(K.VERTICAL_STRAIGHT_LINE,t,kt,(function(t){return[[{x:t[0].x,y:0},{x:t[0].x,y:e._height}]]}))}},{key:"_drawStraightLine",value:function(t){var e=this;this._drawPointGraphicMark(K.STRAIGHT_LINE,t,kt,(function(t){if(t[0].x===t[1].x)return[[{x:t[0].x,y:0},{x:t[0].x,y:e._height}]];var i=gt(t[0],t[1],[{x:0,y:t[0].y},{x:e._width,y:t[0].y}]);return[[{x:0,y:i[0]},{x:e._width,y:i[1]}]]}))}},{key:"_drawHorizontalRayLine",value:function(t){var e=this;this._drawPointGraphicMark(K.HORIZONTAL_RAY_LINE,t,Tt,(function(t){var i={x:0,y:t[0].y};return t[1].x>t[0].x&&(i.x=e._width),[[t[0],i]]}))}},{key:"_drawVerticalRayLine",value:function(t){var e=this;this._drawPointGraphicMark(K.VERTICAL_RAY_LINE,t,Tt,(function(t){var i={x:t[0].x,y:0};return t[1].y>t[0].y&&(i.y=e._height),[[t[0],i]]}))}},{key:"_drawRayLine",value:function(t){var e=this;this._drawPointGraphicMark(K.RAY_LINE,t,Tt,(function(t){var i;return i=t[0].x===t[1].x&&t[0].y!==t[1].y?t[1].y>t[0].y?{x:t[0].x,y:e._height}:{x:t[0].x,y:0}:t[0].x>t[1].x?{x:0,y:gt(t[0],t[1],[{x:0,y:t[0].y}])[0]}:{x:e._width,y:gt(t[0],t[1],[{x:e._width,y:t[0].y}])[0]},[[t[0],i]]}))}},{key:"_drawSegmentLine",value:function(t){this._drawPointGraphicMark(K.HORIZONTAL_SEGMENT_LINE,t,Mt),this._drawPointGraphicMark(K.VERTICAL_SEGMENT_LINE,t,Mt),this._drawPointGraphicMark(K.SEGMENT_LINE,t,Mt)}},{key:"_drawPriceLine",value:function(t,e){var i=this;this._drawPointGraphicMark(K.PRICE_LINE,t,Tt,(function(t){return[[t[0],{x:i._width,y:t[0].y}]]}),!0,e)}},{key:"_drawPriceChannelLine",value:function(t){var e=this;this._drawPointGraphicMark(K.PRICE_CHANNEL_LINE,t,kt,(function(t){return St(t,{width:e._width,height:e._height},!0)}))}},{key:"_drawParallelStraightLine",value:function(t){var e=this;this._drawPointGraphicMark(K.PARALLEL_STRAIGHT_LINE,t,kt,(function(t){return St(t,{width:e._width,height:e._height})}))}},{key:"_drawFibonacciLine",value:function(t,e){var i=this;this._drawPointGraphicMark(K.FIBONACCI_LINE,t,kt,(function(t){return wt(t,{width:i._width,height:i._height})}),!0,e,["(100.0%)","(78.6%)","(61.8%)","(50.0%)","(38.2%)","(23.6%)","(0.0%)"])}},{key:"_drawPointGraphicMark",value:function(t,e,i,a,n,r,s){var o=this;this.storage.graphicMarkDatas[t].forEach((function(t){var c=t.drawStep,h=[];t.points.forEach((function(t){var e=t.price,i=o._xAxis.convertToPixel(t.xPos),a=o._yAxis.convertToPixel(e);h.push({x:i,y:a})}));var l=a?a(h):[h];o._drawGraphicMark(e,l,h,c,i,n,r,s)}))}},{key:"_drawGraphicMark",value:function(t,e,i,a,n,r,s){var o=this,c=arguments.length>7&&void 0!==arguments[7]?arguments[7]:[],h=this.storage.graphicMarkPoint,l=!1;e.forEach((function(e,i){if(e.length>1){var _=n(e[0],e[1],h);if(l||(l=_),a!==zt&&(o._ctx.strokeStyle=t.line.color,o._ctx.lineWidth=t.line.size,o._ctx.beginPath(),o._ctx.moveTo(e[0].x,e[0].y),o._ctx.lineTo(e[1].x,e[1].y),o._ctx.stroke(),o._ctx.closePath(),r)){var u=rt(o._yAxis.convertFromPixel(e[0].y),s);o._ctx.font=tt(t.text.size),o._ctx.fillStyle=t.text.color,o._ctx.fillText("".concat(u," ").concat(c[i]||""),e[0].x+t.text.marginLeft,e[0].y-t.text.marginBottom)}}}));for(var _=t.point.radius,u=!1,v=0;i.length>v&&!(u=Dt(i[v],_,h));v++);i.forEach((function(e){var i=Dt(e,_,h);if(u||l){var a=_,n=t.point.backgroundColor,r=t.point.borderColor,s=t.point.borderSize;i&&(a=t.point.activeRadius,n=t.point.activeBackgroundColor,r=t.point.activeBorderColor,s=t.point.activeBorderSize),o._ctx.fillStyle=n,o._ctx.beginPath(),o._ctx.arc(e.x,e.y,a,0,2*Math.PI),o._ctx.closePath(),o._ctx.fill(),o._ctx.lineWidth=s,o._ctx.strokeStyle=r,o._ctx.beginPath(),o._ctx.arc(e.x,e.y,a,0,2*Math.PI),o._ctx.closePath(),o._ctx.stroke()}}))}}]),e}(et),Wt=function(t){function e(){return i(this,e),h(this,o(e).apply(this,arguments))}return s(e,t),n(e,[{key:"_createMainView",value:function(t,e){return new yt(t,e.chartData,e.xAxis,e.yAxis,e.additionalDataProvider)}},{key:"_createExpandView",value:function(t,e){return new Bt(t,e.chartData,e.xAxis,e.yAxis)}},{key:"_createFloatLayerView",value:function(t,e){return new mt(t,e.chartData,e.xAxis,e.yAxis,e.additionalDataProvider)}},{key:"invalidate",value:function(t){t===j?this._expandView.flush():l(o(e.prototype),"invalidate",this).call(this,t)}}]),e}(ot),Xt=function(t){function e(t){var a;return i(this,e),(a=h(this,o(e).call(this,t)))._chartType=D.CANDLE,a}return s(e,t),n(e,[{key:"_createYAxis",value:function(t){return new ft(t.chartData,dt)}},{key:"_createMainWidget",value:function(t,e){return new Wt({container:t,chartData:e.chartData,xAxis:e.xAxis,yAxis:this._yAxis,additionalDataProvider:{technicalIndicatorType:this.technicalIndicatorType.bind(this),chartType:this.chartType.bind(this),tag:this.tag.bind(this)}})}},{key:"_isRealTime",value:function(){return this._chartType===D.REAL_TIME}},{key:"chartType",value:function(){return this._chartType}},{key:"setChartType",value:function(t){this._chartType!==t&&(this._chartType=t,this._chartData.styleOptions().realTime.averageLine.display&&this._isRealTime()&&(this._chartData.calcTechnicalIndicator(R.AVERAGE),this.invalidate(Z)))}}]),e}(xt),jt=function(t){function e(){return i(this,e),h(this,o(e).apply(this,arguments))}return s(e,t),n(e,[{key:"_drawAxisLine",value:function(){var t=this._chartData.styleOptions().xAxis;if(t.display&&t.axisLine.display){var e=t.axisLine.size,i=e/2;this._ctx.strokeStyle=t.axisLine.color,this._ctx.lineWidth=e,this._ctx.beginPath(),this._ctx.moveTo(0,i),this._ctx.lineTo(this._width,i),this._ctx.stroke(),this._ctx.closePath()}}},{key:"_drawTickLines",value:function(){var t=this,e=this._chartData.styleOptions().xAxis,i=e.tickLine;if(e.display&&i.display){this._ctx.lineWidth=i.size,this._ctx.strokeStyle=i.color;var a=e.axisLine.display?e.axisLine.size:0,n=a+i.length;this._axis.ticks().forEach((function(e){var i=e.x;t._ctx.beginPath(),t._ctx.moveTo(i,a),t._ctx.lineTo(i,n),t._ctx.stroke(),t._ctx.closePath()}))}}},{key:"_drawTickLabels",value:function(){var t=this._chartData.styleOptions().xAxis,e=t.tickText;if(t.display&&e.display){var i=t.tickLine;this._ctx.textBaseline="top",this._ctx.font=tt(e.size),this._ctx.textAlign="center",this._ctx.fillStyle=e.color;var a=e.margin;t.axisLine.display&&(a+=t.axisLine.size),i.display&&(a+=i.length);for(var n=this._chartData.dataList(),r=this._axis.ticks(),s=r.length,o=0;s>o;o++){var c=r[o].x,h=n[parseInt(r[o].v)].timestamp,l=nt(h,this._axis.tickLabelFormatType());if(o!==s-1){var _=n[parseInt(r[o+1].v)].timestamp,u=nt(h,"YYYY"),v=nt(h,"YYYY-MM"),d=nt(h,"MM-DD");u!==nt(_,"YYYY")?l=u:v!==nt(_,"YYYY-MM")?l=v:d!==nt(_,"MM-DD")&&(l=d)}this._ctx.fillText(l,c,a)}}}}]),e}(ct),Zt=function(t){function e(){return i(this,e),h(this,o(e).apply(this,arguments))}return s(e,t),n(e,[{key:"_drawCrossHairLabel",value:function(){if(this._chartData.crossHairSeriesTag()){var t=this._chartData.styleOptions().floatLayer.crossHair,e=t.vertical,i=e.text;if(t.display&&e.display&&i.display){var a=this._chartData.getCrossHairDataPos(),n=this._chartData.dataList()[a];if(n){var r=this._axis.convertToPixel(a),s=nt(n.timestamp,"YYYY-MM-DD hh:mm"),o=i.size;this._ctx.font=tt(o);var c=$(this._ctx,s),h=r-c/2,l=i.paddingLeft,_=i.paddingRight,u=i.paddingTop,v=i.borderSize;l+v>h?h=l+v:h>this._width-c-v-_&&(h=this._width-c-v-_);var d=h-v-l,p=h+c+v+_,f=0+o+2*v+u+i.paddingBottom;this._ctx.fillStyle=i.backgroundColor,this._ctx.fillRect(d,0,p-d,f-0),this._ctx.lineWidth=v,this._ctx.strokeStyle=i.borderColor,this._ctx.strokeRect(d,0,p-d,f-0),this._ctx.textBaseline="top",this._ctx.fillStyle=i.color,this._ctx.fillText(s,h,v+u)}}}}}]),e}(lt),Kt=function(t){function e(){return i(this,e),h(this,o(e).apply(this,arguments))}return s(e,t),n(e,[{key:"_createMainView",value:function(t,e){return new jt(t,e.chartData,e.xAxis)}},{key:"_createFloatLayerView",value:function(t,e){return new Zt(t,e.chartData,e.xAxis)}}]),e}(J),Ut=function(t){function e(t){var a;return i(this,e),(a=h(this,o(e).call(this,t)))._initMeasureCanvas(),a}return s(e,t),n(e,[{key:"_initMeasureCanvas",value:function(){var t=document.createElement("canvas");this._measureCtx=t.getContext("2d");var e=Q(this._measureCtx);this._measureCtx.scale(e,e)}},{key:"_computeMinMaxValue",value:function(){var t=this._chartData.from(),e=this._chartData.to()-1;return{min:t,max:e,range:e-t}}},{key:"_computeOptimalTicks",value:function(t){var e=[],i=t.length,a=this._chartData.dataList();if(i>0){var n=this._chartData.styleOptions().xAxis.tickText.size;this._measureCtx.font=tt(n);var r=$(this._measureCtx,"00-00 00:00"),s=parseInt(t[0].v),o=at(a[s],"timestamp",0),c=this.convertToPixel(s),h=1;if(this._tickLabelFormatType="MM:DD hh:mm",i>1){var l=parseInt(t[1].v),_=at(a[l],"timestamp",0),u=this.convertToPixel(l),v=Math.abs(u-c);r>v&&(h=Math.ceil(r/v));var d=(_-o)/1e3/60;this._tickLabelFormatType=720>d?"hh:mm":21600>d?"MM-DD":259200>d?"YYYY-MM":"YYYY"}for(var p=0;i>p;p+=h){var f=t[p].v,x=this.convertToPixel(f);x>r/2&&this._width-r/2>x&&e.push({v:f,x:x})}}return e}},{key:"tickLabelFormatType",value:function(){return this._tickLabelFormatType}},{key:"convertFromPixel",value:function(t){var e=this._chartData.dataSpace(),i=t/e,a=Math.floor(i);return i=(i-a)*e<this._chartData.barSpace()/2?a:Math.ceil(i),this._chartData.from()+i-1}},{key:"convertToPixel",value:function(t){var e=this._chartData.dataSpace();return Math.floor((t-this._chartData.from())*e+this._chartData.barSpace()/2)}}]),e}(vt),qt=function(t){function e(){return i(this,e),h(this,o(e).apply(this,arguments))}return s(e,t),n(e,[{key:"_initBefore",value:function(){this._xAxis=new Ut(this._chartData)}},{key:"_createMainWidget",value:function(t,e){return new Kt({container:t,chartData:e.chartData,xAxis:this._xAxis})}},{key:"_computeAxis",value:function(){this._xAxis.computeAxis()}},{key:"xAxis",value:function(){return this._xAxis}},{key:"setSize",value:function(t,i){l(o(e.prototype),"setSize",this).call(this,t,i),this._xAxis.setSize(t.width,t.height)}}]),e}(q),Jt=function(){function t(e,a,n,r){i(this,t),this._chartData=a,this._seriesIndex=n,this._excludeYAxisWidth=0,this._dragEventHandler=r,this._initElement(e)}return n(t,[{key:"_initElement",value:function(t){this._container=t,this._wrapper=document.createElement("div"),this._wrapper.style.margin="0",this._wrapper.style.padding="0",this._wrapper.style.position="relative",this._wrapper.style.overflow="hidden",this._wrapper.style.zIndex="10",this._element=document.createElement("div"),this._element.style.margin="0",this._element.style.padding="0",this._element.style.cursor="ns-resize",this._element.style.height="6px",this._wrapper.appendChild(this._element);var e=t.lastChild;e?t.insertBefore(this._wrapper,e):t.appendChild(this._wrapper),this._dragEvent=new Rt(this._element,{mouseDownEvent:this._mouseDownEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this)},{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!0})}},{key:"_mouseDownEvent",value:function(t){this._startY=t.pageY,this._dragEventHandler.startDrag(this._seriesIndex)}},{key:"_pressedMouseMoveEvent",value:function(t){this._dragEventHandler.drag(t.pageY-this._startY,this._seriesIndex)}},{key:"setExcludeYAxisWidth",value:function(t){this._excludeYAxisWidth=t,this.invalidate()}},{key:"updateSeriesIndex",value:function(t){this._seriesIndex=t}},{key:"invalidate",value:function(){var t=this._chartData.styleOptions().separator;this._wrapper.style.backgroundColor=t.color,this._wrapper.style.height="".concat(t.size,"px"),this._wrapper.style.width=t.fill?"100%":"".concat(this._excludeYAxisWidth,"px")}},{key:"destroy",value:function(){this._dragEvent.destroy(),this._container.removeChild(this._wrapper)}}]),t}(),Qt=function(t){function e(t){var a;return i(this,e),(a=h(this,o(e).call(this,t)))._startDragPoint={},a._touchPoint={},a._touchCancelCrossHair=!1,a._touchZoomed=!1,a._pinchScale=1,a}return s(e,t),n(e,[{key:"pinchStartEvent",value:function(){this._pinchScale=1,this._touchZoomed=!0}},{key:"pinchEvent",value:function(t,e){var i=5*(e-this._pinchScale);this._pinchScale=e,this._chartData.zoom(i)}},{key:"mouseLeaveEvent",value:function(t){Nt(t)&&this._chartData.setCrossHairSeriesTag(null)}},{key:"mouseMoveEvent",value:function(t){if(Nt(t))if(this._checkEventPointX(t.localX)){var e=this._translateCrossHairRealY(t.localY);e?(this._chartData.setCrossHairPoint({x:t.localX,y:e.y}),this._chartData.setCrossHairSeriesTag(e.tag)):this._chartData.setCrossHairSeriesTag(null)}else this._chartData.setCrossHairSeriesTag(null)}},{key:"mouseWheelEvent",value:function(t){if(this._checkEventPointX(t.localX)){var e=-t.deltaY/100;if(0!==e){switch(t.cancelable&&t.preventDefault(),t.deltaMode){case t.DOM_DELTA_PAGE:e*=120;break;case t.DOM_DELTA_LINE:e*=32}if(0!==e){var i=Math.sign(e)*Math.min(1,Math.abs(e));this._chartData.zoom(i)}}}}},{key:"mouseClickEvent",value:function(t){if(Ot(t)&&this._checkEventPointX(t.localX)){var e=this._translateCrossHairRealY(t.localY);e&&(this._touchPoint||this._touchCancelCrossHair||this._touchZoomed||(this._touchPoint={x:t.localX,y:t.localY},this._chartData.setCrossHairPoint({x:t.localX,y:e.y}),this._chartData.setCrossHairSeriesTag(e.tag)))}}},{key:"mouseDownEvent",value:function(t){if(this._startDragPoint={x:t.localX,y:t.localY},this._chartData.startDrag(),Ot(t)&&this._checkEventPointX(t.localX)){var e=this._translateCrossHairRealY(t.localY);if(e){var i={x:t.localX,y:e.y};if(this._touchZoomed=!1,this._touchPoint){var a=t.localX-this._touchPoint.x,n=t.localY-this._touchPoint.y;10>Math.sqrt(a*a+n*n)?(this._touchPoint={x:t.localX,y:t.localY},this._chartData.setCrossHairPoint(i),this._chartData.setCrossHairSeriesTag(e.tag)):(this._touchCancelCrossHair=!0,this._touchPoint=null,this._chartData.setCrossHairPoint(i),this._chartData.setCrossHairSeriesTag(null))}else this._touchCancelCrossHair=!1}}}},{key:"pressedMouseMoveEvent",value:function(t){if(this._checkEventPointX(t.localX)){var e=this._translateCrossHairRealY(t.localY);if(e){var i={x:t.localX,y:e.y};if(Ot(t)&&this._touchPoint)return this._touchPoint={x:t.localX,y:t.localY},this._chartData.setCrossHairPoint(i),void this._chartData.setCrossHairSeriesTag(e.tag);var a=t.localX-this._startDragPoint.x;this._chartData.setCrossHairPoint(i),this._chartData.drag(a)}}}},{key:"longTapEvent",value:function(t){if(Ot(t)&&this._checkEventPointX(t.localX)){var e=this._translateCrossHairRealY(t.localY);e&&(this._touchPoint={x:t.localX,y:t.localY},this._chartData.setCrossHairPoint({x:t.localX,y:e.y}),this._chartData.setCrossHairSeriesTag(e.tag))}}},{key:"_translateCrossHairRealY",value:function(t){var e=this._seriesSize.tags||{};for(var i in e){var a=e[i];if(t>a.contentTop&&a.contentBottom>t)return{tag:i,y:t-a.contentTop}}return null}}]),e}(Ht),$t=function(){function t(e,a,n,r){i(this,t),this._chartData=a,this._seriesSize={},this._event=new Rt(e,{pinchStartEvent:this._pinchStartEvent.bind(this),pinchEvent:this._pinchEvent.bind(this),mouseUpEvent:this._mouseUpEvent.bind(this),mouseClickEvent:this._mouseClickEvent.bind(this),mouseDownEvent:this._mouseDownEvent.bind(this),mouseLeaveEvent:this._mouseLeaveEvent.bind(this),mouseMoveEvent:this._mouseMoveEvent.bind(this),mouseWheelEvent:this._mouseWheelEvent.bind(this),pressedMouseMoveEvent:this._pressedMouseMoveEvent.bind(this),longTapEvent:this._longTapEvent.bind(this)},{treatVertTouchDragAsPageScroll:!1,treatHorzTouchDragAsPageScroll:!1}),this._zoomDragEventHandler=new Qt(a),this._graphicMarkEventHandler=new Ft(a,n,r)}return n(t,[{key:"_pinchStartEvent",value:function(){this._zoomDragEventHandler.pinchStartEvent()}},{key:"_pinchEvent",value:function(t,e){this._zoomDragEventHandler.pinchEvent(t,e)}},{key:"_mouseUpEvent",value:function(t){this._graphicMarkEventHandler.mouseUpEvent(t)}},{key:"_mouseLeaveEvent",value:function(t){this._checkZoomDrag()&&this._zoomDragEventHandler.mouseLeaveEvent(t)}},{key:"_mouseMoveEvent",value:function(t){this._graphicMarkEventHandler.mouseMoveEvent(t),this._checkZoomDrag()&&this._zoomDragEventHandler.mouseMoveEvent(t)}},{key:"_mouseWheelEvent",value:function(t){this._checkZoomDrag()&&this._zoomDragEventHandler.mouseWheelEvent(t)}},{key:"_mouseClickEvent",value:function(t){this._checkZoomDrag()&&this._zoomDragEventHandler.mouseClickEvent(t)}},{key:"_mouseDownEvent",value:function(t){this._graphicMarkEventHandler.mouseDownEvent(t),this._checkZoomDrag()&&this._zoomDragEventHandler.mouseDownEvent(t)}},{key:"_pressedMouseMoveEvent",value:function(t){this._checkZoomDrag()&&this._zoomDragEventHandler.pressedMouseMoveEvent(t)}},{key:"_longTapEvent",value:function(t){this._checkZoomDrag()&&this._zoomDragEventHandler.longTapEvent(t)}},{key:"_checkZoomDrag",value:function(){return!this._chartData.dragGraphicMarkFlag()&&this._chartData.graphicMarkType()===K.NONE}},{key:"setSeriesSize",value:function(t){this._zoomDragEventHandler.setSeriesSize(t)}},{key:"destroy",value:function(){this._event.destroy()}}]),t}(),te="candle_stick_series_tag",ee=function(){function t(e,a){i(this,t),this._container=e,this._technicalIndicatorBaseId=0,this._technicalIndicatorSeries=[],this._separatorSeries=[],this._separatorDragStartTechnicalIndicatorHeight=0,this._chartData=new U(a,this._updateSeries.bind(this)),this._xAxisSeries=new qt({container:e,chartData:this._chartData}),this._candleStickSeries=new Xt({container:e,chartData:this._chartData,xAxis:this._xAxisSeries.xAxis(),technicalIndicatorType:R.MA,tag:te}),this._chartEvent=new $t(this._container,this._chartData,this._candleStickSeries.yAxis(),this._xAxisSeries.xAxis()),this.measureSeriesSize()}return n(t,[{key:"_separatorStartDrag",value:function(t){this._separatorDragStartTechnicalIndicatorHeight=this._technicalIndicatorSeries[t].height()}},{key:"_separatorDrag",value:function(t,e){this._technicalIndicatorSeries[e].setTempHeight(this._separatorDragStartTechnicalIndicatorHeight-t),this.measureSeriesSize()}},{key:"_measureXAxisHeight",value:function(){var t=this._chartData.styleOptions().xAxis,e=t.tickText,i=t.tickLine,a=e.size+e.margin;return t.display&&i.display&&(a+=i.length),t.display&&t.axisLine.display&&(a+=t.axisLine.size),+Math.ceil(+(a=Math.max(t.minHeight,Math.min(a,t.maxHeight)))).toFixed(0)}},{key:"_measureYAxisWidth",value:function(){var t=this._chartData.styleOptions().yAxis,e=t.tickText,i=t.tickLine;if(((e.display||i.display||e.margin>0)&&e.position===M||t.axisLine.display)&&t.display){var a=0;e.position===M&&(a+=e.margin,t.display&&i.display&&(a+=i.length));var n=t.axisLine.size;return t.display&&t.axisLine.display&&(a+=n),a>n&&(a=Math.max(t.minWidth,Math.min(a,t.maxWidth))),Math.ceil(a)}return 0}},{key:"_measureSeparatorHeight",value:function(){return this._chartData.styleOptions().separator.size*this._separatorSeries.length}},{key:"_updateSeries",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Z;if(t!==j){this._xAxisSeries.invalidate(t),this._candleStickSeries.invalidate(t);var e=!0,i=!1,a=void 0;try{for(var n,r=this._technicalIndicatorSeries[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var s=n.value;s.invalidate(t)}}catch(t){i=!0,a=t}finally{try{e||null==r.return||r.return()}finally{if(i)throw a}}}this._candleStickSeries.invalidate(t)}},{key:"_calcAllSeriesTechnicalIndicator",value:function(){var t=[];this._candleStickSeries.chartType()===D.CANDLE?t.push(this._candleStickSeries.technicalIndicatorType()):this._chartData.calcTechnicalIndicator(R.AVERAGE);var e=!0,i=!1,a=void 0;try{for(var n,r=this._technicalIndicatorSeries[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var s=n.value.technicalIndicatorType();0>t.indexOf(s)&&t.push(s)}}catch(t){i=!0,a=t}finally{try{e||null==r.return||r.return()}finally{if(i)throw a}}for(var o=0,c=t;c.length>o;o++){this._chartData.calcTechnicalIndicator(c[o])}this._updateSeries()}},{key:"chartData",value:function(){return this._chartData}},{key:"measureSeriesSize",value:function(){var t=this._container.offsetHeight,e=this._container.offsetWidth,i=this._measureSeparatorHeight(),a=this._measureXAxisHeight(),n=this._measureYAxisWidth(),r=t-a-i,s=e-n,o=s,c=0;this._chartData.styleOptions().yAxis.position===g&&(o=0,c=n);var h=0,l=!0,_=!1,u=void 0;try{for(var v,d=this._technicalIndicatorSeries[Symbol.iterator]();!(l=(v=d.next()).done);l=!0){h+=v.value.height()}}catch(t){_=!0,u=t}finally{try{l||null==d.return||d.return()}finally{if(_)throw u}}var p=r-h;this._chartData.setTotalDataSpace(s);var f={};f.contentLeft=c,f.contentRight=c+s;var x={};x[te]={contentTop:0,contentBottom:p};var y=p,m=p;this._candleStickSeries.setSize({left:c,width:s,height:p},{left:o,width:n,height:p});for(var k=0;this._technicalIndicatorSeries.length>k;k++){var T=this._technicalIndicatorSeries[k],M=this._separatorSeries[k],D=T.height();T.setSize({left:c,width:s,height:D},{left:o,width:n,height:D}),M.setExcludeYAxisWidth(s),m+=D,x[T.tag()]={contentTop:y,contentBottom:m},y=m}f.tags=x,this._xAxisSeries.setSize({left:c,width:s,height:a},{left:o,width:n,height:a}),this._chartEvent.setSeriesSize(f)}},{key:"applyStyleOptions",value:function(t){this._chartData.applyStyleOptions(t),this.measureSeriesSize()}},{key:"applyTechnicalIndicatorParams",value:function(t,e){if(this._chartData.applyTechnicalIndicatorParams(t,e),this._chartData.calcTechnicalIndicator(t)){this._candleStickSeries.technicalIndicatorType()===t&&this._candleStickSeries.invalidate(Z);var i=!0,a=!1,n=void 0;try{for(var r,s=this._technicalIndicatorSeries[Symbol.iterator]();!(i=(r=s.next()).done);i=!0){var o=r.value;o.technicalIndicatorType()===t&&o.invalidate(Z)}}catch(t){a=!0,n=t}finally{try{i||null==s.return||s.return()}finally{if(a)throw n}}}}},{key:"applyNewData",value:function(t){v(t)&&(this._chartData.clearDataList(),this._chartData.addData(t,0),this._calcAllSeriesTechnicalIndicator())}},{key:"applyMoreData",value:function(t){v(t)&&(this._chartData.addData(t,0),this._calcAllSeriesTechnicalIndicator())}},{key:"updateData",value:function(t){if(p(t)&&!v(t)){var e=this._chartData.dataList(),i=e.length,a=i;+at(t,"timestamp",0)===+at(e[i-1],"timestamp",0)&&(a=i-1),this._chartData.addData(t,a),this._calcAllSeriesTechnicalIndicator()}}},{key:"setCandleStickSeriesType",value:function(t){this._candleStickSeries.setChartType(t)}},{key:"createTechnicalIndicator",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:120,i=this._technicalIndicatorSeries.length;this._separatorSeries.push(new Jt(this._container,this._chartData,i,{startDrag:this._separatorStartDrag.bind(this),drag:this._separatorDrag.bind(this)})),this._technicalIndicatorBaseId++;var a="".concat("technical_indicator_").concat(this._technicalIndicatorBaseId),n=new xt({container:this._container,chartData:this._chartData,xAxis:this._xAxisSeries.xAxis(),technicalIndicatorType:t,tag:a});return n.setTempHeight(e),this._technicalIndicatorSeries.push(n),this.measureSeriesSize(),a}},{key:"removeTechnicalIndicator",value:function(t){for(var e=-1,i=0;this._technicalIndicatorSeries.length>i;i++){if(this._technicalIndicatorSeries[i].tag()===t){e=i;break}}if(-1!==e){this._technicalIndicatorSeries[e].destroy(),this._separatorSeries[e].destroy(),delete this._technicalIndicatorSeries[e],delete this._separatorSeries[e];for(var a=0;this._separatorSeries.length>a;a++)this._separatorSeries[a].updateSeriesIndex(a);this.measureSeriesSize()}}},{key:"setTechnicalIndicatorType",value:function(t,e){if(t===te)this._candleStickSeries.setTechnicalIndicatorType(e);else{var i,a=!0,n=!1,r=void 0;try{for(var s,o=this._technicalIndicatorSeries[Symbol.iterator]();!(a=(s=o.next()).done);a=!0){var c=s.value;if(c.tag()===t){i=c;break}}}catch(t){n=!0,r=t}finally{try{a||null==o.return||o.return()}finally{if(n)throw r}}i&&(e===R.NO?this.removeTechnicalIndicator(t):i.setTechnicalIndicatorType(e))}}}]),t}(),ie=function(){function t(e,a){i(this,t),this._chartSeries=new ee(e,a)}return n(t,[{key:"resize",value:function(){this._chartSeries.chartData().adjustFromTo(),this._chartSeries.measureSeriesSize()}},{key:"setOffsetRightSpace",value:function(t){this._chartSeries.chartData().setOffsetRightSpace(t)}},{key:"setBarSpace",value:function(t){this._chartSeries.chartData().setDataSpace(t)}},{key:"clearData",value:function(){this._chartSeries.chartData().clearDataList()}},{key:"getDataList",value:function(){this._chartSeries.chartData().dataList()}},{key:"applyStyleOptions",value:function(t){this._chartSeries.applyStyleOptions(t)}},{key:"applyTechnicalIndicatorParams",value:function(t,e){this._chartSeries.applyTechnicalIndicatorParams(t,e)}},{key:"applyPrecision",value:function(t,e){this._chartSeries.chartData().applyPrecision(t,e)}},{key:"applyNewData",value:function(t){this._chartSeries.applyNewData(t)}},{key:"applyMoreData",value:function(t){this._chartSeries.applyMoreData(t)}},{key:"updateData",value:function(t){this._chartSeries.updateData(t)}},{key:"setCandleStickChartType",value:function(t){this._chartSeries.setCandleStickSeriesType(t)}},{key:"setCandleStickTechnicalIndicatorType",value:function(t){this._chartSeries.setTechnicalIndicatorType(te,t)}},{key:"setTechnicalIndicatorType",value:function(t,e){this._chartSeries.setTechnicalIndicatorType(t,e)}},{key:"addTechnicalIndicator",value:function(t,e){return this._chartSeries.createTechnicalIndicator(t,e)}},{key:"removeTechnicalIndicator",value:function(t){this._chartSeries.removeTechnicalIndicator(t)}},{key:"addGraphicMark",value:function(t){var e=this._chartSeries.chartData().graphicMarkType();if(e!==t){var i=this._chartSeries.chartData().graphicMarkData(),a=i[e];a&&v(a)?(a.splice(a.length-1,1),i[e]=a):t=K.NONE,this._chartSeries.chartData().setGraphicMarkType(t),this._chartSeries.chartData().setGraphicMarkData(i)}}},{key:"removeAllGraphicMark",value:function(){var t=this._chartSeries.chartData().graphicMarkData(),e={};Object.keys(t).forEach((function(t){e[t]=[]})),this._chartSeries.chartData().setGraphicMarkType(K.NONE),this._chartSeries.chartData().setGraphicMarkData(e)}}]),t}(),ae="development"===process.env.NODE_ENV,ne={},re=1;t.dispose=function(t){if(t){var e=t.chart_id;!e&&t instanceof ie&&(e=t.id),e&&delete ne[e]}},t.init=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!t)throw Error("Chart version is 4.2.0. Root dom is null, can not initialize the chart!!!");var i=ne[t.chart_id||""];if(i)return ae&&console.warn("The chart has been initialized on the dom！！！"),i;var a="k_line_chart_".concat(re++),n=new ie(t,e);return n.id=a,t.chart_id=a,ne[a]=n,n},t.version=function(){return"4.2.0"},Object.defineProperty(t,"__esModule",{value:!0})}));
